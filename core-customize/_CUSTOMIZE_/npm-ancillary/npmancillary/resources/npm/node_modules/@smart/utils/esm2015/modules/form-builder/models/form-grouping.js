/**
 * Copyright (c) 2020 SAP SE or an SAP affiliate company. All rights reserved.
 * @module smartutils
 */
import * as tslib_1 from "tslib";
import { AbstractForm } from './abstract-form';
/**
 * A FormGrouping is used to encapsulate form data
 * of objects.
 */
export class FormGrouping extends AbstractForm {
    constructor(component, control, inputs, persist, parent, forms = {}) {
        super(component, control, inputs, persist, parent);
        this.forms = forms;
        Object.keys(this.forms).forEach((key) => {
            this.forms[key].parent = this;
        });
    }
    /**
     * Adds a form element to the group.
     *
     * @param name
     * @param form
     */
    addFormElement(name, form) {
        this.forms = Object.assign({}, this.forms, { [name]: form });
        this.control.addControl(name, form.control);
        form.parent = this;
    }
    /**
     * Removes a form element from the group.
     *
     * @param {string} name
     */
    removeFormElement(name) {
        if (!this.forms[name]) {
            return;
        }
        const _a = this.forms, _b = name, deleted = _a[_b], forms = tslib_1.__rest(_a, [typeof _b === "symbol" ? _b : _b + ""]);
        this.forms = forms;
        deleted.parent = null;
        this.control.removeControl(name);
    }
    /**
     * Get form element based on the string path.
     *
     * @param paths A dot notation path to the nested abstract form.
     * @returns Returns the AbstractForm based on the path. null if the child does not exists.
     */
    getFormElement(paths) {
        return (Array.isArray(paths) ? paths : paths.split('.')).reduce((acc, path) => {
            if (!acc || !acc.forms) {
                return null;
            }
            return acc.forms[path];
        }, this);
    }
    /**
     * Manually sets nested errors to each FormControl.
     *
     * Note: Method should be called on the next rendering cycle and not on the initialization of the form. Should be
     * used to enforce backend validation.
     *
     * @param errors
     */
    setNestedErrors(errors = []) {
        errors.forEach(([path, validationErrors]) => {
            const form = this.getFormElement(path);
            /**
             * Fail if the form does not exist.
             */
            if (!form) {
                throw new Error(`FormGrouping - Path not found when setting nested error: ${path}`);
            }
            form.control.setErrors(validationErrors);
        });
    }
    /**
     * Returns value of persistable nodes.
     * @return any
     */
    getPersistedValue() {
        return Object.keys(this.forms).reduce((acc, key) => {
            const child = this.forms[key];
            /**
             * Look ahead and if nested does not want to be mapped, merge the nested object with
             * the current object.
             *
             * If it's a field, then it's undefined.
             *
             * If it's a group, then it will be merged.
             */
            if (!child.persist) {
                return Object.assign({}, acc, child.getPersistedValue());
            }
            acc[key] = child.getPersistedValue();
            return acc;
        }, {});
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1ncm91cGluZy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzbWFydC91dGlscy8iLCJzb3VyY2VzIjpbIm1vZHVsZXMvZm9ybS1idWlsZGVyL21vZGVscy9mb3JtLWdyb3VwaW5nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFNQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFJL0M7OztHQUdHO0FBQ0gsTUFBTSxPQUFPLFlBQWEsU0FBUSxZQUFZO0lBTTFDLFlBQ0ksU0FBd0IsRUFDeEIsT0FBa0IsRUFDbEIsTUFBdUIsRUFDdkIsT0FBZ0IsRUFDaEIsTUFBMkIsRUFDcEIsUUFBdUIsRUFBRTtRQUVoQyxLQUFLLENBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRjVDLFVBQUssR0FBTCxLQUFLLENBQW9CO1FBSWhDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ3BDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztRQUNsQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILGNBQWMsQ0FBQyxJQUFZLEVBQUUsSUFBa0I7UUFDM0MsSUFBSSxDQUFDLEtBQUsscUJBQVEsSUFBSSxDQUFDLEtBQUssSUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksR0FBRSxDQUFDO1FBQzdDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFNUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7SUFDdkIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxpQkFBaUIsQ0FBQyxJQUFZO1FBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ25CLE9BQU87U0FDVjtRQUVELE1BQU0sZUFBMEMsRUFBeEMsU0FBTSxFQUFOLGdCQUFlLEVBQUUsbUVBQXVCLENBQUM7UUFDakQsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsT0FBTyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFFdEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsY0FBYyxDQUFDLEtBQXdCO1FBQ25DLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQzNELENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFO1lBQ1YsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUU7Z0JBQ3BCLE9BQU8sSUFBSSxDQUFDO2FBQ2Y7WUFDRCxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsQ0FBQyxFQUNELElBQVcsQ0FDZCxDQUFDO0lBQ04sQ0FBQztJQUVEOzs7Ozs7O09BT0c7SUFDSCxlQUFlLENBQUMsU0FBa0QsRUFBRTtRQUNoRSxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsRUFBRSxFQUFFO1lBQ3hDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFdkM7O2VBRUc7WUFDSCxJQUFJLENBQUMsSUFBSSxFQUFFO2dCQUNQLE1BQU0sSUFBSSxLQUFLLENBQUMsNERBQTRELElBQUksRUFBRSxDQUFDLENBQUM7YUFDdkY7WUFFRCxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzdDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVEOzs7T0FHRztJQUNILGlCQUFpQjtRQUNiLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxDQUNqQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRTtZQUNULE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFOUI7Ozs7Ozs7ZUFPRztZQUNILElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFO2dCQUNoQix5QkFBWSxHQUFHLEVBQUssS0FBSyxDQUFDLGlCQUFpQixFQUFFLEVBQUc7YUFDbkQ7WUFFRCxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDckMsT0FBTyxHQUFHLENBQUM7UUFDZixDQUFDLEVBQ0QsRUFBUyxDQUNaLENBQUM7SUFDTixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxOSBTQVAgU0Ugb3IgYW4gU0FQIGFmZmlsaWF0ZSBjb21wYW55LiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogQG1vZHVsZSBzbWFydHV0aWxzXG4gKi9cbmltcG9ydCB7IEZvcm1Hcm91cCwgVmFsaWRhdGlvbkVycm9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcblxuaW1wb3J0IHsgQWJzdHJhY3RGb3JtIH0gZnJvbSAnLi9hYnN0cmFjdC1mb3JtJztcbmltcG9ydCB7IEFic3RyYWN0Rm9ybXMsIENvbXBvbmVudFR5cGUgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgSW5wdXRQcm9wZXJ0aWVzIH0gZnJvbSAnLi9pbnB1dC1wcm9wZXJ0aWVzJztcblxuLyoqXG4gKiBBIEZvcm1Hcm91cGluZyBpcyB1c2VkIHRvIGVuY2Fwc3VsYXRlIGZvcm0gZGF0YVxuICogb2Ygb2JqZWN0cy5cbiAqL1xuZXhwb3J0IGNsYXNzIEZvcm1Hcm91cGluZyBleHRlbmRzIEFic3RyYWN0Rm9ybSB7XG4gICAgLyoqXG4gICAgICogQG92ZXJyaWRlXG4gICAgICovXG4gICAgcmVhZG9ubHkgY29udHJvbCE6IEZvcm1Hcm91cDtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBjb21wb25lbnQ6IENvbXBvbmVudFR5cGUsXG4gICAgICAgIGNvbnRyb2w6IEZvcm1Hcm91cCxcbiAgICAgICAgaW5wdXRzOiBJbnB1dFByb3BlcnRpZXMsXG4gICAgICAgIHBlcnNpc3Q6IGJvb2xlYW4sXG4gICAgICAgIHBhcmVudDogQWJzdHJhY3RGb3JtIHwgbnVsbCxcbiAgICAgICAgcHVibGljIGZvcm1zOiBBYnN0cmFjdEZvcm1zID0ge31cbiAgICApIHtcbiAgICAgICAgc3VwZXIoY29tcG9uZW50LCBjb250cm9sLCBpbnB1dHMsIHBlcnNpc3QsIHBhcmVudCk7XG5cbiAgICAgICAgT2JqZWN0LmtleXModGhpcy5mb3JtcykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmZvcm1zW2tleV0ucGFyZW50ID0gdGhpcztcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkcyBhIGZvcm0gZWxlbWVudCB0byB0aGUgZ3JvdXAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbmFtZVxuICAgICAqIEBwYXJhbSBmb3JtXG4gICAgICovXG4gICAgYWRkRm9ybUVsZW1lbnQobmFtZTogc3RyaW5nLCBmb3JtOiBBYnN0cmFjdEZvcm0pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5mb3JtcyA9IHsgLi4udGhpcy5mb3JtcywgW25hbWVdOiBmb3JtIH07XG4gICAgICAgIHRoaXMuY29udHJvbC5hZGRDb250cm9sKG5hbWUsIGZvcm0uY29udHJvbCk7XG5cbiAgICAgICAgZm9ybS5wYXJlbnQgPSB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYSBmb3JtIGVsZW1lbnQgZnJvbSB0aGUgZ3JvdXAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICAgICAqL1xuICAgIHJlbW92ZUZvcm1FbGVtZW50KG5hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuZm9ybXNbbmFtZV0pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHsgW25hbWVdOiBkZWxldGVkLCAuLi5mb3JtcyB9ID0gdGhpcy5mb3JtcztcbiAgICAgICAgdGhpcy5mb3JtcyA9IGZvcm1zO1xuICAgICAgICBkZWxldGVkLnBhcmVudCA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5jb250cm9sLnJlbW92ZUNvbnRyb2wobmFtZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGZvcm0gZWxlbWVudCBiYXNlZCBvbiB0aGUgc3RyaW5nIHBhdGguXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGF0aHMgQSBkb3Qgbm90YXRpb24gcGF0aCB0byB0aGUgbmVzdGVkIGFic3RyYWN0IGZvcm0uXG4gICAgICogQHJldHVybnMgUmV0dXJucyB0aGUgQWJzdHJhY3RGb3JtIGJhc2VkIG9uIHRoZSBwYXRoLiBudWxsIGlmIHRoZSBjaGlsZCBkb2VzIG5vdCBleGlzdHMuXG4gICAgICovXG4gICAgZ2V0Rm9ybUVsZW1lbnQocGF0aHM6IHN0cmluZyB8IHN0cmluZ1tdKTogQWJzdHJhY3RGb3JtIHwgbnVsbCB7XG4gICAgICAgIHJldHVybiAoQXJyYXkuaXNBcnJheShwYXRocykgPyBwYXRocyA6IHBhdGhzLnNwbGl0KCcuJykpLnJlZHVjZShcbiAgICAgICAgICAgIChhY2MsIHBhdGgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWFjYyB8fCAhYWNjLmZvcm1zKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjLmZvcm1zW3BhdGhdO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRoaXMgYXMgYW55XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWFudWFsbHkgc2V0cyBuZXN0ZWQgZXJyb3JzIHRvIGVhY2ggRm9ybUNvbnRyb2wuXG4gICAgICpcbiAgICAgKiBOb3RlOiBNZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCBvbiB0aGUgbmV4dCByZW5kZXJpbmcgY3ljbGUgYW5kIG5vdCBvbiB0aGUgaW5pdGlhbGl6YXRpb24gb2YgdGhlIGZvcm0uIFNob3VsZCBiZVxuICAgICAqIHVzZWQgdG8gZW5mb3JjZSBiYWNrZW5kIHZhbGlkYXRpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXJyb3JzXG4gICAgICovXG4gICAgc2V0TmVzdGVkRXJyb3JzKGVycm9yczogW3N0cmluZ1tdIHwgc3RyaW5nLCBWYWxpZGF0aW9uRXJyb3JzXVtdID0gW10pOiB2b2lkIHtcbiAgICAgICAgZXJyb3JzLmZvckVhY2goKFtwYXRoLCB2YWxpZGF0aW9uRXJyb3JzXSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZm9ybSA9IHRoaXMuZ2V0Rm9ybUVsZW1lbnQocGF0aCk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRmFpbCBpZiB0aGUgZm9ybSBkb2VzIG5vdCBleGlzdC5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgaWYgKCFmb3JtKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGb3JtR3JvdXBpbmcgLSBQYXRoIG5vdCBmb3VuZCB3aGVuIHNldHRpbmcgbmVzdGVkIGVycm9yOiAke3BhdGh9YCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvcm0uY29udHJvbC5zZXRFcnJvcnModmFsaWRhdGlvbkVycm9ycyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdmFsdWUgb2YgcGVyc2lzdGFibGUgbm9kZXMuXG4gICAgICogQHJldHVybiBhbnlcbiAgICAgKi9cbiAgICBnZXRQZXJzaXN0ZWRWYWx1ZSgpOiBhbnkge1xuICAgICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5mb3JtcykucmVkdWNlKFxuICAgICAgICAgICAgKGFjYywga2V5KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSB0aGlzLmZvcm1zW2tleV07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBMb29rIGFoZWFkIGFuZCBpZiBuZXN0ZWQgZG9lcyBub3Qgd2FudCB0byBiZSBtYXBwZWQsIG1lcmdlIHRoZSBuZXN0ZWQgb2JqZWN0IHdpdGhcbiAgICAgICAgICAgICAgICAgKiB0aGUgY3VycmVudCBvYmplY3QuXG4gICAgICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAgICAgKiBJZiBpdCdzIGEgZmllbGQsIHRoZW4gaXQncyB1bmRlZmluZWQuXG4gICAgICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAgICAgKiBJZiBpdCdzIGEgZ3JvdXAsIHRoZW4gaXQgd2lsbCBiZSBtZXJnZWQuXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgaWYgKCFjaGlsZC5wZXJzaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IC4uLmFjYywgLi4uY2hpbGQuZ2V0UGVyc2lzdGVkVmFsdWUoKSB9O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGFjY1trZXldID0gY2hpbGQuZ2V0UGVyc2lzdGVkVmFsdWUoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHt9IGFzIGFueVxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==