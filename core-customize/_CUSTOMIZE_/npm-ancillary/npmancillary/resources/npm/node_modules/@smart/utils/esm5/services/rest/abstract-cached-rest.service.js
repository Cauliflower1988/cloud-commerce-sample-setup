/**
 * Copyright (c) 2020 SAP SE or an SAP affiliate company. All rights reserved.
 * @module smartutils
 */
import * as tslib_1 from "tslib";
import { Cached, InvalidateCache } from '../cache';
/**
 * @ngdoc service
 * @name @smartutils.service:AbstractCachedRestService
 *
 * @description
 * Base class to implement Cache enabled {@link @smartutils.interfaces:IRestService IRestServices}.
 * <br/>Implementing classes just need declare a class level {@link @smartutils.object:@CacheConfig @CacheConfig} annotation
 * with at least one {@link @smartutils.object:CacheAction CacheAction} and one {@link @smartutils.object:EvictionTag EvictionTag}.
 * <br/>Cache policies called by the set of {@link @smartutils.object:CacheAction CacheActions} will have access to
 * REST call response headers being added to the response under "headers" property.
 * <br/>Those headers are then stripped from the response.
 *
 * <h2>Usage</h2>
 * <pre>
 * &#64;CacheConfig({actions: [rarelyChangingContent], tags: [userEvictionTag]})
 * &#64;SeInjectable()
 * export class ProductCatalogRestService extends AbstractCachedRestService<IBaseCatalogs> {
 * 	constructor(restServiceFactory: IRestServiceFactory) {
 * 		super(restServiceFactory, '/productcatalogs');
 * 	}
 * }
 * </pre>
 */
var AbstractCachedRestService = /** @class */ (function () {
    function AbstractCachedRestService(restServiceFactory, uri, identifier) {
        this.innerRestService = restServiceFactory.get(uri, identifier);
        this.innerRestService.activateMetadata && this.innerRestService.activateMetadata();
    }
    AbstractCachedRestService.prototype.getById = function (identifier, options) {
        return this.innerRestService.getById(identifier, options);
    };
    AbstractCachedRestService.prototype.get = function (searchParams, options) {
        return this.innerRestService.get(searchParams, options);
    };
    AbstractCachedRestService.prototype.query = function (searchParams, options) {
        return this.innerRestService.query(searchParams, options);
    };
    AbstractCachedRestService.prototype.page = function (searchParams, options) {
        return this.innerRestService.page(searchParams, options);
    };
    AbstractCachedRestService.prototype.update = function (payload, options) {
        return this.innerRestService.update(payload, options);
    };
    AbstractCachedRestService.prototype.patch = function (payload, options) {
        return this.innerRestService.patch(payload, options);
    };
    AbstractCachedRestService.prototype.remove = function (payload, options) {
        return this.innerRestService.remove(payload, options);
    };
    AbstractCachedRestService.prototype.save = function (payload, options) {
        return this.innerRestService.save(payload, options);
    };
    tslib_1.__decorate([
        StripResponseHeaders,
        Cached(),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [String, Object]),
        tslib_1.__metadata("design:returntype", Promise)
    ], AbstractCachedRestService.prototype, "getById", null);
    tslib_1.__decorate([
        StripResponseHeaders,
        Cached(),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [Object, Object]),
        tslib_1.__metadata("design:returntype", Promise)
    ], AbstractCachedRestService.prototype, "get", null);
    tslib_1.__decorate([
        StripResponseHeaders,
        Cached(),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [Object, Object]),
        tslib_1.__metadata("design:returntype", Promise)
    ], AbstractCachedRestService.prototype, "query", null);
    tslib_1.__decorate([
        StripResponseHeaders,
        Cached(),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [Object, Object]),
        tslib_1.__metadata("design:returntype", Promise)
    ], AbstractCachedRestService.prototype, "page", null);
    tslib_1.__decorate([
        StripResponseHeaders,
        InvalidateCache(),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [Object, Object]),
        tslib_1.__metadata("design:returntype", Promise)
    ], AbstractCachedRestService.prototype, "update", null);
    tslib_1.__decorate([
        StripResponseHeaders,
        InvalidateCache(),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [Object, Object]),
        tslib_1.__metadata("design:returntype", Promise)
    ], AbstractCachedRestService.prototype, "patch", null);
    tslib_1.__decorate([
        InvalidateCache(),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [Object, Object]),
        tslib_1.__metadata("design:returntype", Promise)
    ], AbstractCachedRestService.prototype, "remove", null);
    tslib_1.__decorate([
        StripResponseHeaders,
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [Object, Object]),
        tslib_1.__metadata("design:returntype", Promise)
    ], AbstractCachedRestService.prototype, "save", null);
    return AbstractCachedRestService;
}());
export { AbstractCachedRestService };
export function StripResponseHeaders(target, propertyName, descriptor) {
    var originalMethod = descriptor.value;
    if (originalMethod) {
        descriptor.value = function () {
            return originalMethod
                .apply(this, Array.prototype.slice.call(arguments))
                .then(function (response) {
                delete response.headers;
                return response;
            });
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtY2FjaGVkLXJlc3Quc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzbWFydC91dGlscy8iLCJzb3VyY2VzIjpbInNlcnZpY2VzL3Jlc3QvYWJzdHJhY3QtY2FjaGVkLXJlc3Quc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBS0EsT0FBTyxFQUFFLE1BQU0sRUFBRSxlQUFlLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFHbkQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FzQkc7QUFDSDtJQUdJLG1DQUFZLGtCQUF1QyxFQUFFLEdBQVcsRUFBRSxVQUFtQjtRQUNqRixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsa0JBQWtCLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUMsQ0FBQztRQUNoRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsZ0JBQWdCLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDdkYsQ0FBQztJQUlELDJDQUFPLEdBQVAsVUFBeUIsVUFBa0IsRUFBRSxPQUFzQjtRQUMvRCxPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUksVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2pFLENBQUM7SUFJRCx1Q0FBRyxHQUFILFVBQXFCLFlBQTJCLEVBQUUsT0FBc0I7UUFDcEUsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxPQUFPLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBSUQseUNBQUssR0FBTCxVQUF1QixZQUEwQixFQUFFLE9BQXNCO1FBQ3JFLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDOUQsQ0FBQztJQUlELHdDQUFJLEdBQUosVUFBc0IsWUFBc0IsRUFBRSxPQUFzQjtRQUNoRSxPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFJRCwwQ0FBTSxHQUFOLFVBQXdCLE9BQWdCLEVBQUUsT0FBc0I7UUFDNUQsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBSUQseUNBQUssR0FBTCxVQUF1QixPQUFnQixFQUFFLE9BQXNCO1FBQzNELE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDekQsQ0FBQztJQUdELDBDQUFNLEdBQU4sVUFBd0IsT0FBZ0IsRUFBRSxPQUFzQjtRQUM1RCxPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFHRCx3Q0FBSSxHQUFKLFVBQXNCLE9BQWdCLEVBQUUsT0FBc0I7UUFDMUQsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztJQUN4RCxDQUFDO0lBMUNEO1FBRkMsb0JBQW9CO1FBQ3BCLE1BQU0sRUFBRTs7Ozs0REFHUjtJQUlEO1FBRkMsb0JBQW9CO1FBQ3BCLE1BQU0sRUFBRTs7Ozt3REFHUjtJQUlEO1FBRkMsb0JBQW9CO1FBQ3BCLE1BQU0sRUFBRTs7OzswREFHUjtJQUlEO1FBRkMsb0JBQW9CO1FBQ3BCLE1BQU0sRUFBRTs7Ozt5REFHUjtJQUlEO1FBRkMsb0JBQW9CO1FBQ3BCLGVBQWUsRUFBRTs7OzsyREFHakI7SUFJRDtRQUZDLG9CQUFvQjtRQUNwQixlQUFlLEVBQUU7Ozs7MERBR2pCO0lBR0Q7UUFEQyxlQUFlLEVBQUU7Ozs7MkRBR2pCO0lBR0Q7UUFEQyxvQkFBb0I7Ozs7eURBR3BCO0lBQ0wsZ0NBQUM7Q0FBQSxBQXJERCxJQXFEQztTQXJEcUIseUJBQXlCO0FBdUQvQyxNQUFNLFVBQVUsb0JBQW9CLENBQ2hDLE1BQVcsRUFDWCxZQUFvQixFQUNwQixVQUF5RDtJQUV6RCxJQUFNLGNBQWMsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDO0lBRXhDLElBQUksY0FBYyxFQUFFO1FBQ2hCLFVBQVUsQ0FBQyxLQUFLLEdBQUc7WUFDZixPQUFPLGNBQWM7aUJBQ2hCLEtBQUssQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2lCQUNsRCxJQUFJLENBQUMsVUFBQyxRQUFhO2dCQUNoQixPQUFPLFFBQVEsQ0FBQyxPQUFPLENBQUM7Z0JBQ3hCLE9BQU8sUUFBUSxDQUFDO1lBQ3BCLENBQUMsQ0FBQyxDQUFDO1FBQ1gsQ0FBQyxDQUFDO0tBQ0w7QUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTkgU0FQIFNFIG9yIGFuIFNBUCBhZmZpbGlhdGUgY29tcGFueS4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEBtb2R1bGUgc21hcnR1dGlsc1xuICovXG5pbXBvcnQgeyBQYWdlLCBQYWdlYWJsZSwgUGF5bG9hZCB9IGZyb20gJy4uLy4uL2R0b3MnO1xuaW1wb3J0IHsgQ2FjaGVkLCBJbnZhbGlkYXRlQ2FjaGUgfSBmcm9tICcuLi9jYWNoZSc7XG5pbXBvcnQgeyBJUmVzdE9wdGlvbnMsIElSZXN0U2VydmljZSwgSVJlc3RTZXJ2aWNlRmFjdG9yeSwgU2VhcmNoUGFyYW1zIH0gZnJvbSAnLic7XG5cbi8qKlxuICogQG5nZG9jIHNlcnZpY2VcbiAqIEBuYW1lIEBzbWFydHV0aWxzLnNlcnZpY2U6QWJzdHJhY3RDYWNoZWRSZXN0U2VydmljZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogQmFzZSBjbGFzcyB0byBpbXBsZW1lbnQgQ2FjaGUgZW5hYmxlZCB7QGxpbmsgQHNtYXJ0dXRpbHMuaW50ZXJmYWNlczpJUmVzdFNlcnZpY2UgSVJlc3RTZXJ2aWNlc30uXG4gKiA8YnIvPkltcGxlbWVudGluZyBjbGFzc2VzIGp1c3QgbmVlZCBkZWNsYXJlIGEgY2xhc3MgbGV2ZWwge0BsaW5rIEBzbWFydHV0aWxzLm9iamVjdDpAQ2FjaGVDb25maWcgQENhY2hlQ29uZmlnfSBhbm5vdGF0aW9uXG4gKiB3aXRoIGF0IGxlYXN0IG9uZSB7QGxpbmsgQHNtYXJ0dXRpbHMub2JqZWN0OkNhY2hlQWN0aW9uIENhY2hlQWN0aW9ufSBhbmQgb25lIHtAbGluayBAc21hcnR1dGlscy5vYmplY3Q6RXZpY3Rpb25UYWcgRXZpY3Rpb25UYWd9LlxuICogPGJyLz5DYWNoZSBwb2xpY2llcyBjYWxsZWQgYnkgdGhlIHNldCBvZiB7QGxpbmsgQHNtYXJ0dXRpbHMub2JqZWN0OkNhY2hlQWN0aW9uIENhY2hlQWN0aW9uc30gd2lsbCBoYXZlIGFjY2VzcyB0b1xuICogUkVTVCBjYWxsIHJlc3BvbnNlIGhlYWRlcnMgYmVpbmcgYWRkZWQgdG8gdGhlIHJlc3BvbnNlIHVuZGVyIFwiaGVhZGVyc1wiIHByb3BlcnR5LlxuICogPGJyLz5UaG9zZSBoZWFkZXJzIGFyZSB0aGVuIHN0cmlwcGVkIGZyb20gdGhlIHJlc3BvbnNlLlxuICpcbiAqIDxoMj5Vc2FnZTwvaDI+XG4gKiA8cHJlPlxuICogJiM2NDtDYWNoZUNvbmZpZyh7YWN0aW9uczogW3JhcmVseUNoYW5naW5nQ29udGVudF0sIHRhZ3M6IFt1c2VyRXZpY3Rpb25UYWddfSlcbiAqICYjNjQ7U2VJbmplY3RhYmxlKClcbiAqIGV4cG9ydCBjbGFzcyBQcm9kdWN0Q2F0YWxvZ1Jlc3RTZXJ2aWNlIGV4dGVuZHMgQWJzdHJhY3RDYWNoZWRSZXN0U2VydmljZTxJQmFzZUNhdGFsb2dzPiB7XG4gKiBcdGNvbnN0cnVjdG9yKHJlc3RTZXJ2aWNlRmFjdG9yeTogSVJlc3RTZXJ2aWNlRmFjdG9yeSkge1xuICogXHRcdHN1cGVyKHJlc3RTZXJ2aWNlRmFjdG9yeSwgJy9wcm9kdWN0Y2F0YWxvZ3MnKTtcbiAqIFx0fVxuICogfVxuICogPC9wcmU+XG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdENhY2hlZFJlc3RTZXJ2aWNlPFQ+IGltcGxlbWVudHMgSVJlc3RTZXJ2aWNlPFQ+IHtcbiAgICBwcm90ZWN0ZWQgaW5uZXJSZXN0U2VydmljZTogSVJlc3RTZXJ2aWNlPFQ+O1xuXG4gICAgY29uc3RydWN0b3IocmVzdFNlcnZpY2VGYWN0b3J5OiBJUmVzdFNlcnZpY2VGYWN0b3J5LCB1cmk6IHN0cmluZywgaWRlbnRpZmllcj86IHN0cmluZykge1xuICAgICAgICB0aGlzLmlubmVyUmVzdFNlcnZpY2UgPSByZXN0U2VydmljZUZhY3RvcnkuZ2V0KHVyaSwgaWRlbnRpZmllcik7XG4gICAgICAgIHRoaXMuaW5uZXJSZXN0U2VydmljZS5hY3RpdmF0ZU1ldGFkYXRhICYmIHRoaXMuaW5uZXJSZXN0U2VydmljZS5hY3RpdmF0ZU1ldGFkYXRhKCk7XG4gICAgfVxuXG4gICAgQFN0cmlwUmVzcG9uc2VIZWFkZXJzXG4gICAgQENhY2hlZCgpXG4gICAgZ2V0QnlJZDxTIGV4dGVuZHMgVCA9IFQ+KGlkZW50aWZpZXI6IHN0cmluZywgb3B0aW9ucz86IElSZXN0T3B0aW9ucyk6IFByb21pc2U8UyB8IG51bGw+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJSZXN0U2VydmljZS5nZXRCeUlkPFM+KGlkZW50aWZpZXIsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIEBTdHJpcFJlc3BvbnNlSGVhZGVyc1xuICAgIEBDYWNoZWQoKVxuICAgIGdldDxTIGV4dGVuZHMgVCA9IFQ+KHNlYXJjaFBhcmFtcz86IFNlYXJjaFBhcmFtcywgb3B0aW9ucz86IElSZXN0T3B0aW9ucyk6IFByb21pc2U8UyB8IG51bGw+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJSZXN0U2VydmljZS5nZXQoc2VhcmNoUGFyYW1zLCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICBAU3RyaXBSZXNwb25zZUhlYWRlcnNcbiAgICBAQ2FjaGVkKClcbiAgICBxdWVyeTxTIGV4dGVuZHMgVCA9IFQ+KHNlYXJjaFBhcmFtczogU2VhcmNoUGFyYW1zLCBvcHRpb25zPzogSVJlc3RPcHRpb25zKTogUHJvbWlzZTxTW10+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJSZXN0U2VydmljZS5xdWVyeShzZWFyY2hQYXJhbXMsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIEBTdHJpcFJlc3BvbnNlSGVhZGVyc1xuICAgIEBDYWNoZWQoKVxuICAgIHBhZ2U8UyBleHRlbmRzIFQgPSBUPihzZWFyY2hQYXJhbXM6IFBhZ2VhYmxlLCBvcHRpb25zPzogSVJlc3RPcHRpb25zKTogUHJvbWlzZTxQYWdlPFM+PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmlubmVyUmVzdFNlcnZpY2UucGFnZShzZWFyY2hQYXJhbXMsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIEBTdHJpcFJlc3BvbnNlSGVhZGVyc1xuICAgIEBJbnZhbGlkYXRlQ2FjaGUoKVxuICAgIHVwZGF0ZTxTIGV4dGVuZHMgVCA9IFQ+KHBheWxvYWQ6IFBheWxvYWQsIG9wdGlvbnM/OiBJUmVzdE9wdGlvbnMpOiBQcm9taXNlPFM+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJSZXN0U2VydmljZS51cGRhdGUocGF5bG9hZCwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgQFN0cmlwUmVzcG9uc2VIZWFkZXJzXG4gICAgQEludmFsaWRhdGVDYWNoZSgpXG4gICAgcGF0Y2g8UyBleHRlbmRzIFQgPSBUPihwYXlsb2FkOiBQYXlsb2FkLCBvcHRpb25zPzogSVJlc3RPcHRpb25zKTogUHJvbWlzZTxTPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmlubmVyUmVzdFNlcnZpY2UucGF0Y2gocGF5bG9hZCwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgQEludmFsaWRhdGVDYWNoZSgpXG4gICAgcmVtb3ZlPFMgZXh0ZW5kcyBUID0gVD4ocGF5bG9hZDogUGF5bG9hZCwgb3B0aW9ucz86IElSZXN0T3B0aW9ucyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pbm5lclJlc3RTZXJ2aWNlLnJlbW92ZShwYXlsb2FkLCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICBAU3RyaXBSZXNwb25zZUhlYWRlcnNcbiAgICBzYXZlPFMgZXh0ZW5kcyBUID0gVD4ocGF5bG9hZDogUGF5bG9hZCwgb3B0aW9ucz86IElSZXN0T3B0aW9ucyk6IFByb21pc2U8Uz4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pbm5lclJlc3RTZXJ2aWNlLnNhdmUocGF5bG9hZCwgb3B0aW9ucyk7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gU3RyaXBSZXNwb25zZUhlYWRlcnMoXG4gICAgdGFyZ2V0OiBhbnksXG4gICAgcHJvcGVydHlOYW1lOiBzdHJpbmcsXG4gICAgZGVzY3JpcHRvcjogVHlwZWRQcm9wZXJ0eURlc2NyaXB0b3I8KC4uLng6IGFueVtdKSA9PiBhbnk+XG4pIHtcbiAgICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XG5cbiAgICBpZiAob3JpZ2luYWxNZXRob2QpIHtcbiAgICAgICAgZGVzY3JpcHRvci52YWx1ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsTWV0aG9kXG4gICAgICAgICAgICAgICAgLmFwcGx5KHRoaXMsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykpXG4gICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHJlc3BvbnNlLmhlYWRlcnM7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9XG59XG4iXX0=