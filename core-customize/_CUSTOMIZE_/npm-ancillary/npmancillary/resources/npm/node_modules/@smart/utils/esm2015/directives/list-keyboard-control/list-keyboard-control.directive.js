/**
 * Copyright (c) 2020 SAP SE or an SAP affiliate company. All rights reserved.
 * @module smartutils
 */
import * as tslib_1 from "tslib";
import { ContentChildren, Directive, EventEmitter, HostListener, Input, Output, QueryList } from '@angular/core';
import { ListItemKeyboardControlDirective } from './list-item-keyboard-control.directive';
export var KeyboardKey;
(function (KeyboardKey) {
    KeyboardKey["ArrowDown"] = "ArrowDown";
    KeyboardKey["ArrowUp"] = "ArrowUp";
    KeyboardKey["Enter"] = "Enter";
    KeyboardKey["Esc"] = "Escape";
})(KeyboardKey || (KeyboardKey = {}));
/**
 * Directive that manages the active option in a list of items based on keyboard interaction.
 * For disabled options, a predicate must be passed with `suListKeyboardControlDisabledPredicate`
 * which will prevent that option from navigating with arrow up / down key.
 *
 * Note: It will include only direct children having the `suListItemKeyboardControl` directive.
 *
 * @example
 * ```
 * items = [
 *   {
 *     id: 1,
 *     label: 'item 1'
 *   },
 *   {
 *     id: 2,
 *     label: 'item 2'
 *   },
 *   {
 *     id: 3,
 *     label: 'item 3'
 *   }
 * ]
 * <ul suListKeyboardControl>
 *   <li suListItemKeyboardControl *ngFor="let item of items">
 *     {{ item.label }}
 *   </li>
 * </ul>
 * ```
 */
let ListKeyboardControlDirective = class ListKeyboardControlDirective {
    /**
     * Directive that manages the active option in a list of items based on keyboard interaction.
     * For disabled options, a predicate must be passed with `suListKeyboardControlDisabledPredicate`
     * which will prevent that option from navigating with arrow up / down key.
     *
     * Note: It will include only direct children having the `suListItemKeyboardControl` directive.
     *
     * @example
     * ```
     * items = [
     *   {
     *     id: 1,
     *     label: 'item 1'
     *   },
     *   {
     *     id: 2,
     *     label: 'item 2'
     *   },
     *   {
     *     id: 3,
     *     label: 'item 3'
     *   }
     * ]
     * <ul suListKeyboardControl>
     *   <li suListItemKeyboardControl *ngFor="let item of items">
     *     {{ item.label }}
     *   </li>
     * </ul>
     * ```
     */
    constructor() {
        /** Whether the keyboard interaction is enabled */
        this.suListKeyboardControlEnabled = true;
        this.suListKeyboardControlEnterKeydown = new EventEmitter();
        this.suListKeyboardControlEscKeydown = new EventEmitter();
        /** @internal */
        this.didNgAfterContentInit = false;
        /** @internal */
        this.shouldSetActiveAfterContentInit = false;
        /** @internal */
        this.activeItem = null;
        /** @internal */
        this.activeItemIndex = null;
    }
    /** @internal */
    ngAfterContentInit() {
        this.items.changes.subscribe(() => {
            // handler for changes in content
            if (this.items.length === 0) {
                this.clearActiveItem();
                return;
            }
            if (this.suListKeyboardControlEnabled) {
                this.setActiveItemByIndex(0, 1);
            }
            else {
                this.clearActiveItem();
            }
        });
        if (this.shouldSetActiveAfterContentInit && this.items.length > 0) {
            this.setActiveItemByIndex(0, 1);
        }
        this.didNgAfterContentInit = true;
    }
    /** @internal */
    onKeyDown(event) {
        if (!this.suListKeyboardControlEnabled || this.items.length === 0) {
            return;
        }
        // For ArrowDown and ArrowUp prevent from scrolling the container.
        // Focus event is called when setting an active item so it will also scroll if needed.
        switch (event.key) {
            case KeyboardKey.ArrowDown:
                event.preventDefault();
                this.handleArrowDown();
                return;
            case KeyboardKey.ArrowUp:
                event.preventDefault();
                this.handleArrowUp();
                return;
            case KeyboardKey.Enter:
                event.preventDefault();
                this.handleEnter();
                return;
            case KeyboardKey.Esc:
                this.handleEsc();
                return;
        }
    }
    /** @internal */
    ngOnInit() {
        this.shouldSetActiveAfterContentInit = this.suListKeyboardControlEnabled;
    }
    /** @internal */
    ngOnChanges(changes) {
        if (!this.didNgAfterContentInit) {
            return;
        }
        const enabledChange = changes.suListKeyboardControlEnabled;
        const predicateChange = changes.suListKeyboardControlDisabledPredicate;
        const shouldSetActive = enabledChange && enabledChange.currentValue && !enabledChange.previousValue;
        const shouldUnsetActive = enabledChange && !enabledChange.currentValue && enabledChange.previousValue;
        const shouldSetActiveForPredicate = predicateChange && predicateChange.currentValue && !!this.suListKeyboardControlEnabled;
        const shouldUnsetActiveForPredicate = predicateChange &&
            !predicateChange.currentValue &&
            predicateChange.previousValue &&
            !!this.suListKeyboardControlEnabled;
        if (this.items.length === 0) {
            return;
        }
        if (shouldSetActive || shouldSetActiveForPredicate) {
            this.setFirstItemActive();
        }
        if (shouldUnsetActive || shouldUnsetActiveForPredicate) {
            this.unsetActiveItem();
        }
    }
    /** @internal */
    handleArrowUp() {
        this.setPreviousItemActive();
    }
    /** @internal */
    handleArrowDown() {
        this.setNextItemActive();
    }
    /** @internal */
    handleEnter() {
        this.suListKeyboardControlEnterKeydown.emit(this.activeItemIndex);
    }
    /** @internal */
    handleEsc() {
        this.suListKeyboardControlEscKeydown.emit();
    }
    /** @internal */
    getItemByIndex(index) {
        const items = this.getItemsArray();
        return items[index];
    }
    /** @internal */
    getItemsArray() {
        return this.items.toArray();
    }
    /** @internal */
    setActiveItemByIndex(index, delta) {
        const items = this.getItemsArray();
        if (this.suListKeyboardControlDisabledPredicate) {
            while (this.suListKeyboardControlDisabledPredicate(items[index], index)) {
                index += delta;
                if (!items[index]) {
                    return;
                }
            }
        }
        const item = this.getItemByIndex(index);
        this.setActiveItem(item);
    }
    /** @internal */
    setActiveItem(item) {
        const items = this.getItemsArray();
        const index = items.indexOf(item);
        if (this.activeItem) {
            this.activeItem.setInactive();
        }
        if (items.length > 0) {
            this.activeItem = items[index];
            this.activeItem.setActive();
            this.activeItemIndex = index;
        }
    }
    /** @internal */
    unsetActiveItem() {
        if (!this.activeItem) {
            return;
        }
        this.activeItem.setInactive();
        this.activeItemIndex = null;
    }
    /** @internal */
    setFirstItemActive() {
        this.setActiveItemByIndex(0, 1);
    }
    /** @internal */
    setNextItemActive() {
        if (this.activeItemIndex === null) {
            this.setFirstItemActive();
            return;
        }
        if (this.activeItemIndex < this.items.length - 1) {
            this.setActiveItemByIndex(this.activeItemIndex + 1, 1);
        }
    }
    /** @internal */
    setPreviousItemActive() {
        if (this.activeItemIndex === null) {
            this.setFirstItemActive();
            return;
        }
        if (this.activeItemIndex > 0) {
            this.setActiveItemByIndex(this.activeItemIndex - 1, -1);
        }
    }
    /** @internal */
    clearActiveItem() {
        this.activeItem = null;
        this.activeItemIndex = null;
    }
};
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], ListKeyboardControlDirective.prototype, "suListKeyboardControlEnabled", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Function)
], ListKeyboardControlDirective.prototype, "suListKeyboardControlDisabledPredicate", void 0);
tslib_1.__decorate([
    Output(),
    tslib_1.__metadata("design:type", Object)
], ListKeyboardControlDirective.prototype, "suListKeyboardControlEnterKeydown", void 0);
tslib_1.__decorate([
    Output(),
    tslib_1.__metadata("design:type", Object)
], ListKeyboardControlDirective.prototype, "suListKeyboardControlEscKeydown", void 0);
tslib_1.__decorate([
    ContentChildren(ListItemKeyboardControlDirective),
    tslib_1.__metadata("design:type", QueryList)
], ListKeyboardControlDirective.prototype, "items", void 0);
tslib_1.__decorate([
    HostListener('document:keydown', ['$event']),
    tslib_1.__metadata("design:type", Function),
    tslib_1.__metadata("design:paramtypes", [KeyboardEvent]),
    tslib_1.__metadata("design:returntype", void 0)
], ListKeyboardControlDirective.prototype, "onKeyDown", null);
ListKeyboardControlDirective = tslib_1.__decorate([
    Directive({
        selector: '[suListKeyboardControl]'
    })
], ListKeyboardControlDirective);
export { ListKeyboardControlDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC1rZXlib2FyZC1jb250cm9sLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzbWFydC91dGlscy8iLCJzb3VyY2VzIjpbImRpcmVjdGl2ZXMvbGlzdC1rZXlib2FyZC1jb250cm9sL2xpc3Qta2V5Ym9hcmQtY29udHJvbC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFFSCxlQUFlLEVBQ2YsU0FBUyxFQUNULFlBQVksRUFDWixZQUFZLEVBQ1osS0FBSyxFQUVMLE1BQU0sRUFDTixTQUFTLEVBRVosTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLGdDQUFnQyxFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFFMUYsTUFBTSxDQUFOLElBQVksV0FLWDtBQUxELFdBQVksV0FBVztJQUNuQixzQ0FBdUIsQ0FBQTtJQUN2QixrQ0FBbUIsQ0FBQTtJQUNuQiw4QkFBZSxDQUFBO0lBQ2YsNkJBQWMsQ0FBQTtBQUNsQixDQUFDLEVBTFcsV0FBVyxLQUFYLFdBQVcsUUFLdEI7QUFPRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0E2Qkc7QUFJSCxJQUFhLDRCQUE0QixHQUF6QyxNQUFhLDRCQUE0QjtJQWpDekM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O09BNkJHO0lBQ0g7UUFJSSxrREFBa0Q7UUFDekMsaUNBQTRCLEdBQUcsSUFBSSxDQUFDO1FBR25DLHNDQUFpQyxHQUFHLElBQUksWUFBWSxFQUFpQixDQUFDO1FBQ3RFLG9DQUErQixHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7UUFPckUsZ0JBQWdCO1FBQ1IsMEJBQXFCLEdBQUcsS0FBSyxDQUFDO1FBQ3RDLGdCQUFnQjtRQUNSLG9DQUErQixHQUFHLEtBQUssQ0FBQztRQUNoRCxnQkFBZ0I7UUFDUixlQUFVLEdBQTRDLElBQUksQ0FBQztRQUNuRSxnQkFBZ0I7UUFDUixvQkFBZSxHQUFrQixJQUFJLENBQUM7SUF5TWxELENBQUM7SUF2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dCxcbiAgICBDb250ZW50Q2hpbGRyZW4sXG4gICAgRGlyZWN0aXZlLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBIb3N0TGlzdGVuZXIsXG4gICAgSW5wdXQsXG4gICAgT25DaGFuZ2VzLFxuICAgIE91dHB1dCxcbiAgICBRdWVyeUxpc3QsXG4gICAgU2ltcGxlQ2hhbmdlc1xufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgTGlzdEl0ZW1LZXlib2FyZENvbnRyb2xEaXJlY3RpdmUgfSBmcm9tICcuL2xpc3QtaXRlbS1rZXlib2FyZC1jb250cm9sLmRpcmVjdGl2ZSc7XG5cbmV4cG9ydCBlbnVtIEtleWJvYXJkS2V5IHtcbiAgICBBcnJvd0Rvd24gPSAnQXJyb3dEb3duJyxcbiAgICBBcnJvd1VwID0gJ0Fycm93VXAnLFxuICAgIEVudGVyID0gJ0VudGVyJyxcbiAgICBFc2MgPSAnRXNjYXBlJ1xufVxuXG5leHBvcnQgdHlwZSBMaXN0S2V5Ym9hcmRDb250cm9sRGlzYWJsZWRQcmVkaWNhdGUgPSAoXG4gICAgaXRlbTogTGlzdEl0ZW1LZXlib2FyZENvbnRyb2xEaXJlY3RpdmUsXG4gICAgaW5kZXg6IG51bWJlclxuKSA9PiBib29sZWFuO1xuXG4vKipcbiAqIERpcmVjdGl2ZSB0aGF0IG1hbmFnZXMgdGhlIGFjdGl2ZSBvcHRpb24gaW4gYSBsaXN0IG9mIGl0ZW1zIGJhc2VkIG9uIGtleWJvYXJkIGludGVyYWN0aW9uLlxuICogRm9yIGRpc2FibGVkIG9wdGlvbnMsIGEgcHJlZGljYXRlIG11c3QgYmUgcGFzc2VkIHdpdGggYHN1TGlzdEtleWJvYXJkQ29udHJvbERpc2FibGVkUHJlZGljYXRlYFxuICogd2hpY2ggd2lsbCBwcmV2ZW50IHRoYXQgb3B0aW9uIGZyb20gbmF2aWdhdGluZyB3aXRoIGFycm93IHVwIC8gZG93biBrZXkuXG4gKlxuICogTm90ZTogSXQgd2lsbCBpbmNsdWRlIG9ubHkgZGlyZWN0IGNoaWxkcmVuIGhhdmluZyB0aGUgYHN1TGlzdEl0ZW1LZXlib2FyZENvbnRyb2xgIGRpcmVjdGl2ZS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgXG4gKiBpdGVtcyA9IFtcbiAqICAge1xuICogICAgIGlkOiAxLFxuICogICAgIGxhYmVsOiAnaXRlbSAxJ1xuICogICB9LFxuICogICB7XG4gKiAgICAgaWQ6IDIsXG4gKiAgICAgbGFiZWw6ICdpdGVtIDInXG4gKiAgIH0sXG4gKiAgIHtcbiAqICAgICBpZDogMyxcbiAqICAgICBsYWJlbDogJ2l0ZW0gMydcbiAqICAgfVxuICogXVxuICogPHVsIHN1TGlzdEtleWJvYXJkQ29udHJvbD5cbiAqICAgPGxpIHN1TGlzdEl0ZW1LZXlib2FyZENvbnRyb2wgKm5nRm9yPVwibGV0IGl0ZW0gb2YgaXRlbXNcIj5cbiAqICAgICB7eyBpdGVtLmxhYmVsIH19XG4gKiAgIDwvbGk+XG4gKiA8L3VsPlxuICogYGBgXG4gKi9cbkBEaXJlY3RpdmUoe1xuICAgIHNlbGVjdG9yOiAnW3N1TGlzdEtleWJvYXJkQ29udHJvbF0nXG59KVxuZXhwb3J0IGNsYXNzIExpc3RLZXlib2FyZENvbnRyb2xEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkNoYW5nZXMsIEFmdGVyQ29udGVudEluaXQge1xuICAgIC8qKiBXaGV0aGVyIHRoZSBrZXlib2FyZCBpbnRlcmFjdGlvbiBpcyBlbmFibGVkICovXG4gICAgQElucHV0KCkgc3VMaXN0S2V5Ym9hcmRDb250cm9sRW5hYmxlZCA9IHRydWU7XG4gICAgLyoqIFByZWRpY2F0ZSBjYWxsZWQgZm9yIGVhY2ggaXRlbS4gSWYgdHJ1ZSwgdGhlIGl0ZW0gd2lsbCBiZSBleGNsdWRlZCBmcm9tIGtleWJvYXJkIG5hdmlnYXRpb24gKi9cbiAgICBASW5wdXQoKSBzdUxpc3RLZXlib2FyZENvbnRyb2xEaXNhYmxlZFByZWRpY2F0ZT86IExpc3RLZXlib2FyZENvbnRyb2xEaXNhYmxlZFByZWRpY2F0ZTtcbiAgICBAT3V0cHV0KCkgc3VMaXN0S2V5Ym9hcmRDb250cm9sRW50ZXJLZXlkb3duID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXIgfCBudWxsPigpO1xuICAgIEBPdXRwdXQoKSBzdUxpc3RLZXlib2FyZENvbnRyb2xFc2NLZXlkb3duID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIEBDb250ZW50Q2hpbGRyZW4oTGlzdEl0ZW1LZXlib2FyZENvbnRyb2xEaXJlY3RpdmUpIGl0ZW1zITogUXVlcnlMaXN0PFxuICAgICAgICBMaXN0SXRlbUtleWJvYXJkQ29udHJvbERpcmVjdGl2ZVxuICAgID47XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBkaWROZ0FmdGVyQ29udGVudEluaXQgPSBmYWxzZTtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBzaG91bGRTZXRBY3RpdmVBZnRlckNvbnRlbnRJbml0ID0gZmFsc2U7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHByaXZhdGUgYWN0aXZlSXRlbTogTGlzdEl0ZW1LZXlib2FyZENvbnRyb2xEaXJlY3RpdmUgfCBudWxsID0gbnVsbDtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBhY3RpdmVJdGVtSW5kZXg6IG51bWJlciB8IG51bGwgPSBudWxsO1xuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICAgICAgdGhpcy5pdGVtcy5jaGFuZ2VzLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICAvLyBoYW5kbGVyIGZvciBjaGFuZ2VzIGluIGNvbnRlbnRcbiAgICAgICAgICAgIGlmICh0aGlzLml0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJBY3RpdmVJdGVtKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5zdUxpc3RLZXlib2FyZENvbnRyb2xFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVJdGVtQnlJbmRleCgwLCAxKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhckFjdGl2ZUl0ZW0oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkU2V0QWN0aXZlQWZ0ZXJDb250ZW50SW5pdCAmJiB0aGlzLml0ZW1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlSXRlbUJ5SW5kZXgoMCwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kaWROZ0FmdGVyQ29udGVudEluaXQgPSB0cnVlO1xuICAgIH1cblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDprZXlkb3duJywgWyckZXZlbnQnXSkgb25LZXlEb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5zdUxpc3RLZXlib2FyZENvbnRyb2xFbmFibGVkIHx8IHRoaXMuaXRlbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGb3IgQXJyb3dEb3duIGFuZCBBcnJvd1VwIHByZXZlbnQgZnJvbSBzY3JvbGxpbmcgdGhlIGNvbnRhaW5lci5cbiAgICAgICAgLy8gRm9jdXMgZXZlbnQgaXMgY2FsbGVkIHdoZW4gc2V0dGluZyBhbiBhY3RpdmUgaXRlbSBzbyBpdCB3aWxsIGFsc28gc2Nyb2xsIGlmIG5lZWRlZC5cbiAgICAgICAgc3dpdGNoIChldmVudC5rZXkpIHtcbiAgICAgICAgICAgIGNhc2UgS2V5Ym9hcmRLZXkuQXJyb3dEb3duOlxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVBcnJvd0Rvd24oKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjYXNlIEtleWJvYXJkS2V5LkFycm93VXA6XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUFycm93VXAoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjYXNlIEtleWJvYXJkS2V5LkVudGVyOlxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVFbnRlcigpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNhc2UgS2V5Ym9hcmRLZXkuRXNjOlxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRXNjKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLnNob3VsZFNldEFjdGl2ZUFmdGVyQ29udGVudEluaXQgPSB0aGlzLnN1TGlzdEtleWJvYXJkQ29udHJvbEVuYWJsZWQ7XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgaWYgKCF0aGlzLmRpZE5nQWZ0ZXJDb250ZW50SW5pdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZW5hYmxlZENoYW5nZSA9IGNoYW5nZXMuc3VMaXN0S2V5Ym9hcmRDb250cm9sRW5hYmxlZDtcbiAgICAgICAgY29uc3QgcHJlZGljYXRlQ2hhbmdlID0gY2hhbmdlcy5zdUxpc3RLZXlib2FyZENvbnRyb2xEaXNhYmxlZFByZWRpY2F0ZTtcblxuICAgICAgICBjb25zdCBzaG91bGRTZXRBY3RpdmUgPVxuICAgICAgICAgICAgZW5hYmxlZENoYW5nZSAmJiBlbmFibGVkQ2hhbmdlLmN1cnJlbnRWYWx1ZSAmJiAhZW5hYmxlZENoYW5nZS5wcmV2aW91c1ZhbHVlO1xuXG4gICAgICAgIGNvbnN0IHNob3VsZFVuc2V0QWN0aXZlID1cbiAgICAgICAgICAgIGVuYWJsZWRDaGFuZ2UgJiYgIWVuYWJsZWRDaGFuZ2UuY3VycmVudFZhbHVlICYmIGVuYWJsZWRDaGFuZ2UucHJldmlvdXNWYWx1ZTtcblxuICAgICAgICBjb25zdCBzaG91bGRTZXRBY3RpdmVGb3JQcmVkaWNhdGUgPVxuICAgICAgICAgICAgcHJlZGljYXRlQ2hhbmdlICYmIHByZWRpY2F0ZUNoYW5nZS5jdXJyZW50VmFsdWUgJiYgISF0aGlzLnN1TGlzdEtleWJvYXJkQ29udHJvbEVuYWJsZWQ7XG4gICAgICAgIGNvbnN0IHNob3VsZFVuc2V0QWN0aXZlRm9yUHJlZGljYXRlID1cbiAgICAgICAgICAgIHByZWRpY2F0ZUNoYW5nZSAmJlxuICAgICAgICAgICAgIXByZWRpY2F0ZUNoYW5nZS5jdXJyZW50VmFsdWUgJiZcbiAgICAgICAgICAgIHByZWRpY2F0ZUNoYW5nZS5wcmV2aW91c1ZhbHVlICYmXG4gICAgICAgICAgICAhIXRoaXMuc3VMaXN0S2V5Ym9hcmRDb250cm9sRW5hYmxlZDtcblxuICAgICAgICBpZiAodGhpcy5pdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzaG91bGRTZXRBY3RpdmUgfHwgc2hvdWxkU2V0QWN0aXZlRm9yUHJlZGljYXRlKSB7XG4gICAgICAgICAgICB0aGlzLnNldEZpcnN0SXRlbUFjdGl2ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNob3VsZFVuc2V0QWN0aXZlIHx8IHNob3VsZFVuc2V0QWN0aXZlRm9yUHJlZGljYXRlKSB7XG4gICAgICAgICAgICB0aGlzLnVuc2V0QWN0aXZlSXRlbSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHByaXZhdGUgaGFuZGxlQXJyb3dVcCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZXRQcmV2aW91c0l0ZW1BY3RpdmUoKTtcbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBoYW5kbGVBcnJvd0Rvd24oKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2V0TmV4dEl0ZW1BY3RpdmUoKTtcbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBoYW5kbGVFbnRlcigpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdUxpc3RLZXlib2FyZENvbnRyb2xFbnRlcktleWRvd24uZW1pdCh0aGlzLmFjdGl2ZUl0ZW1JbmRleCk7XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHByaXZhdGUgaGFuZGxlRXNjKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnN1TGlzdEtleWJvYXJkQ29udHJvbEVzY0tleWRvd24uZW1pdCgpO1xuICAgIH1cblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwcml2YXRlIGdldEl0ZW1CeUluZGV4KGluZGV4OiBudW1iZXIpOiBMaXN0SXRlbUtleWJvYXJkQ29udHJvbERpcmVjdGl2ZSB7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5nZXRJdGVtc0FycmF5KCk7XG4gICAgICAgIHJldHVybiBpdGVtc1tpbmRleF07XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHByaXZhdGUgZ2V0SXRlbXNBcnJheSgpOiBMaXN0SXRlbUtleWJvYXJkQ29udHJvbERpcmVjdGl2ZVtdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXRlbXMudG9BcnJheSgpO1xuICAgIH1cblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwcml2YXRlIHNldEFjdGl2ZUl0ZW1CeUluZGV4KGluZGV4OiBudW1iZXIsIGRlbHRhOiAtMSB8IDEpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLmdldEl0ZW1zQXJyYXkoKTtcblxuICAgICAgICBpZiAodGhpcy5zdUxpc3RLZXlib2FyZENvbnRyb2xEaXNhYmxlZFByZWRpY2F0ZSkge1xuICAgICAgICAgICAgd2hpbGUgKHRoaXMuc3VMaXN0S2V5Ym9hcmRDb250cm9sRGlzYWJsZWRQcmVkaWNhdGUoaXRlbXNbaW5kZXhdLCBpbmRleCkpIHtcbiAgICAgICAgICAgICAgICBpbmRleCArPSBkZWx0YTtcblxuICAgICAgICAgICAgICAgIGlmICghaXRlbXNbaW5kZXhdKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5nZXRJdGVtQnlJbmRleChpbmRleCk7XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlSXRlbShpdGVtKTtcbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBzZXRBY3RpdmVJdGVtKGl0ZW06IExpc3RJdGVtS2V5Ym9hcmRDb250cm9sRGlyZWN0aXZlKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5nZXRJdGVtc0FycmF5KCk7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gaXRlbXMuaW5kZXhPZihpdGVtKTtcblxuICAgICAgICBpZiAodGhpcy5hY3RpdmVJdGVtKSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUl0ZW0uc2V0SW5hY3RpdmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUl0ZW0gPSBpdGVtc1tpbmRleF07XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUl0ZW0uc2V0QWN0aXZlKCk7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUl0ZW1JbmRleCA9IGluZGV4O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHByaXZhdGUgdW5zZXRBY3RpdmVJdGVtKCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuYWN0aXZlSXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hY3RpdmVJdGVtLnNldEluYWN0aXZlKCk7XG4gICAgICAgIHRoaXMuYWN0aXZlSXRlbUluZGV4ID0gbnVsbDtcbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBzZXRGaXJzdEl0ZW1BY3RpdmUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlSXRlbUJ5SW5kZXgoMCwgMSk7XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHByaXZhdGUgc2V0TmV4dEl0ZW1BY3RpdmUoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmFjdGl2ZUl0ZW1JbmRleCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5zZXRGaXJzdEl0ZW1BY3RpdmUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmFjdGl2ZUl0ZW1JbmRleCA8IHRoaXMuaXRlbXMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVJdGVtQnlJbmRleCh0aGlzLmFjdGl2ZUl0ZW1JbmRleCArIDEsIDEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHByaXZhdGUgc2V0UHJldmlvdXNJdGVtQWN0aXZlKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5hY3RpdmVJdGVtSW5kZXggPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0Rmlyc3RJdGVtQWN0aXZlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5hY3RpdmVJdGVtSW5kZXggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW1CeUluZGV4KHRoaXMuYWN0aXZlSXRlbUluZGV4IC0gMSwgLTEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHByaXZhdGUgY2xlYXJBY3RpdmVJdGVtKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmFjdGl2ZUl0ZW0gPSBudWxsO1xuICAgICAgICB0aGlzLmFjdGl2ZUl0ZW1JbmRleCA9IG51bGw7XG4gICAgfVxufVxuIl19