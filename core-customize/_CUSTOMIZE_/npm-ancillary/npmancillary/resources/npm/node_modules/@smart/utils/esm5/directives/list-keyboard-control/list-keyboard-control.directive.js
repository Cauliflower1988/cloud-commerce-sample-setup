/**
 * Copyright (c) 2020 SAP SE or an SAP affiliate company. All rights reserved.
 * @module smartutils
 */
import * as tslib_1 from "tslib";
import { ContentChildren, Directive, EventEmitter, HostListener, Input, Output, QueryList } from '@angular/core';
import { ListItemKeyboardControlDirective } from './list-item-keyboard-control.directive';
export var KeyboardKey;
(function (KeyboardKey) {
    KeyboardKey["ArrowDown"] = "ArrowDown";
    KeyboardKey["ArrowUp"] = "ArrowUp";
    KeyboardKey["Enter"] = "Enter";
    KeyboardKey["Esc"] = "Escape";
})(KeyboardKey || (KeyboardKey = {}));
/**
 * Directive that manages the active option in a list of items based on keyboard interaction.
 * For disabled options, a predicate must be passed with `suListKeyboardControlDisabledPredicate`
 * which will prevent that option from navigating with arrow up / down key.
 *
 * Note: It will include only direct children having the `suListItemKeyboardControl` directive.
 *
 * @example
 * ```
 * items = [
 *   {
 *     id: 1,
 *     label: 'item 1'
 *   },
 *   {
 *     id: 2,
 *     label: 'item 2'
 *   },
 *   {
 *     id: 3,
 *     label: 'item 3'
 *   }
 * ]
 * <ul suListKeyboardControl>
 *   <li suListItemKeyboardControl *ngFor="let item of items">
 *     {{ item.label }}
 *   </li>
 * </ul>
 * ```
 */
var ListKeyboardControlDirective = /** @class */ (function () {
    function ListKeyboardControlDirective() {
        /** Whether the keyboard interaction is enabled */
        this.suListKeyboardControlEnabled = true;
        this.suListKeyboardControlEnterKeydown = new EventEmitter();
        this.suListKeyboardControlEscKeydown = new EventEmitter();
        /** @internal */
        this.didNgAfterContentInit = false;
        /** @internal */
        this.shouldSetActiveAfterContentInit = false;
        /** @internal */
        this.activeItem = null;
        /** @internal */
        this.activeItemIndex = null;
    }
    /** @internal */
    ListKeyboardControlDirective.prototype.ngAfterContentInit = function () {
        var _this = this;
        this.items.changes.subscribe(function () {
            // handler for changes in content
            if (_this.items.length === 0) {
                _this.clearActiveItem();
                return;
            }
            if (_this.suListKeyboardControlEnabled) {
                _this.setActiveItemByIndex(0, 1);
            }
            else {
                _this.clearActiveItem();
            }
        });
        if (this.shouldSetActiveAfterContentInit && this.items.length > 0) {
            this.setActiveItemByIndex(0, 1);
        }
        this.didNgAfterContentInit = true;
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.onKeyDown = function (event) {
        if (!this.suListKeyboardControlEnabled || this.items.length === 0) {
            return;
        }
        // For ArrowDown and ArrowUp prevent from scrolling the container.
        // Focus event is called when setting an active item so it will also scroll if needed.
        switch (event.key) {
            case KeyboardKey.ArrowDown:
                event.preventDefault();
                this.handleArrowDown();
                return;
            case KeyboardKey.ArrowUp:
                event.preventDefault();
                this.handleArrowUp();
                return;
            case KeyboardKey.Enter:
                event.preventDefault();
                this.handleEnter();
                return;
            case KeyboardKey.Esc:
                this.handleEsc();
                return;
        }
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.ngOnInit = function () {
        this.shouldSetActiveAfterContentInit = this.suListKeyboardControlEnabled;
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.ngOnChanges = function (changes) {
        if (!this.didNgAfterContentInit) {
            return;
        }
        var enabledChange = changes.suListKeyboardControlEnabled;
        var predicateChange = changes.suListKeyboardControlDisabledPredicate;
        var shouldSetActive = enabledChange && enabledChange.currentValue && !enabledChange.previousValue;
        var shouldUnsetActive = enabledChange && !enabledChange.currentValue && enabledChange.previousValue;
        var shouldSetActiveForPredicate = predicateChange && predicateChange.currentValue && !!this.suListKeyboardControlEnabled;
        var shouldUnsetActiveForPredicate = predicateChange &&
            !predicateChange.currentValue &&
            predicateChange.previousValue &&
            !!this.suListKeyboardControlEnabled;
        if (this.items.length === 0) {
            return;
        }
        if (shouldSetActive || shouldSetActiveForPredicate) {
            this.setFirstItemActive();
        }
        if (shouldUnsetActive || shouldUnsetActiveForPredicate) {
            this.unsetActiveItem();
        }
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.handleArrowUp = function () {
        this.setPreviousItemActive();
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.handleArrowDown = function () {
        this.setNextItemActive();
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.handleEnter = function () {
        this.suListKeyboardControlEnterKeydown.emit(this.activeItemIndex);
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.handleEsc = function () {
        this.suListKeyboardControlEscKeydown.emit();
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.getItemByIndex = function (index) {
        var items = this.getItemsArray();
        return items[index];
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.getItemsArray = function () {
        return this.items.toArray();
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.setActiveItemByIndex = function (index, delta) {
        var items = this.getItemsArray();
        if (this.suListKeyboardControlDisabledPredicate) {
            while (this.suListKeyboardControlDisabledPredicate(items[index], index)) {
                index += delta;
                if (!items[index]) {
                    return;
                }
            }
        }
        var item = this.getItemByIndex(index);
        this.setActiveItem(item);
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.setActiveItem = function (item) {
        var items = this.getItemsArray();
        var index = items.indexOf(item);
        if (this.activeItem) {
            this.activeItem.setInactive();
        }
        if (items.length > 0) {
            this.activeItem = items[index];
            this.activeItem.setActive();
            this.activeItemIndex = index;
        }
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.unsetActiveItem = function () {
        if (!this.activeItem) {
            return;
        }
        this.activeItem.setInactive();
        this.activeItemIndex = null;
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.setFirstItemActive = function () {
        this.setActiveItemByIndex(0, 1);
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.setNextItemActive = function () {
        if (this.activeItemIndex === null) {
            this.setFirstItemActive();
            return;
        }
        if (this.activeItemIndex < this.items.length - 1) {
            this.setActiveItemByIndex(this.activeItemIndex + 1, 1);
        }
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.setPreviousItemActive = function () {
        if (this.activeItemIndex === null) {
            this.setFirstItemActive();
            return;
        }
        if (this.activeItemIndex > 0) {
            this.setActiveItemByIndex(this.activeItemIndex - 1, -1);
        }
    };
    /** @internal */
    ListKeyboardControlDirective.prototype.clearActiveItem = function () {
        this.activeItem = null;
        this.activeItemIndex = null;
    };
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], ListKeyboardControlDirective.prototype, "suListKeyboardControlEnabled", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Function)
    ], ListKeyboardControlDirective.prototype, "suListKeyboardControlDisabledPredicate", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], ListKeyboardControlDirective.prototype, "suListKeyboardControlEnterKeydown", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], ListKeyboardControlDirective.prototype, "suListKeyboardControlEscKeydown", void 0);
    tslib_1.__decorate([
        ContentChildren(ListItemKeyboardControlDirective),
        tslib_1.__metadata("design:type", QueryList)
    ], ListKeyboardControlDirective.prototype, "items", void 0);
    tslib_1.__decorate([
        HostListener('document:keydown', ['$event']),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [KeyboardEvent]),
        tslib_1.__metadata("design:returntype", void 0)
    ], ListKeyboardControlDirective.prototype, "onKeyDown", null);
    ListKeyboardControlDirective = tslib_1.__decorate([
        Directive({
            selector: '[suListKeyboardControl]'
        })
    ], ListKeyboardControlDirective);
    return ListKeyboardControlDirective;
}());
export { ListKeyboardControlDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC1rZXlib2FyZC1jb250cm9sLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzbWFydC91dGlscy8iLCJzb3VyY2VzIjpbImRpcmVjdGl2ZXMvbGlzdC1rZXlib2FyZC1jb250cm9sL2xpc3Qta2V5Ym9hcmQtY29udHJvbC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFFSCxlQUFlLEVBQ2YsU0FBUyxFQUNULFlBQVksRUFDWixZQUFZLEVBQ1osS0FBSyxFQUVMLE1BQU0sRUFDTixTQUFTLEVBRVosTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLGdDQUFnQyxFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFFMUYsTUFBTSxDQUFOLElBQVksV0FLWDtBQUxELFdBQVksV0FBVztJQUNuQixzQ0FBdUIsQ0FBQTtJQUN2QixrQ0FBbUIsQ0FBQTtJQUNuQiw4QkFBZSxDQUFBO0lBQ2YsNkJBQWMsQ0FBQTtBQUNsQixDQUFDLEVBTFcsV0FBVyxLQUFYLFdBQVcsUUFLdEI7QUFPRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0E2Qkc7QUFJSDtJQUhBO1FBSUksa0RBQWtEO1FBQ3pDLGlDQUE0QixHQUFHLElBQUksQ0FBQztRQUduQyxzQ0FBaUMsR0FBRyxJQUFJLFlBQVksRUFBaUIsQ0FBQztRQUN0RSxvQ0FBK0IsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBT3JFLGdCQUFnQjtRQUNSLDBCQUFxQixHQUFHLEtBQUssQ0FBQztRQUN0QyxnQkFBZ0I7UUFDUixvQ0FBK0IsR0FBRyxLQUFLLENBQUM7UUFDaEQsZ0JBQWdCO1FBQ1IsZUFBVSxHQUE0QyxJQUFJLENBQUM7UUFDbkUsZ0JBQWdCO1FBQ1Isb0JBQWUsR0FBa0IsSUFBSSxDQUFDO0lBeU1sRCxDQUFDO0lBdk1HLGdCQUFnQjtJQUNoQix5REFBa0IsR0FBbEI7UUFBQSxpQkFtQkM7UUFsQkcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFP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NEJBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBBZnRlckNvbnRlbnRJbml0LFxuICAgIENvbnRlbnRDaGlsZHJlbixcbiAgICBEaXJlY3RpdmUsXG4gICAgRXZlbnRFbWl0dGVyLFxuICAgIEhvc3RMaXN0ZW5lcixcbiAgICBJbnB1dCxcbiAgICBPbkNoYW5nZXMsXG4gICAgT3V0cHV0LFxuICAgIFF1ZXJ5TGlzdCxcbiAgICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBMaXN0SXRlbUtleWJvYXJkQ29udHJvbERpcmVjdGl2ZSB9IGZyb20gJy4vbGlzdC1pdGVtLWtleWJvYXJkLWNvbnRyb2wuZGlyZWN0aXZlJztcblxuZXhwb3J0IGVudW0gS2V5Ym9hcmRLZXkge1xuICAgIEFycm93RG93biA9ICdBcnJvd0Rvd24nLFxuICAgIEFycm93VXAgPSAnQXJyb3dVcCcsXG4gICAgRW50ZXIgPSAnRW50ZXInLFxuICAgIEVzYyA9ICdFc2NhcGUnXG59XG5cbmV4cG9ydCB0eXBlIExpc3RLZXlib2FyZENvbnRyb2xEaXNhYmxlZFByZWRpY2F0ZSA9IChcbiAgICBpdGVtOiBMaXN0SXRlbUtleWJvYXJkQ29udHJvbERpcmVjdGl2ZSxcbiAgICBpbmRleDogbnVtYmVyXG4pID0+IGJvb2xlYW47XG5cbi8qKlxuICogRGlyZWN0aXZlIHRoYXQgbWFuYWdlcyB0aGUgYWN0aXZlIG9wdGlvbiBpbiBhIGxpc3Qgb2YgaXRlbXMgYmFzZWQgb24ga2V5Ym9hcmQgaW50ZXJhY3Rpb24uXG4gKiBGb3IgZGlzYWJsZWQgb3B0aW9ucywgYSBwcmVkaWNhdGUgbXVzdCBiZSBwYXNzZWQgd2l0aCBgc3VMaXN0S2V5Ym9hcmRDb250cm9sRGlzYWJsZWRQcmVkaWNhdGVgXG4gKiB3aGljaCB3aWxsIHByZXZlbnQgdGhhdCBvcHRpb24gZnJvbSBuYXZpZ2F0aW5nIHdpdGggYXJyb3cgdXAgLyBkb3duIGtleS5cbiAqXG4gKiBOb3RlOiBJdCB3aWxsIGluY2x1ZGUgb25seSBkaXJlY3QgY2hpbGRyZW4gaGF2aW5nIHRoZSBgc3VMaXN0SXRlbUtleWJvYXJkQ29udHJvbGAgZGlyZWN0aXZlLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBcbiAqIGl0ZW1zID0gW1xuICogICB7XG4gKiAgICAgaWQ6IDEsXG4gKiAgICAgbGFiZWw6ICdpdGVtIDEnXG4gKiAgIH0sXG4gKiAgIHtcbiAqICAgICBpZDogMixcbiAqICAgICBsYWJlbDogJ2l0ZW0gMidcbiAqICAgfSxcbiAqICAge1xuICogICAgIGlkOiAzLFxuICogICAgIGxhYmVsOiAnaXRlbSAzJ1xuICogICB9XG4gKiBdXG4gKiA8dWwgc3VMaXN0S2V5Ym9hcmRDb250cm9sPlxuICogICA8bGkgc3VMaXN0SXRlbUtleWJvYXJkQ29udHJvbCAqbmdGb3I9XCJsZXQgaXRlbSBvZiBpdGVtc1wiPlxuICogICAgIHt7IGl0ZW0ubGFiZWwgfX1cbiAqICAgPC9saT5cbiAqIDwvdWw+XG4gKiBgYGBcbiAqL1xuQERpcmVjdGl2ZSh7XG4gICAgc2VsZWN0b3I6ICdbc3VMaXN0S2V5Ym9hcmRDb250cm9sXSdcbn0pXG5leHBvcnQgY2xhc3MgTGlzdEtleWJvYXJkQ29udHJvbERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgQWZ0ZXJDb250ZW50SW5pdCB7XG4gICAgLyoqIFdoZXRoZXIgdGhlIGtleWJvYXJkIGludGVyYWN0aW9uIGlzIGVuYWJsZWQgKi9cbiAgICBASW5wdXQoKSBzdUxpc3RLZXlib2FyZENvbnRyb2xFbmFibGVkID0gdHJ1ZTtcbiAgICAvKiogUHJlZGljYXRlIGNhbGxlZCBmb3IgZWFjaCBpdGVtLiBJZiB0cnVlLCB0aGUgaXRlbSB3aWxsIGJlIGV4Y2x1ZGVkIGZyb20ga2V5Ym9hcmQgbmF2aWdhdGlvbiAqL1xuICAgIEBJbnB1dCgpIHN1TGlzdEtleWJvYXJkQ29udHJvbERpc2FibGVkUHJlZGljYXRlPzogTGlzdEtleWJvYXJkQ29udHJvbERpc2FibGVkUHJlZGljYXRlO1xuICAgIEBPdXRwdXQoKSBzdUxpc3RLZXlib2FyZENvbnRyb2xFbnRlcktleWRvd24gPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlciB8IG51bGw+KCk7XG4gICAgQE91dHB1dCgpIHN1TGlzdEtleWJvYXJkQ29udHJvbEVzY0tleWRvd24gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgQENvbnRlbnRDaGlsZHJlbihMaXN0SXRlbUtleWJvYXJkQ29udHJvbERpcmVjdGl2ZSkgaXRlbXMhOiBRdWVyeUxpc3Q8XG4gICAgICAgIExpc3RJdGVtS2V5Ym9hcmRDb250cm9sRGlyZWN0aXZlXG4gICAgPjtcblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwcml2YXRlIGRpZE5nQWZ0ZXJDb250ZW50SW5pdCA9IGZhbHNlO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwcml2YXRlIHNob3VsZFNldEFjdGl2ZUFmdGVyQ29udGVudEluaXQgPSBmYWxzZTtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBhY3RpdmVJdGVtOiBMaXN0SXRlbUtleWJvYXJkQ29udHJvbERpcmVjdGl2ZSB8IG51bGwgPSBudWxsO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwcml2YXRlIGFjdGl2ZUl0ZW1JbmRleDogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgICAgICB0aGlzLml0ZW1zLmNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIC8vIGhhbmRsZXIgZm9yIGNoYW5nZXMgaW4gY29udGVudFxuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhckFjdGl2ZUl0ZW0oKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnN1TGlzdEtleWJvYXJkQ29udHJvbEVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW1CeUluZGV4KDAsIDEpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyQWN0aXZlSXRlbSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAodGhpcy5zaG91bGRTZXRBY3RpdmVBZnRlckNvbnRlbnRJbml0ICYmIHRoaXMuaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVJdGVtQnlJbmRleCgwLCAxKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRpZE5nQWZ0ZXJDb250ZW50SW5pdCA9IHRydWU7XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50OmtleWRvd24nLCBbJyRldmVudCddKSBvbktleURvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLnN1TGlzdEtleWJvYXJkQ29udHJvbEVuYWJsZWQgfHwgdGhpcy5pdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZvciBBcnJvd0Rvd24gYW5kIEFycm93VXAgcHJldmVudCBmcm9tIHNjcm9sbGluZyB0aGUgY29udGFpbmVyLlxuICAgICAgICAvLyBGb2N1cyBldmVudCBpcyBjYWxsZWQgd2hlbiBzZXR0aW5nIGFuIGFjdGl2ZSBpdGVtIHNvIGl0IHdpbGwgYWxzbyBzY3JvbGwgaWYgbmVlZGVkLlxuICAgICAgICBzd2l0Y2ggKGV2ZW50LmtleSkge1xuICAgICAgICAgICAgY2FzZSBLZXlib2FyZEtleS5BcnJvd0Rvd246XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUFycm93RG93bigpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNhc2UgS2V5Ym9hcmRLZXkuQXJyb3dVcDpcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQXJyb3dVcCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNhc2UgS2V5Ym9hcmRLZXkuRW50ZXI6XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVudGVyKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgY2FzZSBLZXlib2FyZEtleS5Fc2M6XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVFc2MoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuc2hvdWxkU2V0QWN0aXZlQWZ0ZXJDb250ZW50SW5pdCA9IHRoaXMuc3VMaXN0S2V5Ym9hcmRDb250cm9sRW5hYmxlZDtcbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgICAgICBpZiAoIXRoaXMuZGlkTmdBZnRlckNvbnRlbnRJbml0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBlbmFibGVkQ2hhbmdlID0gY2hhbmdlcy5zdUxpc3RLZXlib2FyZENvbnRyb2xFbmFibGVkO1xuICAgICAgICBjb25zdCBwcmVkaWNhdGVDaGFuZ2UgPSBjaGFuZ2VzLnN1TGlzdEtleWJvYXJkQ29udHJvbERpc2FibGVkUHJlZGljYXRlO1xuXG4gICAgICAgIGNvbnN0IHNob3VsZFNldEFjdGl2ZSA9XG4gICAgICAgICAgICBlbmFibGVkQ2hhbmdlICYmIGVuYWJsZWRDaGFuZ2UuY3VycmVudFZhbHVlICYmICFlbmFibGVkQ2hhbmdlLnByZXZpb3VzVmFsdWU7XG5cbiAgICAgICAgY29uc3Qgc2hvdWxkVW5zZXRBY3RpdmUgPVxuICAgICAgICAgICAgZW5hYmxlZENoYW5nZSAmJiAhZW5hYmxlZENoYW5nZS5jdXJyZW50VmFsdWUgJiYgZW5hYmxlZENoYW5nZS5wcmV2aW91c1ZhbHVlO1xuXG4gICAgICAgIGNvbnN0IHNob3VsZFNldEFjdGl2ZUZvclByZWRpY2F0ZSA9XG4gICAgICAgICAgICBwcmVkaWNhdGVDaGFuZ2UgJiYgcHJlZGljYXRlQ2hhbmdlLmN1cnJlbnRWYWx1ZSAmJiAhIXRoaXMuc3VMaXN0S2V5Ym9hcmRDb250cm9sRW5hYmxlZDtcbiAgICAgICAgY29uc3Qgc2hvdWxkVW5zZXRBY3RpdmVGb3JQcmVkaWNhdGUgPVxuICAgICAgICAgICAgcHJlZGljYXRlQ2hhbmdlICYmXG4gICAgICAgICAgICAhcHJlZGljYXRlQ2hhbmdlLmN1cnJlbnRWYWx1ZSAmJlxuICAgICAgICAgICAgcHJlZGljYXRlQ2hhbmdlLnByZXZpb3VzVmFsdWUgJiZcbiAgICAgICAgICAgICEhdGhpcy5zdUxpc3RLZXlib2FyZENvbnRyb2xFbmFibGVkO1xuXG4gICAgICAgIGlmICh0aGlzLml0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNob3VsZFNldEFjdGl2ZSB8fCBzaG91bGRTZXRBY3RpdmVGb3JQcmVkaWNhdGUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0Rmlyc3RJdGVtQWN0aXZlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc2hvdWxkVW5zZXRBY3RpdmUgfHwgc2hvdWxkVW5zZXRBY3RpdmVGb3JQcmVkaWNhdGUpIHtcbiAgICAgICAgICAgIHRoaXMudW5zZXRBY3RpdmVJdGVtKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBoYW5kbGVBcnJvd1VwKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNldFByZXZpb3VzSXRlbUFjdGl2ZSgpO1xuICAgIH1cblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwcml2YXRlIGhhbmRsZUFycm93RG93bigpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZXROZXh0SXRlbUFjdGl2ZSgpO1xuICAgIH1cblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwcml2YXRlIGhhbmRsZUVudGVyKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnN1TGlzdEtleWJvYXJkQ29udHJvbEVudGVyS2V5ZG93bi5lbWl0KHRoaXMuYWN0aXZlSXRlbUluZGV4KTtcbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBoYW5kbGVFc2MoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3VMaXN0S2V5Ym9hcmRDb250cm9sRXNjS2V5ZG93bi5lbWl0KCk7XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHByaXZhdGUgZ2V0SXRlbUJ5SW5kZXgoaW5kZXg6IG51bWJlcik6IExpc3RJdGVtS2V5Ym9hcmRDb250cm9sRGlyZWN0aXZlIHtcbiAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLmdldEl0ZW1zQXJyYXkoKTtcbiAgICAgICAgcmV0dXJuIGl0ZW1zW2luZGV4XTtcbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBnZXRJdGVtc0FycmF5KCk6IExpc3RJdGVtS2V5Ym9hcmRDb250cm9sRGlyZWN0aXZlW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5pdGVtcy50b0FycmF5KCk7XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHByaXZhdGUgc2V0QWN0aXZlSXRlbUJ5SW5kZXgoaW5kZXg6IG51bWJlciwgZGVsdGE6IC0xIHwgMSk6IHZvaWQge1xuICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMuZ2V0SXRlbXNBcnJheSgpO1xuXG4gICAgICAgIGlmICh0aGlzLnN1TGlzdEtleWJvYXJkQ29udHJvbERpc2FibGVkUHJlZGljYXRlKSB7XG4gICAgICAgICAgICB3aGlsZSAodGhpcy5zdUxpc3RLZXlib2FyZENvbnRyb2xEaXNhYmxlZFByZWRpY2F0ZShpdGVtc1tpbmRleF0sIGluZGV4KSkge1xuICAgICAgICAgICAgICAgIGluZGV4ICs9IGRlbHRhO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFpdGVtc1tpbmRleF0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmdldEl0ZW1CeUluZGV4KGluZGV4KTtcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVJdGVtKGl0ZW0pO1xuICAgIH1cblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwcml2YXRlIHNldEFjdGl2ZUl0ZW0oaXRlbTogTGlzdEl0ZW1LZXlib2FyZENvbnRyb2xEaXJlY3RpdmUpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLmdldEl0ZW1zQXJyYXkoKTtcbiAgICAgICAgY29uc3QgaW5kZXggPSBpdGVtcy5pbmRleE9mKGl0ZW0pO1xuXG4gICAgICAgIGlmICh0aGlzLmFjdGl2ZUl0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlSXRlbS5zZXRJbmFjdGl2ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlSXRlbSA9IGl0ZW1zW2luZGV4XTtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlSXRlbS5zZXRBY3RpdmUoKTtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlSXRlbUluZGV4ID0gaW5kZXg7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSB1bnNldEFjdGl2ZUl0ZW0oKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5hY3RpdmVJdGVtKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmFjdGl2ZUl0ZW0uc2V0SW5hY3RpdmUoKTtcbiAgICAgICAgdGhpcy5hY3RpdmVJdGVtSW5kZXggPSBudWxsO1xuICAgIH1cblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwcml2YXRlIHNldEZpcnN0SXRlbUFjdGl2ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVJdGVtQnlJbmRleCgwLCAxKTtcbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBzZXROZXh0SXRlbUFjdGl2ZSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuYWN0aXZlSXRlbUluZGV4ID09PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLnNldEZpcnN0SXRlbUFjdGl2ZSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuYWN0aXZlSXRlbUluZGV4IDwgdGhpcy5pdGVtcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW1CeUluZGV4KHRoaXMuYWN0aXZlSXRlbUluZGV4ICsgMSwgMSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBzZXRQcmV2aW91c0l0ZW1BY3RpdmUoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmFjdGl2ZUl0ZW1JbmRleCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5zZXRGaXJzdEl0ZW1BY3RpdmUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmFjdGl2ZUl0ZW1JbmRleCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlSXRlbUJ5SW5kZXgodGhpcy5hY3RpdmVJdGVtSW5kZXggLSAxLCAtMSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHJpdmF0ZSBjbGVhckFjdGl2ZUl0ZW0oKTogdm9pZCB7XG4gICAgICAgIHRoaXMuYWN0aXZlSXRlbSA9IG51bGw7XG4gICAgICAgIHRoaXMuYWN0aXZlSXRlbUluZGV4ID0gbnVsbDtcbiAgICB9XG59XG4iXX0=