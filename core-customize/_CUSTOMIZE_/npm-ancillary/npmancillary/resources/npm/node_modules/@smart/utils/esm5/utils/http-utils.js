/**
 * Copyright (c) 2020 SAP SE or an SAP affiliate company. All rights reserved.
 * @module smartutils
 */
/**
 * Copyright (c) 2019 SAP SE or an SAP affiliate company. All rights reserved.
 * @module smartutils
 */
import * as lodash from 'lodash';
import { HttpErrorResponse, HttpParams, HttpResponse } from '@angular/common/http';
import { from, throwError, Observable } from 'rxjs';
import { switchMap } from 'rxjs/operators';
import { stringUtils } from './string-utils';
var HttpUtils = /** @class */ (function () {
    function HttpUtils() {
    }
    HttpUtils.prototype.isGET = function (request) {
        return request.method === 'GET';
    };
    HttpUtils.prototype.isRequestOfAccept = function (request, accept) {
        return (!!request.headers &&
            !!request.headers.get('Accept') &&
            (request.headers.get('Accept') || '').includes(accept));
    };
    HttpUtils.prototype.isResponseOfContentType = function (response, contentType) {
        return (!!response.headers &&
            !!response.headers.get('Content-type') &&
            (response.headers.get('Content-type') || '').indexOf(contentType) === 0);
    };
    HttpUtils.prototype.isHTMLRequest = function (request, response) {
        return (this.isGET(request) &&
            (this.isRequestOfAccept(request, 'text/html') ||
                /.+\.html$/.test(request.url) ||
                /.+\.html\?/.test(request.url)));
    };
    HttpUtils.prototype.isJSONRequest = function (request, response) {
        return (this.isGET(request) &&
            ((response && this.isResponseOfContentType(response, 'json')) ||
                /.+\.json$/.test(request.url)));
    };
    HttpUtils.prototype.isJSRequest = function (request) {
        return this.isGET(request) && /.+\.js$/.test(request.url);
    };
    HttpUtils.prototype.isCRUDRequest = function (request, response) {
        return (!this.isHTMLRequest(request, response) &&
            !this.isJSONRequest(request, response) &&
            !this.isJSRequest(request));
    };
    HttpUtils.prototype.transformHttpParams = function (params, substitutionMap) {
        return new HttpParams({
            fromObject: JSON.parse(stringUtils.replaceAll(JSON.stringify(this.copyHttpParamsOrHeaders(params)), substitutionMap))
        });
    };
    HttpUtils.prototype.copyHttpParamsOrHeaders = function (params) {
        var copy = {};
        params.keys().forEach(function (key) {
            var values = params.getAll(key);
            if (values !== null) {
                copy[key] = values.length > 1 ? values : values[0];
            }
        });
        return copy;
    };
    HttpUtils.prototype.buildHttpResponse = function (originalRequest, _statusAndPayload) {
        var statusAndPayloadPromise = Promise.resolve(_statusAndPayload);
        return from(statusAndPayloadPromise).pipe(switchMap(function (statusAndPayload) {
            var status = statusAndPayload[0];
            var body = statusAndPayload[1];
            var requestClone = originalRequest.clone({
                body: body
            });
            lodash.merge(requestClone, { status: status });
            if (200 <= status && status < 300) {
                return new Observable(function (ob) {
                    ob.next(new HttpResponse(requestClone));
                });
            }
            else {
                return throwError(new HttpErrorResponse(lodash.merge(requestClone, { error: body })));
            }
        }));
    };
    return HttpUtils;
}());
export { HttpUtils };
export var httpUtils = new HttpUtils();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC11dGlscy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzbWFydC91dGlscy8iLCJzb3VyY2VzIjpbInV0aWxzL2h0dHAtdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztHQUdHO0FBQ0gsT0FBTyxLQUFLLE1BQU0sTUFBTSxRQUFRLENBQUM7QUFDakMsT0FBTyxFQUNILGlCQUFpQixFQUdqQixVQUFVLEVBRVYsWUFBWSxFQUVmLE1BQU0sc0JBQXNCLENBQUM7QUFDOUIsT0FBTyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3BELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFN0M7SUFBQTtJQXFHQSxDQUFDO0lBcEdHLHlCQUFLLEdBQUwsVUFBTSxPQUF5QjtRQUMzQixPQUFPLE9BQU8sQ0FBQyxNQUFNLEtBQUssS0FBSyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxxQ0FBaUIsR0FBakIsVUFBa0IsT0FBeUIsRUFBRSxNQUFjO1FBQ3ZELE9BQU8sQ0FDSCxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU87WUFDakIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQztZQUMvQixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FDekQsQ0FBQztJQUNOLENBQUM7SUFFRCwyQ0FBdUIsR0FBdkIsVUFBd0IsUUFBMEIsRUFBRSxXQUFtQjtRQUNuRSxPQUFPLENBQ0gsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxPQUFPO1lBQ2xCLENBQUMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUM7WUFDdEMsQ0FBQyxRQUFRLENBQUMsT0FB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Q2pDLElBQU0sWUFBWSxHQUFHLGVBQWUsQ0FBQyxLQUFLLENBQUM7Z0JBQ3ZDLElBQUksTUFBQTthQUNQLENBQUMsQ0FBQztZQUNILE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLEVBQUUsTUFBTSxRQUFBLEVBQUUsQ0FBQyxDQUFDO1lBRXZDLElBQUksR0FBRyxJQUFJLE1BQU0sSUFBSSxNQUFNLEdBQUcsR0FBRyxFQUFFO2dCQUMvQixPQUFPLElBQUksVUFBVSxDQUFpQixVQUFDLEVBQUU7b0JBQ3JDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxZQUFZLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztnQkFDNUMsQ0FBQyxDQUFDLENBQUM7YUFDTjtpQkFBTTtnQkFDSCxPQUFPLFVBQVUsQ0FDYixJQUFJLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FDckUsQ0FBQzthQUNMO1FBQ0wsQ0FBQyxDQUFDLENBQ0wsQ0FBQztJQUNOLENBQUM7SUFDTCxnQkFBQztBQUFELENBQUMsQUFyR0QsSUFxR0M7O0FBRUQsTUFBTSxDQUFDLElBQU0sU0FBUyxHQUFHLElBQUksU0FBUyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxOSBTQVAgU0Ugb3IgYW4gU0FQIGFmZmlsaWF0ZSBjb21wYW55LiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogQG1vZHVsZSBzbWFydHV0aWxzXG4gKi9cbmltcG9ydCAqIGFzIGxvZGFzaCBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHtcbiAgICBIdHRwRXJyb3JSZXNwb25zZSxcbiAgICBIdHRwRXZlbnQsXG4gICAgSHR0cEhlYWRlcnMsXG4gICAgSHR0cFBhcmFtcyxcbiAgICBIdHRwUmVxdWVzdCxcbiAgICBIdHRwUmVzcG9uc2UsXG4gICAgSHR0cFJlc3BvbnNlQmFzZVxufSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBmcm9tLCB0aHJvd0Vycm9yLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBQYXlsb2FkLCBUeXBlZE1hcCB9IGZyb20gJy4uL2R0b3MnO1xuaW1wb3J0IHsgc3RyaW5nVXRpbHMgfSBmcm9tICcuL3N0cmluZy11dGlscyc7XG5cbmV4cG9ydCBjbGFzcyBIdHRwVXRpbHMge1xuICAgIGlzR0VUKHJlcXVlc3Q6IEh0dHBSZXF1ZXN0PGFueT4pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHJlcXVlc3QubWV0aG9kID09PSAnR0VUJztcbiAgICB9XG5cbiAgICBpc1JlcXVlc3RPZkFjY2VwdChyZXF1ZXN0OiBIdHRwUmVxdWVzdDxhbnk+LCBhY2NlcHQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgISFyZXF1ZXN0LmhlYWRlcnMgJiZcbiAgICAgICAgICAgICEhcmVxdWVzdC5oZWFkZXJzLmdldCgnQWNjZXB0JykgJiZcbiAgICAgICAgICAgIChyZXF1ZXN0LmhlYWRlcnMuZ2V0KCdBY2NlcHQnKSB8fCAnJykuaW5jbHVkZXMoYWNjZXB0KVxuICAgICAgICApO1xuICAgIH1cblxuICAgIGlzUmVzcG9uc2VPZkNvbnRlbnRUeXBlKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2VCYXNlLCBjb250ZW50VHlwZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAhIXJlc3BvbnNlLmhlYWRlcnMgJiZcbiAgICAgICAgICAgICEhcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtdHlwZScpICYmXG4gICAgICAgICAgICAocmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtdHlwZScpIHx8ICcnKS5pbmRleE9mKGNvbnRlbnRUeXBlKSA9PT0gMFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGlzSFRNTFJlcXVlc3QocmVxdWVzdDogSHR0cFJlcXVlc3Q8YW55PiwgcmVzcG9uc2U/OiBIdHRwUmVzcG9uc2VCYXNlKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICB0aGlzLmlzR0VUKHJlcXVlc3QpICYmXG4gICAgICAgICAgICAodGhpcy5pc1JlcXVlc3RPZkFjY2VwdChyZXF1ZXN0LCAndGV4dC9odG1sJykgfHxcbiAgICAgICAgICAgICAgICAvLitcXC5odG1sJC8udGVzdChyZXF1ZXN0LnVybCkgfHxcbiAgICAgICAgICAgICAgICAvLitcXC5odG1sXFw/Ly50ZXN0KHJlcXVlc3QudXJsKSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBpc0pTT05SZXF1ZXN0KHJlcXVlc3Q6IEh0dHBSZXF1ZXN0PGFueT4sIHJlc3BvbnNlPzogSHR0cFJlc3BvbnNlQmFzZSkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgdGhpcy5pc0dFVChyZXF1ZXN0KSAmJlxuICAgICAgICAgICAgKChyZXNwb25zZSAmJiB0aGlzLmlzUmVzcG9uc2VPZkNvbnRlbnRUeXBlKHJlc3BvbnNlLCAnanNvbicpKSB8fFxuICAgICAgICAgICAgICAgIC8uK1xcLmpzb24kLy50ZXN0KHJlcXVlc3QudXJsKSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBpc0pTUmVxdWVzdChyZXF1ZXN0OiBIdHRwUmVxdWVzdDxhbnk+KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzR0VUKHJlcXVlc3QpICYmIC8uK1xcLmpzJC8udGVzdChyZXF1ZXN0LnVybCk7XG4gICAgfVxuXG4gICAgaXNDUlVEUmVxdWVzdChyZXF1ZXN0OiBIdHRwUmVxdWVzdDxhbnk+LCByZXNwb25zZT86IEh0dHBFcnJvclJlc3BvbnNlKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAhdGhpcy5pc0hUTUxSZXF1ZXN0KHJlcXVlc3QsIHJlc3BvbnNlKSAmJlxuICAgICAgICAgICAgIXRoaXMuaXNKU09OUmVxdWVzdChyZXF1ZXN0LCByZXNwb25zZSkgJiZcbiAgICAgICAgICAgICF0aGlzLmlzSlNSZXF1ZXN0KHJlcXVlc3QpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgdHJhbnNmb3JtSHR0cFBhcmFtcyhwYXJhbXM6IEh0dHBQYXJhbXMsIHN1YnN0aXR1dGlvbk1hcDogVHlwZWRNYXA8c3RyaW5nPik6IEh0dHBQYXJhbXMge1xuICAgICAgICByZXR1cm4gbmV3IEh0dHBQYXJhbXMoe1xuICAgICAgICAgICAgZnJvbU9iamVjdDogSlNPTi5wYXJzZShcbiAgICAgICAgICAgICAgICBzdHJpbmdVdGlscy5yZXBsYWNlQWxsKFxuICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLmNvcHlIdHRwUGFyYW1zT3JIZWFkZXJzKHBhcmFtcykpLFxuICAgICAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb25NYXBcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvcHlIdHRwUGFyYW1zT3JIZWFkZXJzKHBhcmFtczogSHR0cFBhcmFtcyB8IEh0dHBIZWFkZXJzKTogVHlwZWRNYXA8c3RyaW5nIHwgc3RyaW5nW10+IHtcbiAgICAgICAgY29uc3QgY29weSA9IHt9IGFzIFR5cGVkTWFwPHN0cmluZyB8IHN0cmluZ1tdPjtcbiAgICAgICAgcGFyYW1zLmtleXMoKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IHBhcmFtcy5nZXRBbGwoa2V5KTtcbiAgICAgICAgICAgIGlmICh2YWx1ZXMgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb3B5W2tleV0gPSB2YWx1ZXMubGVuZ3RoID4gMSA/IHZhbHVlcyA6IHZhbHVlc1swXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjb3B5O1xuICAgIH1cblxuICAgIGJ1aWxkSHR0cFJlc3BvbnNlPFQgPSBhbnk+KFxuICAgICAgICBvcmlnaW5hbFJlcXVlc3Q6IEh0dHBSZXF1ZXN0PFQ+LFxuICAgICAgICBfc3RhdHVzQW5kUGF5bG9hZDpcbiAgICAgICAgICAgIHwgW251bWJlciwgUGF5bG9hZCB8IFBheWxvYWRbXV1cbiAgICAgICAgICAgIHwgUHJvbWlzZUxpa2U8W251bWJlciwgUGF5bG9hZCB8IFBheWxvYWRbXV0+XG4gICAgKTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8YW55PiB8IG5ldmVyPiB7XG4gICAgICAgIGNvbnN0IHN0YXR1c0FuZFBheWxvYWRQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKF9zdGF0dXNBbmRQYXlsb2FkKTtcblxuICAgICAgICByZXR1cm4gZnJvbShzdGF0dXNBbmRQYXlsb2FkUHJvbWlzZSkucGlwZShcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoc3RhdHVzQW5kUGF5bG9hZDogW251bWJlciwgUGF5bG9hZCB8IFBheWxvYWRbXV0pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBzdGF0dXNBbmRQYXlsb2FkWzBdO1xuICAgICAgICAgICAgICAgIGNvbnN0IGJvZHkgPSBzdGF0dXNBbmRQYXlsb2FkWzFdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RDbG9uZSA9IG9yaWdpbmFsUmVxdWVzdC5jbG9uZSh7XG4gICAgICAgICAgICAgICAgICAgIGJvZHlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBsb2Rhc2gubWVyZ2UocmVxdWVzdENsb25lLCB7IHN0YXR1cyB9KTtcblxuICAgICAgICAgICAgICAgIGlmICgyMDAgPD0gc3RhdHVzICYmIHN0YXR1cyA8IDMwMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGU8SHR0cEV2ZW50PGFueT4+KChvYikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2IubmV4dChuZXcgSHR0cFJlc3BvbnNlKHJlcXVlc3RDbG9uZSkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhyb3dFcnJvcihcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBIdHRwRXJyb3JSZXNwb25zZShsb2Rhc2gubWVyZ2UocmVxdWVzdENsb25lLCB7IGVycm9yOiBib2R5IH0pKVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgaHR0cFV0aWxzID0gbmV3IEh0dHBVdGlscygpO1xuIl19