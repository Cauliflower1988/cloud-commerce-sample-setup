/**
 * Copyright (c) 2020 SAP SE or an SAP affiliate company. All rights reserved.
 * @module smartutils
 */
import * as tslib_1 from "tslib";
/**
 * Copyright (c) 2019 SAP SE or an SAP affiliate company. All rights reserved.
 * @module smartutils
 */
/*
 * Copyright (c) 2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
import * as lodash from 'lodash';
import { Injectable } from '@angular/core';
import { of, BehaviorSubject } from 'rxjs';
import { ModalRef } from '@fundamental-ngx/core';
import { FundamentalModalButtonAction } from '../../interfaces';
var FundamentalModalManagerService = /** @class */ (function () {
    function FundamentalModalManagerService(modalRef) {
        this.modalRef = modalRef;
        this.title = new BehaviorSubject('');
        this.titleSuffix = new BehaviorSubject('');
        this.modalData = new BehaviorSubject({});
        this.component = new BehaviorSubject({});
        this.isDismissButtonVisible = new BehaviorSubject(true);
        this.buttons = new BehaviorSubject([]);
    }
    FundamentalModalManagerService.prototype.init = function () {
        this.modalData.next(this.modalRef.data.modalData);
        this.component.next(this.modalRef.data.component);
        this.buttons.next(this.modalRef.data.templateConfig.buttons || []);
        this.title.next(this.modalRef.data.templateConfig.title);
        this.titleSuffix.next(this.modalRef.data.templateConfig.titleSuffix);
        this.isDismissButtonVisible.next(this.modalRef.data.templateConfig.isDismissButtonVisible);
    };
    // getters
    FundamentalModalManagerService.prototype.getComponent = function () {
        return this.component.asObservable();
    };
    FundamentalModalManagerService.prototype.getTitle = function () {
        return this.title.asObservable();
    };
    FundamentalModalManagerService.prototype.getTitleSuffix = function () {
        return this.titleSuffix.asObservable();
    };
    FundamentalModalManagerService.prototype.getButtons = function () {
        return this.buttons.asObservable();
    };
    FundamentalModalManagerService.prototype.getModalData = function () {
        return this.modalData.asObservable();
    };
    FundamentalModalManagerService.prototype.getIsDismissButtonVisible = function () {
        return this.isDismissButtonVisible.asObservable();
    };
    // header dismiss button
    FundamentalModalManagerService.prototype.setDismissButtonVisibility = function (isVisible) {
        this.isDismissButtonVisible.next(isVisible);
    };
    // title
    FundamentalModalManagerService.prototype.setTitle = function (title) {
        this.title.next(title);
    };
    // buttons
    FundamentalModalManagerService.prototype.addButton = function (button) {
        this.buttons.next(tslib_1.__spread(this.buttons.value, [button]));
    };
    FundamentalModalManagerService.prototype.removeButton = function (id) {
        this.buttons.next(this.buttons.value.filter(function (button) { return button.id !== id; }));
    };
    FundamentalModalManagerService.prototype.removeAllButtons = function () {
        this.buttons.next([]);
    };
    FundamentalModalManagerService.prototype.disableButton = function (id) {
        this.buttons.next(this.buttons.value.map(function (button) {
            return button.id === id ? tslib_1.__assign({}, button, { disabled: true }) : button;
        }));
    };
    FundamentalModalManagerService.prototype.setDismissCallback = function (callback) {
        this.dismissCallback = callback;
    };
    FundamentalModalManagerService.prototype.enableButton = function (id) {
        this.buttons.next(this.buttons.value.map(function (button) {
            return button.id === id ? tslib_1.__assign({}, button, { disabled: false }) : button;
        }));
    };
    FundamentalModalManagerService.prototype.onButtonClicked = function (button) {
        var _this = this;
        var callbackReturnedObservable = button.callback
            ? button.callback()
            : of(null);
        if (button.action !== FundamentalModalButtonAction.None) {
            callbackReturnedObservable.subscribe(function (data) {
                return button.action === FundamentalModalButtonAction.Close
                    ? _this.close(data)
                    : _this.dismiss(data);
            });
        }
    };
    FundamentalModalManagerService.prototype.close = function (data) {
        this.modalRef.close(data);
    };
    FundamentalModalManagerService.prototype.dismiss = function (data) {
        var _this = this;
        this.dismissCallback()
            .then(function () { return _this.modalRef.dismiss(data); })
            .catch(lodash.noop);
    };
    FundamentalModalManagerService.prototype.dismissCallback = function () {
        return Promise.resolve();
    };
    FundamentalModalManagerService.ctorParameters = function () { return [
        { type: ModalRef }
    ]; };
    FundamentalModalManagerService = tslib_1.__decorate([
        Injectable(),
        tslib_1.__metadata("design:paramtypes", [ModalRef])
    ], FundamentalModalManagerService);
    return FundamentalModalManagerService;
}());
export { FundamentalModalManagerService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwtbWFuYWdlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHNtYXJ0L3V0aWxzLyIsInNvdXJjZXMiOlsic2VydmljZXMvbW9kYWwvbW9kYWwtbWFuYWdlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7QUFDSDs7R0FFRztBQUNILE9BQU8sS0FBSyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBQ2pDLE9BQU8sRUFBRSxVQUFVLEVBQVEsTUFBTSxlQUFlLENBQUM7QUFDakQsT0FBTyxFQUFFLEVBQUUsRUFBRSxlQUFlLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFDdkQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2pELE9BQU8sRUFBRSw0QkFBNEIsRUFBa0MsTUFBTSxrQkFBa0IsQ0FBQztBQUdoRztJQVVJLHdDQUFvQixRQUFrQjtRQUFsQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBVDlCLFVBQUssR0FBNEIsSUFBSSxlQUFlLENBQVMsRUFBRSxDQUFDLENBQUM7UUFDakUsZ0JBQVcsR0FBNEIsSUFBSSxlQUFlLENBQVMsRUFBRSxDQUFDLENBQUM7UUFDdkUsY0FBUyxHQUF5QixJQUFJLGVBQWUsQ0FBTSxFQUFFLENBQUMsQ0FBQztRQUMvRCxjQUFTLEdBQStCLElBQUksZUFBZSxDQUFZLEVBQWUsQ0FBQyxDQUFDO1FBQ3hGLDJCQUFzQixHQUE2QixJQUFJLGVBQWUsQ0FBVSxJQUFJLENBQUMsQ0FBQztRQUN0RixZQUFPLEdBQXNELElBQUksZUFBZSxDQUV0RixFQUFFLENBQUMsQ0FBQztJQUVtQyxDQUFDO0lBRW5DLDZDQUFJLEdBQVg7UUFDSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNsRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElB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Q0FBQzthQUN2QyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFTyx3REFBZSxHQUF2QjtRQUNJLE9BQU8sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQzdCLENBQUM7O2dCQTlHNkIsUUFBUTs7SUFWN0IsOEJBQThCO1FBRDFDLFVBQVUsRUFBRTtpREFXcUIsUUFBUTtPQVY3Qiw4QkFBOEIsQ0F5SDFDO0lBQUQscUNBQUM7Q0FBQSxBQXpIRCxJQXlIQztTQXpIWSw4QkFBOEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxOSBTQVAgU0Ugb3IgYW4gU0FQIGFmZmlsaWF0ZSBjb21wYW55LiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogQG1vZHVsZSBzbWFydHV0aWxzXG4gKi9cbi8qXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTkgU0FQIFNFIG9yIGFuIFNBUCBhZmZpbGlhdGUgY29tcGFueS4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqL1xuaW1wb3J0ICogYXMgbG9kYXNoIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBJbmplY3RhYmxlLCBUeXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBvZiwgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBNb2RhbFJlZiB9IGZyb20gJ0BmdW5kYW1lbnRhbC1uZ3gvY29yZSc7XG5pbXBvcnQgeyBGdW5kYW1lbnRhbE1vZGFsQnV0dG9uQWN0aW9uLCBJRnVuZGFtZW50YWxNb2RhbEJ1dHRvbk9wdGlvbnMgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEZ1bmRhbWVudGFsTW9kYWxNYW5hZ2VyU2VydmljZSB7XG4gICAgcHJpdmF0ZSB0aXRsZTogQmVoYXZpb3JTdWJqZWN0PHN0cmluZz4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PHN0cmluZz4oJycpO1xuICAgIHByaXZhdGUgdGl0bGVTdWZmaXg6IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+KCcnKTtcbiAgICBwcml2YXRlIG1vZGFsRGF0YTogQmVoYXZpb3JTdWJqZWN0PGFueT4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGFueT4oe30pO1xuICAgIHByaXZhdGUgY29tcG9uZW50OiBCZWhhdmlvclN1YmplY3Q8VHlwZTxhbnk+PiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8VHlwZTxhbnk+Pih7fSBhcyBUeXBlPGFueT4pO1xuICAgIHByaXZhdGUgaXNEaXNtaXNzQnV0dG9uVmlzaWJsZTogQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPih0cnVlKTtcbiAgICBwcml2YXRlIGJ1dHRvbnM6IEJlaGF2aW9yU3ViamVjdDxJRnVuZGFtZW50YWxNb2RhbEJ1dHRvbk9wdGlvbnNbXT4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFxuICAgICAgICBJRnVuZGFtZW50YWxNb2RhbEJ1dHRvbk9wdGlvbnNbXVxuICAgID4oW10pO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBtb2RhbFJlZjogTW9kYWxSZWYpIHt9XG5cbiAgICBwdWJsaWMgaW5pdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5tb2RhbERhdGEubmV4dCh0aGlzLm1vZGFsUmVmLmRhdGEubW9kYWxEYXRhKTtcbiAgICAgICAgdGhpcy5jb21wb25lbnQubmV4dCh0aGlzLm1vZGFsUmVmLmRhdGEuY29tcG9uZW50KTtcbiAgICAgICAgdGhpcy5idXR0b25zLm5leHQodGhpcy5tb2RhbFJlZi5kYXRhLnRlbXBsYXRlQ29uZmlnLmJ1dHRvbnMgfHwgW10pO1xuICAgICAgICB0aGlzLnRpdGxlLm5leHQodGhpcy5tb2RhbFJlZi5kYXRhLnRlbXBsYXRlQ29uZmlnLnRpdGxlKTtcbiAgICAgICAgdGhpcy50aXRsZVN1ZmZpeC5uZXh0KHRoaXMubW9kYWxSZWYuZGF0YS50ZW1wbGF0ZUNvbmZpZy50aXRsZVN1ZmZpeCk7XG4gICAgICAgIHRoaXMuaXNEaXNtaXNzQnV0dG9uVmlzaWJsZS5uZXh0KHRoaXMubW9kYWxSZWYuZGF0YS50ZW1wbGF0ZUNvbmZpZy5pc0Rpc21pc3NCdXR0b25WaXNpYmxlKTtcbiAgICB9XG5cbiAgICAvLyBnZXR0ZXJzXG5cbiAgICBwdWJsaWMgZ2V0Q29tcG9uZW50KCk6IE9ic2VydmFibGU8VHlwZTxhbnk+PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudC5hc09ic2VydmFibGUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0VGl0bGUoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGl0bGUuYXNPYnNlcnZhYmxlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFRpdGxlU3VmZml4KCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgICAgIHJldHVybiB0aGlzLnRpdGxlU3VmZml4LmFzT2JzZXJ2YWJsZSgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRCdXR0b25zKCk6IE9ic2VydmFibGU8SUZ1bmRhbWVudGFsTW9kYWxCdXR0b25PcHRpb25zW10+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnV0dG9ucy5hc09ic2VydmFibGUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0TW9kYWxEYXRhKCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vZGFsRGF0YS5hc09ic2VydmFibGUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0SXNEaXNtaXNzQnV0dG9uVmlzaWJsZSgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNEaXNtaXNzQnV0dG9uVmlzaWJsZS5hc09ic2VydmFibGUoKTtcbiAgICB9XG5cbiAgICAvLyBoZWFkZXIgZGlzbWlzcyBidXR0b25cblxuICAgIHB1YmxpYyBzZXREaXNtaXNzQnV0dG9uVmlzaWJpbGl0eShpc1Zpc2libGU6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5pc0Rpc21pc3NCdXR0b25WaXNpYmxlLm5leHQoaXNWaXNpYmxlKTtcbiAgICB9XG5cbiAgICAvLyB0aXRsZVxuXG4gICAgcHVibGljIHNldFRpdGxlKHRpdGxlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50aXRsZS5uZXh0KHRpdGxlKTtcbiAgICB9XG4gICAgLy8gYnV0dG9uc1xuXG4gICAgcHVibGljIGFkZEJ1dHRvbihidXR0b246IElGdW5kYW1lbnRhbE1vZGFsQnV0dG9uT3B0aW9ucyk6IHZvaWQge1xuICAgICAgICB0aGlzLmJ1dHRvbnMubmV4dChbLi4udGhpcy5idXR0b25zLnZhbHVlLCBidXR0b25dKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVtb3ZlQnV0dG9uKGlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5idXR0b25zLm5leHQoXG4gICAgICAgICAgICB0aGlzLmJ1dHRvbnMudmFsdWUuZmlsdGVyKChidXR0b246IElGdW5kYW1lbnRhbE1vZGFsQnV0dG9uT3B0aW9ucykgPT4gYnV0dG9uLmlkICE9PSBpZClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVtb3ZlQWxsQnV0dG9ucygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5idXR0b25zLm5leHQoW10pO1xuICAgIH1cblxuICAgIHB1YmxpYyBkaXNhYmxlQnV0dG9uKGlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5idXR0b25zLm5leHQoXG4gICAgICAgICAgICB0aGlzLmJ1dHRvbnMudmFsdWUubWFwKChidXR0b246IElGdW5kYW1lbnRhbE1vZGFsQnV0dG9uT3B0aW9ucykgPT5cbiAgICAgICAgICAgICAgICBidXR0b24uaWQgPT09IGlkID8geyAuLi5idXR0b24sIGRpc2FibGVkOiB0cnVlIH0gOiBidXR0b25cbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0RGlzbWlzc0NhbGxiYWNrKGNhbGxiYWNrOiAoKSA9PiBQcm9taXNlPGFueT4pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kaXNtaXNzQ2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICB9XG5cbiAgICBwdWJsaWMgZW5hYmxlQnV0dG9uKGlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5idXR0b25zLm5leHQoXG4gICAgICAgICAgICB0aGlzLmJ1dHRvbnMudmFsdWUubWFwKChidXR0b246IElGdW5kYW1lbnRhbE1vZGFsQnV0dG9uT3B0aW9ucykgPT5cbiAgICAgICAgICAgICAgICBidXR0b24uaWQgPT09IGlkID8geyAuLi5idXR0b24sIGRpc2FibGVkOiBmYWxzZSB9IDogYnV0dG9uXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIG9uQnV0dG9uQ2xpY2tlZChidXR0b246IElGdW5kYW1lbnRhbE1vZGFsQnV0dG9uT3B0aW9ucyk6IHZvaWQge1xuICAgICAgICBjb25zdCBjYWxsYmFja1JldHVybmVkT2JzZXJ2YWJsZTogT2JzZXJ2YWJsZTxhbnk+ID0gYnV0dG9uLmNhbGxiYWNrXG4gICAgICAgICAgICA/IGJ1dHRvbi5jYWxsYmFjaygpXG4gICAgICAgICAgICA6IG9mKG51bGwpO1xuXG4gICAgICAgIGlmIChidXR0b24uYWN0aW9uICE9PSBGdW5kYW1lbnRhbE1vZGFsQnV0dG9uQWN0aW9uLk5vbmUpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrUmV0dXJuZWRPYnNlcnZhYmxlLnN1YnNjcmliZSgoZGF0YTogYW55KSA9PlxuICAgICAgICAgICAgICAgIGJ1dHRvbi5hY3Rpb24gPT09IEZ1bmRhbWVudGFsTW9kYWxCdXR0b25BY3Rpb24uQ2xvc2VcbiAgICAgICAgICAgICAgICAgICAgPyB0aGlzLmNsb3NlKGRhdGEpXG4gICAgICAgICAgICAgICAgICAgIDogdGhpcy5kaXNtaXNzKGRhdGEpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGNsb3NlKGRhdGE/OiBhbnkpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5tb2RhbFJlZi5jbG9zZShkYXRhKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZGlzbWlzcyhkYXRhPzogYW55KTogdm9pZCB7XG4gICAgICAgIHRoaXMuZGlzbWlzc0NhbGxiYWNrKClcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHRoaXMubW9kYWxSZWYuZGlzbWlzcyhkYXRhKSlcbiAgICAgICAgICAgIC5jYXRjaChsb2Rhc2gubm9vcCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkaXNtaXNzQ2FsbGJhY2soKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbn1cbiJdfQ==