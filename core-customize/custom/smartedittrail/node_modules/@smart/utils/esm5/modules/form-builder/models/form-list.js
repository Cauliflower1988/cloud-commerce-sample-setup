/**
 * Copyright (c) 2020 SAP SE or an SAP affiliate company. All rights reserved.
 * @module smartutils
 */
import * as tslib_1 from "tslib";
import { values } from 'lodash';
import { AbstractForm } from './abstract-form';
var FormList = /** @class */ (function (_super) {
    tslib_1.__extends(FormList, _super);
    function FormList(component, control, inputs, parent, persist, forms) {
        if (forms === void 0) { forms = []; }
        var _this = _super.call(this, component, control, inputs, persist, parent) || this;
        _this.forms = forms;
        forms.forEach(function (child) {
            child.parent = _this;
        });
        return _this;
    }
    /**
     * @override
     * Implements the abstract getPersistedValue() method.
     */
    FormList.prototype.getPersistedValue = function () {
        return this.forms.reduce(function (acc, child) {
            if (!child.persist) {
                /**
                 * Look ahead and merge the values of the
                 * nested group, array or field.
                 *
                 * If it's a field, the values of the field
                 * would be an empty array, because it's not an object.
                 */
                return acc.concat(values(child.getPersistedValue()));
            }
            acc.push(child.getPersistedValue());
            return acc;
        }, []);
    };
    /**
     * Adds a form element to the end of the list.
     *
     * @param form
     */
    FormList.prototype.addFormElement = function (form) {
        this.forms = tslib_1.__spread(this.forms, [form]);
        this.control.push(form.control);
        form.parent = this;
    };
    /**
     * Removes a form element from the list.
     *
     * @param {string} index.
     */
    FormList.prototype.removeFormElement = function (index) {
        if (!this._isInBounds(index)) {
            return;
        }
        this.forms = this.forms.filter(function (f, i) { return i !== index; });
        this.control.removeAt(index);
    };
    /**
     * Returns an element at an index.
     *
     * @param index An index inbounds of the list.
     */
    FormList.prototype.formElementAt = function (index) {
        if (!this._isInBounds(index)) {
            return null;
        }
        return this.forms[index];
    };
    /**
     * The size of the list.
     */
    FormList.prototype.size = function () {
        return this.forms.length;
    };
    /**
     * Swaps a form element in the array.
     *
     * @param a The index of form a.
     * @param b The index of form b.
     */
    FormList.prototype.swapFormElements = function (a, b) {
        if (!this._isInBounds(a) || !this._isInBounds(b) || a === b) {
            return;
        }
        this.forms = tslib_1.__spread(this.forms);
        /**
         * Swapping form array.
         */
        var form = this.forms[a];
        this.forms[a] = this.forms[b];
        this.forms[b] = form;
        /**
         * Swapping control's array.
         */
        var control = this.control.at(a);
        this.control.insert(a, this.control.at(b));
        this.control.insert(b, control);
    };
    /**
     * Moves a form element in the array to a new position.
     *
     * @param from The previous index.
     * @param to The targeted index.
     */
    FormList.prototype.moveFormElement = function (from, to) {
        if (!this._isInBounds(from) || !this._isInBounds(to) || from === to) {
            return;
        }
        var delta = to < from ? -1 : 1;
        var tempControl = this.control.at(from);
        var tempForm = this.forms[from];
        for (var i = from; i !== to; i += delta) {
            var position = i + delta;
            this.control.setControl(i, this.control.at(position));
            this.forms[i] = this.forms[position];
        }
        this.control.setControl(to, tempControl);
        this.forms[to] = tempForm;
    };
    /**
     * Checks of the index is in bounds.
     *
     * @internal
     * @param index
     */
    FormList.prototype._isInBounds = function (index) {
        return index < this.forms.length && index >= 0;
    };
    return FormList;
}(AbstractForm));
export { FormList };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1saXN0LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHNtYXJ0L3V0aWxzLyIsInNvdXJjZXMiOlsibW9kdWxlcy9mb3JtLWJ1aWxkZXIvbW9kZWxzL2Zvcm0tbGlzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUVoQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFJL0M7SUFBOEIsb0NBQVk7SUFNdEMsa0JBQ0ksU0FBd0IsRUFDeEIsT0FBa0IsRUFDbEIsTUFBdUIsRUFDdkIsTUFBMkIsRUFDM0IsT0FBZ0IsRUFDVCxLQUEwQjtRQUExQixzQkFBQSxFQUFBLFVBQTBCO1FBTnJDLFlBUUksa0JBQU0sU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxTQUtyRDtRQVBVLFdBQUssR0FBTCxLQUFLLENBQXFCO1FBSWpDLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBQyxLQUFLO1lBQ2hCLEtBQUssQ0FBQyxNQUFNLEdBQUcsS0FBSSxDQUFDO1FBQ3hCLENBQUMsQ0FBQyxDQUFDOztJQUNQLENBQUM7SUFFRDs7O09BR0c7SUFDSCxvQ0FBaUIsR0FBakI7UUFDSSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBVSxFQUFFLEtBQW1CO1lBQ3JELElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFO2dCQUNoQjs7Ozs7O21CQU1HO2dCQUNILE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUMsQ0FBQyxDQUFDO2FBQ3hEO1lBRUQsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDO1lBQ3BDLE9BQU8sR0FBRyxDQUFDO1FBQ2YsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJ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Q0FBQztRQUVsQyxLQUFLLElBQUksQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsSUFBSSxLQUFLLEVBQUU7WUFDckMsSUFBTSxRQUFRLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztZQUUzQixJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUN0RCxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDeEM7UUFFRCxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUM7SUFDOUIsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0ssOEJBQVcsR0FBbkIsVUFBb0IsS0FBYTtRQUM3QixPQUFPLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFDO0lBQ25ELENBQUM7SUFDTCxlQUFDO0FBQUQsQ0FBQyxBQXpKRCxDQUE4QixZQUFZLEdBeUp6QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvcm1BcnJheSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IHZhbHVlcyB9IGZyb20gJ2xvZGFzaCc7XG5cbmltcG9ydCB7IEFic3RyYWN0Rm9ybSB9IGZyb20gJy4vYWJzdHJhY3QtZm9ybSc7XG5pbXBvcnQgeyBDb21wb25lbnRUeXBlIH0gZnJvbSAnLi9pbnRlcmZhY2VzJztcbmltcG9ydCB7IElucHV0UHJvcGVydGllcyB9IGZyb20gJy4vaW5wdXQtcHJvcGVydGllcyc7XG5cbmV4cG9ydCBjbGFzcyBGb3JtTGlzdCBleHRlbmRzIEFic3RyYWN0Rm9ybSB7XG4gICAgLyoqXG4gICAgICogQG92ZXJyaWRlXG4gICAgICovXG4gICAgcmVhZG9ubHkgY29udHJvbCE6IEZvcm1BcnJheTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBjb21wb25lbnQ6IENvbXBvbmVudFR5cGUsXG4gICAgICAgIGNvbnRyb2w6IEZvcm1BcnJheSxcbiAgICAgICAgaW5wdXRzOiBJbnB1dFByb3BlcnRpZXMsXG4gICAgICAgIHBhcmVudDogQWJzdHJhY3RGb3JtIHwgbnVsbCxcbiAgICAgICAgcGVyc2lzdDogYm9vbGVhbixcbiAgICAgICAgcHVibGljIGZvcm1zOiBBYnN0cmFjdEZvcm1bXSA9IFtdXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKGNvbXBvbmVudCwgY29udHJvbCwgaW5wdXRzLCBwZXJzaXN0LCBwYXJlbnQpO1xuXG4gICAgICAgIGZvcm1zLmZvckVhY2goKGNoaWxkKSA9PiB7XG4gICAgICAgICAgICBjaGlsZC5wYXJlbnQgPSB0aGlzO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAb3ZlcnJpZGVcbiAgICAgKiBJbXBsZW1lbnRzIHRoZSBhYnN0cmFjdCBnZXRQZXJzaXN0ZWRWYWx1ZSgpIG1ldGhvZC5cbiAgICAgKi9cbiAgICBnZXRQZXJzaXN0ZWRWYWx1ZSgpOiBhbnlbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZvcm1zLnJlZHVjZSgoYWNjOiBhbnlbXSwgY2hpbGQ6IEFic3RyYWN0Rm9ybSkgPT4ge1xuICAgICAgICAgICAgaWYgKCFjaGlsZC5wZXJzaXN0KSB7XG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogTG9vayBhaGVhZCBhbmQgbWVyZ2UgdGhlIHZhbHVlcyBvZiB0aGVcbiAgICAgICAgICAgICAgICAgKiBuZXN0ZWQgZ3JvdXAsIGFycmF5IG9yIGZpZWxkLlxuICAgICAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgICAgICogSWYgaXQncyBhIGZpZWxkLCB0aGUgdmFsdWVzIG9mIHRoZSBmaWVsZFxuICAgICAgICAgICAgICAgICAqIHdvdWxkIGJlIGFuIGVtcHR5IGFycmF5LCBiZWNhdXNlIGl0J3Mgbm90IGFuIG9iamVjdC5cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjLmNvbmNhdCh2YWx1ZXMoY2hpbGQuZ2V0UGVyc2lzdGVkVmFsdWUoKSkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhY2MucHVzaChjaGlsZC5nZXRQZXJzaXN0ZWRWYWx1ZSgpKTtcbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIFtdKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGRzIGEgZm9ybSBlbGVtZW50IHRvIHRoZSBlbmQgb2YgdGhlIGxpc3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZm9ybVxuICAgICAqL1xuICAgIGFkZEZvcm1FbGVtZW50KGZvcm06IEFic3RyYWN0Rm9ybSk6IHZvaWQge1xuICAgICAgICB0aGlzLmZvcm1zID0gWy4uLnRoaXMuZm9ybXMsIGZvcm1dO1xuICAgICAgICB0aGlzLmNvbnRyb2wucHVzaChmb3JtLmNvbnRyb2wpO1xuXG4gICAgICAgIGZvcm0ucGFyZW50ID0gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGEgZm9ybSBlbGVtZW50IGZyb20gdGhlIGxpc3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaW5kZXguXG4gICAgICovXG4gICAgcmVtb3ZlRm9ybUVsZW1lbnQoaW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuX2lzSW5Cb3VuZHMoaW5kZXgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmZvcm1zID0gdGhpcy5mb3Jtcy5maWx0ZXIoKGYsIGkpID0+IGkgIT09IGluZGV4KTtcbiAgICAgICAgdGhpcy5jb250cm9sLnJlbW92ZUF0KGluZGV4KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFuIGVsZW1lbnQgYXQgYW4gaW5kZXguXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5kZXggQW4gaW5kZXggaW5ib3VuZHMgb2YgdGhlIGxpc3QuXG4gICAgICovXG4gICAgZm9ybUVsZW1lbnRBdChpbmRleDogbnVtYmVyKTogQWJzdHJhY3RGb3JtIHwgbnVsbCB7XG4gICAgICAgIGlmICghdGhpcy5faXNJbkJvdW5kcyhpbmRleCkpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZm9ybXNbaW5kZXhdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBzaXplIG9mIHRoZSBsaXN0LlxuICAgICAqL1xuICAgIHNpemUoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9ybXMubGVuZ3RoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN3YXBzIGEgZm9ybSBlbGVtZW50IGluIHRoZSBhcnJheS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBhIFRoZSBpbmRleCBvZiBmb3JtIGEuXG4gICAgICogQHBhcmFtIGIgVGhlIGluZGV4IG9mIGZvcm0gYi5cbiAgICAgKi9cbiAgICBzd2FwRm9ybUVsZW1lbnRzKGE6IG51bWJlciwgYjogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5faXNJbkJvdW5kcyhhKSB8fCAhdGhpcy5faXNJbkJvdW5kcyhiKSB8fCBhID09PSBiKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmZvcm1zID0gWy4uLnRoaXMuZm9ybXNdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTd2FwcGluZyBmb3JtIGFycmF5LlxuICAgICAgICAgKi9cbiAgICAgICAgY29uc3QgZm9ybSA9IHRoaXMuZm9ybXNbYV07XG4gICAgICAgIHRoaXMuZm9ybXNbYV0gPSB0aGlzLmZvcm1zW2JdO1xuICAgICAgICB0aGlzLmZvcm1zW2JdID0gZm9ybTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU3dhcHBpbmcgY29udHJvbCdzIGFycmF5LlxuICAgICAgICAgKi9cbiAgICAgICAgY29uc3QgY29udHJvbCA9IHRoaXMuY29udHJvbC5hdChhKTtcbiAgICAgICAgdGhpcy5jb250cm9sLmluc2VydChhLCB0aGlzLmNvbnRyb2wuYXQoYikpO1xuICAgICAgICB0aGlzLmNvbnRyb2wuaW5zZXJ0KGIsIGNvbnRyb2wpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1vdmVzIGEgZm9ybSBlbGVtZW50IGluIHRoZSBhcnJheSB0byBhIG5ldyBwb3NpdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBmcm9tIFRoZSBwcmV2aW91cyBpbmRleC5cbiAgICAgKiBAcGFyYW0gdG8gVGhlIHRhcmdldGVkIGluZGV4LlxuICAgICAqL1xuICAgIG1vdmVGb3JtRWxlbWVudChmcm9tOiBudW1iZXIsIHRvOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLl9pc0luQm91bmRzKGZyb20pIHx8ICF0aGlzLl9pc0luQm91bmRzKHRvKSB8fCBmcm9tID09PSB0bykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZGVsdGEgPSB0byA8IGZyb20gPyAtMSA6IDE7XG5cbiAgICAgICAgY29uc3QgdGVtcENvbnRyb2wgPSB0aGlzLmNvbnRyb2wuYXQoZnJvbSk7XG4gICAgICAgIGNvbnN0IHRlbXBGb3JtID0gdGhpcy5mb3Jtc1tmcm9tXTtcblxuICAgICAgICBmb3IgKGxldCBpID0gZnJvbTsgaSAhPT0gdG87IGkgKz0gZGVsdGEpIHtcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gaSArIGRlbHRhO1xuXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2wuc2V0Q29udHJvbChpLCB0aGlzLmNvbnRyb2wuYXQocG9zaXRpb24pKTtcbiAgICAgICAgICAgIHRoaXMuZm9ybXNbaV0gPSB0aGlzLmZvcm1zW3Bvc2l0aW9uXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY29udHJvbC5zZXRDb250cm9sKHRvLCB0ZW1wQ29udHJvbCk7XG4gICAgICAgIHRoaXMuZm9ybXNbdG9dID0gdGVtcEZvcm07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIG9mIHRoZSBpbmRleCBpcyBpbiBib3VuZHMuXG4gICAgICpcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKiBAcGFyYW0gaW5kZXhcbiAgICAgKi9cbiAgICBwcml2YXRlIF9pc0luQm91bmRzKGluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIGluZGV4IDwgdGhpcy5mb3Jtcy5sZW5ndGggJiYgaW5kZXggPj0gMDtcbiAgICB9XG59XG4iXX0=