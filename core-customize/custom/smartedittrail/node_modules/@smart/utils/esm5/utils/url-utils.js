/**
 * Copyright (c) 2020 SAP SE or an SAP affiliate company. All rights reserved.
 * @module smartutils
 */
/**
 * Copyright (c) 2019 SAP SE or an SAP affiliate company. All rights reserved.
 * @module smartutils
 */
import * as lodash from 'lodash';
import { stringUtils } from './string-utils';
/* tslint:disable:max-classes-per-file */
/**
 * @ngdoc service
 * @name @smartutils.services:UrlUtils#URIBuilder
 *
 * @description
 * builder or URIs, build() method must be invoked to actually retrieve a URI
 *
 * @param {Object} modalStack, the $modalStack service of angular-ui.
 */
var URIBuilder = /** @class */ (function () {
    function URIBuilder(uri) {
        this.uri = uri;
        this.wholeWordMatch = '[\\w]+';
    }
    URIBuilder.prototype.build = function () {
        return this.uri;
    };
    /**
     * @ngdoc method
     * @name  @smartutils.services:UrlUtils#URIBuilder#replaceParams
     * @methodOf  @smartutils.services:UrlUtils#URIBuilder
     *
     * @description
     * Substitute all ":" prefixed placeholders in the full url with the matching values in the given params
     * Substitute Non ":" prefixed placeholders containg "_"
     *
     * @param {Object} params a map of placeholder names / values
     */
    URIBuilder.prototype.replaceParams = function (params) {
        var _this = this;
        var clone = lodash.cloneDeep(this);
        if (params) {
            // order the keys by descending length
            clone.uri = Object.keys(params)
                .sort(function (a, b) {
                return b.length - a.length;
            })
                .reduce(function (tempURL, key) {
                return _this.substituteKeyForValue(tempURL, key, params[key]);
            }, clone.uri);
        }
        return clone;
    };
    /**
     * @ngdoc method
     * @name  @smartutils.services:UrlUtils#URIBuilder#sanitize
     * @methodOf  @smartutils.services:UrlUtils#URIBuilder
     *
     * @description
     * removes unresolved ":" prefixed placeholders from absolute path
     */
    URIBuilder.prototype.sanitize = function () {
        var clone = lodash.cloneDeep(this);
        var uriDomainAndPath = /(https?:\/\/[^\/]*)(\/.*)/.exec(clone.uri);
        clone.uri = uriDomainAndPath == null ? clone.uri : uriDomainAndPath[2];
        clone.uri = this.substituteKeyForValue(clone.uri, this.wholeWordMatch, '')
            .replace(/\/\//, '/') // to replace double slash (api/:identifier/data?param=true) if :identifier is removed
            .replace(/\/\?/, '?') // to replace slash question mark (api/:identifier?param=true) if :identifier is removed
            .replace(/\/$/, ''); // to remove trailing slash
        clone.uri = uriDomainAndPath == null ? clone.uri : uriDomainAndPath[1] + clone.uri;
        return clone;
    };
    URIBuilder.prototype.substituteKeyForValue = function (url, key, value) {
        url = url
            .replace(new RegExp(':' + key + '/'), (value || '') + "/")
            .replace(new RegExp(':' + key + '$'), "" + (value || ''))
            .replace(new RegExp(':' + key + '\\?'), (value || '') + "?")
            .replace(new RegExp(':' + key + '&'), (value || '') + "&");
        /*
         * to cater for special case of smartedit
         * where some non ":" prefixed placeholders must be resolved too
         * we limit it though to keys containing "_" (case for smartedit)
         * since it would otherwise breaks most APIs patterns
         */
        if (key !== this.wholeWordMatch && key.includes('_')) {
            var _uri = url.includes('?') ? url.substr(0, url.indexOf('?')) : url;
            var uri = _uri.replace(new RegExp('\\b' + key + '\\b'), "" + (value || ''));
            url = url.includes('?') ? uri + url.substr(url.indexOf('?')) : uri;
        }
        return url;
    };
    return URIBuilder;
}());
export { URIBuilder };
/**
 * @ngdoc service
 * @name @smartutils.services:UrlUtils
 *
 * @description
 * A collection of utility methods for manipulating URLs
 */
var UrlUtils = /** @class */ (function () {
    function UrlUtils() {
    }
    /**
     * @ngdoc method
     * @name @smartutils.services:UrlUtils#getOrigin
     * @methodOf @smartutils.services:UrlUtils
     * @description
     * returns document location origin
     * Some browsers still do not support W3C document.location.origin, this function caters for gap.
     * @param {String =} url optional any url
     */
    UrlUtils.prototype.getOrigin = function (url) {
        if (url) {
            var link = document.createElement('a');
            link.setAttribute('href', url);
            var origin_1 = link.protocol + '//' + link.hostname + (link.port ? ':' + link.port : '');
            // @ts-ignore
            link = null; // GC
            return origin_1;
        }
        else {
            return (window.location.protocol +
                '//' +
                window.location.hostname +
                (window.location.port ? ':' + window.location.port : ''));
        }
    };
    /**
     * @ngdoc method
     * @name @smartutils.services:UrlUtils#getURI
     * @methodOf @smartutils.services:UrlUtils
     *
     * @description
     * Will return the URI part of a URL
     * @param {String} url the URL the URI of which is to be returned
     */
    UrlUtils.prototype.getURI = function (url) {
        return url && url.indexOf('?') > -1 ? url.split('?')[0] : url;
    };
    /**
     * @ngdoc method
     * @name @smartutils.services:UrlUtils#updateUrlParameter
     * @methodOf @smartutils.services:UrlUtils
     *
     * @description
     * Updates a URL to contain the query param and value provided. If already exists then it is updated,
     * if it did not previously exist, then it will be added.
     *
     * @param {String} url The url to be updated (this param will not be modified)
     * @param {String} key The query param key
     * @param {String} value The query param value
     *
     * @returns {String} The url with updated key/value
     */
    UrlUtils.prototype.updateUrlParameter = function (url, key, value) {
        var i = url.indexOf('#');
        var hash = i === -1 ? '' : url.substr(i);
        url = i === -1 ? url : url.substr(0, i);
        var regex = new RegExp('([?&])' + key + '=.*?(&|$)', 'i');
        var separator = url.indexOf('?') !== -1 ? '&' : '?';
        if (url.match(regex)) {
            url = url.replace(regex, '$1' + key + '=' + value + '$2');
        }
        else {
            url = url + separator + key + '=' + value;
        }
        return url + hash;
    };
    /**
     * @ngdoc method
     * @name @smartutils.services:UrlUtils#getQueryString
     * @methodOf @smartutils.services:UrlUtils
     *
     * @description
     * <b>getQueryString</b> will convert a given object into a query string.
     *
     * Below is the code snippet for sample input and sample output:
     *
     * <pre>
     * var params = {
     *  key1 : 'value1',
     *  key2 : 'value2',
     *  key3 : 'value3'
     *  }
     *
     *  var output = getQueryString(params);
     *
     *  // The output is '?&key1=value1&key2=value2&key3=value3'
     *
     * </pre>
     * @param {Object} params Object containing a list of params.
     *
     * @returns {String} a query string
     */
    UrlUtils.prototype.getQueryString = function (params) {
        var queryString = '';
        if (params) {
            var _loop_1 = function (param) {
                if (params.hasOwnProperty(param)) {
                    (lodash.isArray(params[param]) ? params[param] : [params[param]]).forEach(function (value) {
                        queryString +=
                            '&' + encodeURIComponent(param) + '=' + encodeURIComponent(value);
                    });
                }
            };
            for (var param in params) {
                _loop_1(param);
            }
        }
        return '?' + (!stringUtils.isBlank(queryString) ? queryString.substring(1) : queryString);
    };
    /**
     * @ngdoc method
     * @name @smartutils.services:UrlUtils#parseQuery
     * @methodOf @smartutils.services:UrlUtils
     *
     * @description
     * <b>parseQuery</b> will convert a given query string to an object.
     *
     * Below is the code snippet for sample input and sample output:
     *
     * <pre>
     * var query = '?key1=value1&key2=value2&key3=value3';
     *
     * var output = parseQuery(query);
     *
     * // The output is { key1 : 'value1', key2 : 'value2', key3 : 'value3' }
     *
     * </pre>
     * @param {String} query String that needs to be parsed.
     *
     * @returns {Object} an object containing all params of the given query
     */
    UrlUtils.prototype.parseQuery = function (str) {
        var objURL = {};
        str.replace(new RegExp('([^?=&]+)(=([^&]*))?', 'g'), function ($0, $1, $2, $3) {
            objURL[$1] = $3;
        });
        return objURL;
    };
    /**
     * @ngdoc method
     * @name @smartutils.services:UrlUtils#getAbsoluteURL
     * @methodOf @smartutils.services:UrlUtils
     *
     * @description
     * Makes url absolute (with provided domain) if not yet
     *
     * @param {String} domain the domain with witch to prepend the url if it is not absolute
     * @param {String} url the url to test
     *
     * @returns {String} url
     */
    UrlUtils.prototype.getAbsoluteURL = function (domain, url) {
        // url regex
        // scheme:[//[user[:password]@]host[:port]][/path][?query][#fragment]
        var re = new RegExp('([a-zA-Z0-9]+://)' + // scheme
            '([a-zA-Z0-9_]+:[a-zA-Z0-9_]+@)?' + // user:password
            '([a-zA-Z0-9.-]+)' + // hostname
            '|([0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+)' + // or ip
            '(:[0-9]+)?' + // port
            '(/.*)?' // everything else
        );
        return re.exec(url) ? url : domain + url;
    };
    return UrlUtils;
}());
export { UrlUtils };
export var urlUtils = new UrlUtils();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXJsLXV0aWxzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHNtYXJ0L3V0aWxzLyIsInNvdXJjZXMiOlsidXRpbHMvdXJsLXV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7R0FHRztBQUNILE9BQU8sS0FBSyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBQ2pDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUc3Qyx5Q0FBeUM7QUFFekM7Ozs7Ozs7O0dBUUc7QUFFSDtJQUdJLG9CQUFvQixHQUFXO1FBQVgsUUFBRyxHQUFILEdBQUcsQ0FBUTtRQUZkLG1CQUFjLEdBQUcsUUFBUSxDQUFDO0lBRVQsQ0FBQztJQUVuQywwQkFBSyxHQUFMO1FBQ0ksT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ3BCLENBQUM7SUFFRDs7Ozs7Ozs7OztPQVVHO0lBQ0gsa0NBQWEsR0FBYixVQUFjLE1BQXdCO1FBQXRDLGlCQWFDO1FBWkcsSUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQyxJQUFJLE1BQU0sRUFBRTtZQUNSLHNDQUFzQztZQUN0QyxLQUFLLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO2lCQUMxQixJQUFJLENBQUMsVUFBUyxDQUFDLEVBQUUsQ0FBQztnQkFDZixPQUFPLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUMvQixDQUFDLENBQUM7aUJBQ0QsTUFBTSxDQUFDLFVBQUMsT0FBZSxFQUFFLEdBQVc7Z0JBQ2pDLE9BQU8sS0FBSSxDQUFDLHFCQUFxQixDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDakUsQ0FBQyxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNyQjtRQUNELE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFFRDs7Ozs7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aUNBQWlDLEdBQUcsZ0JBQWdCO1lBQ3BELGtCQUFrQixHQUFHLFdBQVc7WUFDaEMsc0NBQXNDLEdBQUcsUUFBUTtZQUNqRCxZQUFZLEdBQUcsT0FBTztZQUNsQixRQUFRLENBQUMsa0JBQWtCO1NBQ2xDLENBQUM7UUFFRixPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQztJQUM3QyxDQUFDO0lBQ0wsZUFBQztBQUFELENBQUMsQUFsTEQsSUFrTEM7O0FBRUQsTUFBTSxDQUFDLElBQU0sUUFBUSxHQUFHLElBQUksUUFBUSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxOSBTQVAgU0Ugb3IgYW4gU0FQIGFmZmlsaWF0ZSBjb21wYW55LiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogQG1vZHVsZSBzbWFydHV0aWxzXG4gKi9cbmltcG9ydCAqIGFzIGxvZGFzaCBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgc3RyaW5nVXRpbHMgfSBmcm9tICcuL3N0cmluZy11dGlscyc7XG5pbXBvcnQgeyBUeXBlZE1hcCB9IGZyb20gJy4uL2R0b3MnO1xuXG4vKiB0c2xpbnQ6ZGlzYWJsZTptYXgtY2xhc3Nlcy1wZXItZmlsZSAqL1xuXG4vKipcbiAqIEBuZ2RvYyBzZXJ2aWNlXG4gKiBAbmFtZSBAc21hcnR1dGlscy5zZXJ2aWNlczpVcmxVdGlscyNVUklCdWlsZGVyXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBidWlsZGVyIG9yIFVSSXMsIGJ1aWxkKCkgbWV0aG9kIG11c3QgYmUgaW52b2tlZCB0byBhY3R1YWxseSByZXRyaWV2ZSBhIFVSSVxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBtb2RhbFN0YWNrLCB0aGUgJG1vZGFsU3RhY2sgc2VydmljZSBvZiBhbmd1bGFyLXVpLlxuICovXG5cbmV4cG9ydCBjbGFzcyBVUklCdWlsZGVyIHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHdob2xlV29yZE1hdGNoID0gJ1tcXFxcd10rJztcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdXJpOiBzdHJpbmcpIHt9XG5cbiAgICBidWlsZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudXJpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgKiBAbmFtZSAgQHNtYXJ0dXRpbHMuc2VydmljZXM6VXJsVXRpbHMjVVJJQnVpbGRlciNyZXBsYWNlUGFyYW1zXG4gICAgICogQG1ldGhvZE9mICBAc21hcnR1dGlscy5zZXJ2aWNlczpVcmxVdGlscyNVUklCdWlsZGVyXG4gICAgICpcbiAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgKiBTdWJzdGl0dXRlIGFsbCBcIjpcIiBwcmVmaXhlZCBwbGFjZWhvbGRlcnMgaW4gdGhlIGZ1bGwgdXJsIHdpdGggdGhlIG1hdGNoaW5nIHZhbHVlcyBpbiB0aGUgZ2l2ZW4gcGFyYW1zXG4gICAgICogU3Vic3RpdHV0ZSBOb24gXCI6XCIgcHJlZml4ZWQgcGxhY2Vob2xkZXJzIGNvbnRhaW5nIFwiX1wiXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcGFyYW1zIGEgbWFwIG9mIHBsYWNlaG9sZGVyIG5hbWVzIC8gdmFsdWVzXG4gICAgICovXG4gICAgcmVwbGFjZVBhcmFtcyhwYXJhbXM6IFR5cGVkTWFwPHN0cmluZz4pOiBVUklCdWlsZGVyIHtcbiAgICAgICAgY29uc3QgY2xvbmUgPSBsb2Rhc2guY2xvbmVEZWVwKHRoaXMpO1xuICAgICAgICBpZiAocGFyYW1zKSB7XG4gICAgICAgICAgICAvLyBvcmRlciB0aGUga2V5cyBieSBkZXNjZW5kaW5nIGxlbmd0aFxuICAgICAgICAgICAgY2xvbmUudXJpID0gT2JqZWN0LmtleXMocGFyYW1zKVxuICAgICAgICAgICAgICAgIC5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIubGVuZ3RoIC0gYS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAucmVkdWNlKCh0ZW1wVVJMOiBzdHJpbmcsIGtleTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN1YnN0aXR1dGVLZXlGb3JWYWx1ZSh0ZW1wVVJMLCBrZXksIHBhcmFtc1trZXldKTtcbiAgICAgICAgICAgICAgICB9LCBjbG9uZS51cmkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjbG9uZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbmdkb2MgbWV0aG9kXG4gICAgICogQG5hbWUgIEBzbWFydHV0aWxzLnNlcnZpY2VzOlVybFV0aWxzI1VSSUJ1aWxkZXIjc2FuaXRpemVcbiAgICAgKiBAbWV0aG9kT2YgIEBzbWFydHV0aWxzLnNlcnZpY2VzOlVybFV0aWxzI1VSSUJ1aWxkZXJcbiAgICAgKlxuICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAqIHJlbW92ZXMgdW5yZXNvbHZlZCBcIjpcIiBwcmVmaXhlZCBwbGFjZWhvbGRlcnMgZnJvbSBhYnNvbHV0ZSBwYXRoXG4gICAgICovXG4gICAgc2FuaXRpemUoKTogVVJJQnVpbGRlciB7XG4gICAgICAgIGNvbnN0IGNsb25lID0gbG9kYXNoLmNsb25lRGVlcCh0aGlzKTtcbiAgICAgICAgY29uc3QgdXJpRG9tYWluQW5kUGF0aDogc3RyaW5nW10gfCBudWxsID0gLyhodHRwcz86XFwvXFwvW15cXC9dKikoXFwvLiopLy5leGVjKGNsb25lLnVyaSk7XG4gICAgICAgIGNsb25lLnVyaSA9IHVyaURvbWFpbkFuZFBhdGggPT0gbnVsbCA/IGNsb25lLnVyaSA6IHVyaURvbWFpbkFuZFBhdGhbMl07XG4gICAgICAgIGNsb25lLnVyaSA9IHRoaXMuc3Vic3RpdHV0ZUtleUZvclZhbHVlKGNsb25lLnVyaSwgdGhpcy53aG9sZVdvcmRNYXRjaCwgJycpXG4gICAgICAgICAgICAucmVwbGFjZSgvXFwvXFwvLywgJy8nKSAvLyB0byByZXBsYWNlIGRvdWJsZSBzbGFzaCAoYXBpLzppZGVudGlmaWVyL2RhdGE/cGFyYW09dHJ1ZSkgaWYgOmlkZW50aWZpZXIgaXMgcmVtb3ZlZFxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcL1xcPy8sICc/JykgLy8gdG8gcmVwbGFjZSBzbGFzaCBxdWVzdGlvbiBtYXJrIChhcGkvOmlkZW50aWZpZXI/cGFyYW09dHJ1ZSkgaWYgOmlkZW50aWZpZXIgaXMgcmVtb3ZlZFxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcLyQvLCAnJyk7IC8vIHRvIHJlbW92ZSB0cmFpbGluZyBzbGFzaFxuXG4gICAgICAgIGNsb25lLnVyaSA9IHVyaURvbWFpbkFuZFBhdGggPT0gbnVsbCA/IGNsb25lLnVyaSA6IHVyaURvbWFpbkFuZFBhdGhbMV0gKyBjbG9uZS51cmk7XG4gICAgICAgIHJldHVybiBjbG9uZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN1YnN0aXR1dGVLZXlGb3JWYWx1ZSh1cmw6IHN0cmluZywga2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICB1cmwgPSB1cmxcbiAgICAgICAgICAgIC5yZXBsYWNlKG5ldyBSZWdFeHAoJzonICsga2V5ICsgJy8nKSwgYCR7dmFsdWUgfHwgJyd9L2ApXG4gICAgICAgICAgICAucmVwbGFjZShuZXcgUmVnRXhwKCc6JyArIGtleSArICckJyksIGAke3ZhbHVlIHx8ICcnfWApXG4gICAgICAgICAgICAucmVwbGFjZShuZXcgUmVnRXhwKCc6JyArIGtleSArICdcXFxcPycpLCBgJHt2YWx1ZSB8fCAnJ30/YClcbiAgICAgICAgICAgIC5yZXBsYWNlKG5ldyBSZWdFeHAoJzonICsga2V5ICsgJyYnKSwgYCR7dmFsdWUgfHwgJyd9JmApO1xuXG4gICAgICAgIC8qXG4gICAgICAgICAqIHRvIGNhdGVyIGZvciBzcGVjaWFsIGNhc2Ugb2Ygc21hcnRlZGl0XG4gICAgICAgICAqIHdoZXJlIHNvbWUgbm9uIFwiOlwiIHByZWZpeGVkIHBsYWNlaG9sZGVycyBtdXN0IGJlIHJlc29sdmVkIHRvb1xuICAgICAgICAgKiB3ZSBsaW1pdCBpdCB0aG91Z2ggdG8ga2V5cyBjb250YWluaW5nIFwiX1wiIChjYXNlIGZvciBzbWFydGVkaXQpXG4gICAgICAgICAqIHNpbmNlIGl0IHdvdWxkIG90aGVyd2lzZSBicmVha3MgbW9zdCBBUElzIHBhdHRlcm5zXG4gICAgICAgICAqL1xuICAgICAgICBpZiAoa2V5ICE9PSB0aGlzLndob2xlV29yZE1hdGNoICYmIGtleS5pbmNsdWRlcygnXycpKSB7XG4gICAgICAgICAgICBjb25zdCBfdXJpID0gdXJsLmluY2x1ZGVzKCc/JykgPyB1cmwuc3Vic3RyKDAsIHVybC5pbmRleE9mKCc/JykpIDogdXJsO1xuICAgICAgICAgICAgY29uc3QgdXJpID0gX3VyaS5yZXBsYWNlKG5ldyBSZWdFeHAoJ1xcXFxiJyArIGtleSArICdcXFxcYicpLCBgJHt2YWx1ZSB8fCAnJ31gKTtcbiAgICAgICAgICAgIHVybCA9IHVybC5pbmNsdWRlcygnPycpID8gdXJpICsgdXJsLnN1YnN0cih1cmwuaW5kZXhPZignPycpKSA6IHVyaTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdXJsO1xuICAgIH1cbn1cbi8qKlxuICogQG5nZG9jIHNlcnZpY2VcbiAqIEBuYW1lIEBzbWFydHV0aWxzLnNlcnZpY2VzOlVybFV0aWxzXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBBIGNvbGxlY3Rpb24gb2YgdXRpbGl0eSBtZXRob2RzIGZvciBtYW5pcHVsYXRpbmcgVVJMc1xuICovXG5leHBvcnQgY2xhc3MgVXJsVXRpbHMge1xuICAgIC8qKlxuICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgKiBAbmFtZSBAc21hcnR1dGlscy5zZXJ2aWNlczpVcmxVdGlscyNnZXRPcmlnaW5cbiAgICAgKiBAbWV0aG9kT2YgQHNtYXJ0dXRpbHMuc2VydmljZXM6VXJsVXRpbHNcbiAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgKiByZXR1cm5zIGRvY3VtZW50IGxvY2F0aW9uIG9yaWdpblxuICAgICAqIFNvbWUgYnJvd3NlcnMgc3RpbGwgZG8gbm90IHN1cHBvcnQgVzNDIGRvY3VtZW50LmxvY2F0aW9uLm9yaWdpbiwgdGhpcyBmdW5jdGlvbiBjYXRlcnMgZm9yIGdhcC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZyA9fSB1cmwgb3B0aW9uYWwgYW55IHVybFxuICAgICAqL1xuICAgIGdldE9yaWdpbih1cmw/OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBpZiAodXJsKSB7XG4gICAgICAgICAgICBsZXQgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgdXJsKTtcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbiA9XG4gICAgICAgICAgICAgICAgbGluay5wcm90b2NvbCArICcvLycgKyBsaW5rLmhvc3RuYW1lICsgKGxpbmsucG9ydCA/ICc6JyArIGxpbmsucG9ydCA6ICcnKTtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGxpbmsgPSBudWxsOyAvLyBHQ1xuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnByb3RvY29sICtcbiAgICAgICAgICAgICAgICAnLy8nICtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgK1xuICAgICAgICAgICAgICAgICh3aW5kb3cubG9jYXRpb24ucG9ydCA/ICc6JyArIHdpbmRvdy5sb2NhdGlvbi5wb3J0IDogJycpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAqIEBuYW1lIEBzbWFydHV0aWxzLnNlcnZpY2VzOlVybFV0aWxzI2dldFVSSVxuICAgICAqIEBtZXRob2RPZiBAc21hcnR1dGlscy5zZXJ2aWNlczpVcmxVdGlsc1xuICAgICAqXG4gICAgICogQGRlc2NyaXB0aW9uXG4gICAgICogV2lsbCByZXR1cm4gdGhlIFVSSSBwYXJ0IG9mIGEgVVJMXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHVybCB0aGUgVVJMIHRoZSBVUkkgb2Ygd2hpY2ggaXMgdG8gYmUgcmV0dXJuZWRcbiAgICAgKi9cbiAgICBnZXRVUkkodXJsOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdXJsICYmIHVybC5pbmRleE9mKCc/JykgPiAtMSA/IHVybC5zcGxpdCgnPycpWzBdIDogdXJsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgKiBAbmFtZSBAc21hcnR1dGlscy5zZXJ2aWNlczpVcmxVdGlscyN1cGRhdGVVcmxQYXJhbWV0ZXJcbiAgICAgKiBAbWV0aG9kT2YgQHNtYXJ0dXRpbHMuc2VydmljZXM6VXJsVXRpbHNcbiAgICAgKlxuICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAqIFVwZGF0ZXMgYSBVUkwgdG8gY29udGFpbiB0aGUgcXVlcnkgcGFyYW0gYW5kIHZhbHVlIHByb3ZpZGVkLiBJZiBhbHJlYWR5IGV4aXN0cyB0aGVuIGl0IGlzIHVwZGF0ZWQsXG4gICAgICogaWYgaXQgZGlkIG5vdCBwcmV2aW91c2x5IGV4aXN0LCB0aGVuIGl0IHdpbGwgYmUgYWRkZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXJsIFRoZSB1cmwgdG8gYmUgdXBkYXRlZCAodGhpcyBwYXJhbSB3aWxsIG5vdCBiZSBtb2RpZmllZClcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5IFRoZSBxdWVyeSBwYXJhbSBrZXlcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgVGhlIHF1ZXJ5IHBhcmFtIHZhbHVlXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgdXJsIHdpdGggdXBkYXRlZCBrZXkvdmFsdWVcbiAgICAgKi9cbiAgICB1cGRhdGVVcmxQYXJhbWV0ZXIodXJsOiBzdHJpbmcsIGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgaSA9IHVybC5pbmRleE9mKCcjJyk7XG4gICAgICAgIGNvbnN0IGhhc2ggPSBpID09PSAtMSA/ICcnIDogdXJsLnN1YnN0cihpKTtcbiAgICAgICAgdXJsID0gaSA9PT0gLTEgPyB1cmwgOiB1cmwuc3Vic3RyKDAsIGkpO1xuICAgICAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoJyhbPyZdKScgKyBrZXkgKyAnPS4qPygmfCQpJywgJ2knKTtcbiAgICAgICAgY29uc3Qgc2VwYXJhdG9yID0gdXJsLmluZGV4T2YoJz8nKSAhPT0gLTEgPyAnJicgOiAnPyc7XG5cbiAgICAgICAgaWYgKHVybC5tYXRjaChyZWdleCkpIHtcbiAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKHJlZ2V4LCAnJDEnICsga2V5ICsgJz0nICsgdmFsdWUgKyAnJDInKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHVybCA9IHVybCArIHNlcGFyYXRvciArIGtleSArICc9JyArIHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1cmwgKyBoYXNoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBuZ2RvYyBtZXRob2RcbiAgICAgKiBAbmFtZSBAc21hcnR1dGlscy5zZXJ2aWNlczpVcmxVdGlscyNnZXRRdWVyeVN0cmluZ1xuICAgICAqIEBtZXRob2RPZiBAc21hcnR1dGlscy5zZXJ2aWNlczpVcmxVdGlsc1xuICAgICAqXG4gICAgICogQGRlc2NyaXB0aW9uXG4gICAgICogPGI+Z2V0UXVlcnlTdHJpbmc8L2I+IHdpbGwgY29udmVydCBhIGdpdmVuIG9iamVjdCBpbnRvIGEgcXVlcnkgc3RyaW5nLlxuICAgICAqXG4gICAgICogQmVsb3cgaXMgdGhlIGNvZGUgc25pcHBldCBmb3Igc2FtcGxlIGlucHV0IGFuZCBzYW1wbGUgb3V0cHV0OlxuICAgICAqXG4gICAgICogPHByZT5cbiAgICAgKiB2YXIgcGFyYW1zID0ge1xuICAgICAqICBrZXkxIDogJ3ZhbHVlMScsXG4gICAgICogIGtleTIgOiAndmFsdWUyJyxcbiAgICAgKiAga2V5MyA6ICd2YWx1ZTMnXG4gICAgICogIH1cbiAgICAgKlxuICAgICAqICB2YXIgb3V0cHV0ID0gZ2V0UXVlcnlTdHJpbmcocGFyYW1zKTtcbiAgICAgKlxuICAgICAqICAvLyBUaGUgb3V0cHV0IGlzICc/JmtleTE9dmFsdWUxJmtleTI9dmFsdWUyJmtleTM9dmFsdWUzJ1xuICAgICAqXG4gICAgICogPC9wcmU+XG4gICAgICogQHBhcmFtIHtPYmplY3R9IHBhcmFtcyBPYmplY3QgY29udGFpbmluZyBhIGxpc3Qgb2YgcGFyYW1zLlxuICAgICAqXG4gICAgICogQHJldHVybnMge1N0cmluZ30gYSBxdWVyeSBzdHJpbmdcbiAgICAgKi9cbiAgICBnZXRRdWVyeVN0cmluZyhwYXJhbXM6IGFueSk6IHN0cmluZyB7XG4gICAgICAgIGxldCBxdWVyeVN0cmluZyA9ICcnO1xuICAgICAgICBpZiAocGFyYW1zKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHBhcmFtIGluIHBhcmFtcykge1xuICAgICAgICAgICAgICAgIGlmIChwYXJhbXMuaGFzT3duUHJvcGVydHkocGFyYW0pKSB7XG4gICAgICAgICAgICAgICAgICAgIChsb2Rhc2guaXNBcnJheShwYXJhbXNbcGFyYW1dKSA/IHBhcmFtc1twYXJhbV0gOiBbcGFyYW1zW3BhcmFtXV0pLmZvckVhY2goXG4gICAgICAgICAgICAgICAgICAgICAgICAodmFsdWU6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5U3RyaW5nICs9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcmJyArIGVuY29kZVVSSUNvbXBvbmVudChwYXJhbSkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJz8nICsgKCFzdHJpbmdVdGlscy5pc0JsYW5rKHF1ZXJ5U3RyaW5nKSA/IHF1ZXJ5U3RyaW5nLnN1YnN0cmluZygxKSA6IHF1ZXJ5U3RyaW5nKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbmdkb2MgbWV0aG9kXG4gICAgICogQG5hbWUgQHNtYXJ0dXRpbHMuc2VydmljZXM6VXJsVXRpbHMjcGFyc2VRdWVyeVxuICAgICAqIEBtZXRob2RPZiBAc21hcnR1dGlscy5zZXJ2aWNlczpVcmxVdGlsc1xuICAgICAqXG4gICAgICogQGRlc2NyaXB0aW9uXG4gICAgICogPGI+cGFyc2VRdWVyeTwvYj4gd2lsbCBjb252ZXJ0IGEgZ2l2ZW4gcXVlcnkgc3RyaW5nIHRvIGFuIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEJlbG93IGlzIHRoZSBjb2RlIHNuaXBwZXQgZm9yIHNhbXBsZSBpbnB1dCBhbmQgc2FtcGxlIG91dHB1dDpcbiAgICAgKlxuICAgICAqIDxwcmU+XG4gICAgICogdmFyIHF1ZXJ5ID0gJz9rZXkxPXZhbHVlMSZrZXkyPXZhbHVlMiZrZXkzPXZhbHVlMyc7XG4gICAgICpcbiAgICAgKiB2YXIgb3V0cHV0ID0gcGFyc2VRdWVyeShxdWVyeSk7XG4gICAgICpcbiAgICAgKiAvLyBUaGUgb3V0cHV0IGlzIHsga2V5MSA6ICd2YWx1ZTEnLCBrZXkyIDogJ3ZhbHVlMicsIGtleTMgOiAndmFsdWUzJyB9XG4gICAgICpcbiAgICAgKiA8L3ByZT5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcXVlcnkgU3RyaW5nIHRoYXQgbmVlZHMgdG8gYmUgcGFyc2VkLlxuICAgICAqXG4gICAgICogQHJldHVybnMge09iamVjdH0gYW4gb2JqZWN0IGNvbnRhaW5pbmcgYWxsIHBhcmFtcyBvZiB0aGUgZ2l2ZW4gcXVlcnlcbiAgICAgKi9cbiAgICBwYXJzZVF1ZXJ5KHN0cjogYW55KTogSlNPTiB7XG4gICAgICAgIGNvbnN0IG9ialVSTCA9IHt9IGFzIGFueTtcblxuICAgICAgICBzdHIucmVwbGFjZShuZXcgUmVnRXhwKCcoW14/PSZdKykoPShbXiZdKikpPycsICdnJyksIGZ1bmN0aW9uKFxuICAgICAgICAgICAgJDA6IGFueSxcbiAgICAgICAgICAgICQxOiBhbnksXG4gICAgICAgICAgICAkMjogYW55LFxuICAgICAgICAgICAgJDM6IGFueVxuICAgICAgICApIHtcbiAgICAgICAgICAgIG9ialVSTFskMV0gPSAkMztcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBvYmpVUkw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG5nZG9jIG1ldGhvZFxuICAgICAqIEBuYW1lIEBzbWFydHV0aWxzLnNlcnZpY2VzOlVybFV0aWxzI2dldEFic29sdXRlVVJMXG4gICAgICogQG1ldGhvZE9mIEBzbWFydHV0aWxzLnNlcnZpY2VzOlVybFV0aWxzXG4gICAgICpcbiAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgKiBNYWtlcyB1cmwgYWJzb2x1dGUgKHdpdGggcHJvdmlkZWQgZG9tYWluKSBpZiBub3QgeWV0XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZG9tYWluIHRoZSBkb21haW4gd2l0aCB3aXRjaCB0byBwcmVwZW5kIHRoZSB1cmwgaWYgaXQgaXMgbm90IGFic29sdXRlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHVybCB0aGUgdXJsIHRvIHRlc3RcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IHVybFxuICAgICAqL1xuICAgIGdldEFic29sdXRlVVJMKGRvbWFpbjogc3RyaW5nLCB1cmw6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIC8vIHVybCByZWdleFxuICAgICAgICAvLyBzY2hlbWU6Wy8vW3VzZXJbOnBhc3N3b3JkXUBdaG9zdFs6cG9ydF1dWy9wYXRoXVs/cXVlcnldWyNmcmFnbWVudF1cbiAgICAgICAgY29uc3QgcmUgPSBuZXcgUmVnRXhwKFxuICAgICAgICAgICAgJyhbYS16QS1aMC05XSs6Ly8pJyArIC8vIHNjaGVtZVxuICAgICAgICAgICAgJyhbYS16QS1aMC05X10rOlthLXpBLVowLTlfXStAKT8nICsgLy8gdXNlcjpwYXNzd29yZFxuICAgICAgICAgICAgJyhbYS16QS1aMC05Li1dKyknICsgLy8gaG9zdG5hbWVcbiAgICAgICAgICAgICd8KFswLTldK1xcXFwuWzAtOV0rXFxcXC5bMC05XStcXFxcLlswLTldKyknICsgLy8gb3IgaXBcbiAgICAgICAgICAgICcoOlswLTldKyk/JyArIC8vIHBvcnRcbiAgICAgICAgICAgICAgICAnKC8uKik/JyAvLyBldmVyeXRoaW5nIGVsc2VcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gcmUuZXhlYyh1cmwpID8gdXJsIDogZG9tYWluICsgdXJsO1xuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IHVybFV0aWxzID0gbmV3IFVybFV0aWxzKCk7XG4iXX0=