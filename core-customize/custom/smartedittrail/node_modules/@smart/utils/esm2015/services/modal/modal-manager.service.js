/**
 * Copyright (c) 2020 SAP SE or an SAP affiliate company. All rights reserved.
 * @module smartutils
 */
import * as tslib_1 from "tslib";
/**
 * Copyright (c) 2019 SAP SE or an SAP affiliate company. All rights reserved.
 * @module smartutils
 */
/*
 * Copyright (c) 2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
import * as lodash from 'lodash';
import { Injectable } from '@angular/core';
import { of, BehaviorSubject } from 'rxjs';
import { ModalRef } from '@fundamental-ngx/core';
import { FundamentalModalButtonAction } from '../../interfaces';
let FundamentalModalManagerService = class FundamentalModalManagerService {
    constructor(modalRef) {
        this.modalRef = modalRef;
        this.title = new BehaviorSubject('');
        this.titleSuffix = new BehaviorSubject('');
        this.modalData = new BehaviorSubject({});
        this.component = new BehaviorSubject({});
        this.isDismissButtonVisible = new BehaviorSubject(true);
        this.buttons = new BehaviorSubject([]);
    }
    init() {
        this.modalData.next(this.modalRef.data.modalData);
        this.component.next(this.modalRef.data.component);
        this.buttons.next(this.modalRef.data.templateConfig.buttons || []);
        this.title.next(this.modalRef.data.templateConfig.title);
        this.titleSuffix.next(this.modalRef.data.templateConfig.titleSuffix);
        this.isDismissButtonVisible.next(this.modalRef.data.templateConfig.isDismissButtonVisible);
    }
    // getters
    getComponent() {
        return this.component.asObservable();
    }
    getTitle() {
        return this.title.asObservable();
    }
    getTitleSuffix() {
        return this.titleSuffix.asObservable();
    }
    getButtons() {
        return this.buttons.asObservable();
    }
    getModalData() {
        return this.modalData.asObservable();
    }
    getIsDismissButtonVisible() {
        return this.isDismissButtonVisible.asObservable();
    }
    // header dismiss button
    setDismissButtonVisibility(isVisible) {
        this.isDismissButtonVisible.next(isVisible);
    }
    // title
    setTitle(title) {
        this.title.next(title);
    }
    // buttons
    addButton(button) {
        this.buttons.next([...this.buttons.value, button]);
    }
    removeButton(id) {
        this.buttons.next(this.buttons.value.filter((button) => button.id !== id));
    }
    removeAllButtons() {
        this.buttons.next([]);
    }
    disableButton(id) {
        this.buttons.next(this.buttons.value.map((button) => button.id === id ? Object.assign({}, button, { disabled: true }) : button));
    }
    setDismissCallback(callback) {
        this.dismissCallback = callback;
    }
    enableButton(id) {
        this.buttons.next(this.buttons.value.map((button) => button.id === id ? Object.assign({}, button, { disabled: false }) : button));
    }
    onButtonClicked(button) {
        const callbackReturnedObservable = button.callback
            ? button.callback()
            : of(null);
        if (button.action !== FundamentalModalButtonAction.None) {
            callbackReturnedObservable.subscribe((data) => button.action === FundamentalModalButtonAction.Close
                ? this.close(data)
                : this.dismiss(data));
        }
    }
    close(data) {
        this.modalRef.close(data);
    }
    dismiss(data) {
        this.dismissCallback()
            .then(() => this.modalRef.dismiss(data))
            .catch(lodash.noop);
    }
    dismissCallback() {
        return Promise.resolve();
    }
};
FundamentalModalManagerService.ctorParameters = () => [
    { type: ModalRef }
];
FundamentalModalManagerService = tslib_1.__decorate([
    Injectable(),
    tslib_1.__metadata("design:paramtypes", [ModalRef])
], FundamentalModalManagerService);
export { FundamentalModalManagerService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwtbWFuYWdlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHNtYXJ0L3V0aWxzLyIsInNvdXJjZXMiOlsic2VydmljZXMvbW9kYWwvbW9kYWwtbWFuYWdlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7QUFDSDs7R0FFRztBQUNILE9BQU8sS0FBSyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBQ2pDLE9BQU8sRUFBRSxVQUFVLEVBQVEsTUFBTSxlQUFlLENBQUM7QUFDakQsT0FBTyxFQUFFLEVBQUUsRUFBRSxlQUFlLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFDdkQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2pELE9BQU8sRUFBRSw0QkFBNEIsRUFBa0MsTUFBTSxrQkFBa0IsQ0FBQztBQUdoRyxJQUFhLDhCQUE4QixHQUEzQyxNQUFhLDhCQUE4QjtJQVV2QyxZQUFvQixRQUFrQjtRQUFsQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBVDlCLFVBQUssR0FBNEIsSUFBSSxlQUFlLENBQVMsRUFBRSxDQUFDLENBQUM7UUFDakUsZ0JBQVcsR0FBNEIsSUFBSSxlQUFlLENBQVMsRUFBRSxDQUFDLENBQUM7UUFDdkUsY0FBUyxHQUF5QixJQUFJLGVBQWUsQ0FBTSxFQUFFLENBQUMsQ0FBQztRQUMvRCxjQUFTLEdBQStCLElBQUksZUFBZSxDQUFZLEVBQWUsQ0FBQyxDQUFDO1FBQ3hGLDJCQUFzQixHQUE2QixJQUFJLGVBQWUsQ0FBVSxJQUFJLENBQUMsQ0FBQztRQUN0RixZQUFPLEdBQXNELElBQUksZUFBZSxDQUV0RixFQUFFLENBQUMsQ0FBQztJQUVtQyxDQUFDO0lBRW5DLElBQUk7UUFDUCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNsRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FB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OztBQVY3Qiw4QkFBOEI7SUFEMUMsVUFBVSxFQUFFOzZDQVdxQixRQUFRO0dBVjdCLDhCQUE4QixDQXlIMUM7U0F6SFksOEJBQThCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTkgU0FQIFNFIG9yIGFuIFNBUCBhZmZpbGlhdGUgY29tcGFueS4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEBtb2R1bGUgc21hcnR1dGlsc1xuICovXG4vKlxuICogQ29weXJpZ2h0IChjKSAyMDE5IFNBUCBTRSBvciBhbiBTQVAgYWZmaWxpYXRlIGNvbXBhbnkuIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKi9cbmltcG9ydCAqIGFzIGxvZGFzaCBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSwgVHlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgb2YsIEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTW9kYWxSZWYgfSBmcm9tICdAZnVuZGFtZW50YWwtbmd4L2NvcmUnO1xuaW1wb3J0IHsgRnVuZGFtZW50YWxNb2RhbEJ1dHRvbkFjdGlvbiwgSUZ1bmRhbWVudGFsTW9kYWxCdXR0b25PcHRpb25zIH0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcyc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBGdW5kYW1lbnRhbE1vZGFsTWFuYWdlclNlcnZpY2Uge1xuICAgIHByaXZhdGUgdGl0bGU6IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+KCcnKTtcbiAgICBwcml2YXRlIHRpdGxlU3VmZml4OiBCZWhhdmlvclN1YmplY3Q8c3RyaW5nPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8c3RyaW5nPignJyk7XG4gICAgcHJpdmF0ZSBtb2RhbERhdGE6IEJlaGF2aW9yU3ViamVjdDxhbnk+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnk+KHt9KTtcbiAgICBwcml2YXRlIGNvbXBvbmVudDogQmVoYXZpb3JTdWJqZWN0PFR5cGU8YW55Pj4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFR5cGU8YW55Pj4oe30gYXMgVHlwZTxhbnk+KTtcbiAgICBwcml2YXRlIGlzRGlzbWlzc0J1dHRvblZpc2libGU6IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4odHJ1ZSk7XG4gICAgcHJpdmF0ZSBidXR0b25zOiBCZWhhdmlvclN1YmplY3Q8SUZ1bmRhbWVudGFsTW9kYWxCdXR0b25PcHRpb25zW10+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxcbiAgICAgICAgSUZ1bmRhbWVudGFsTW9kYWxCdXR0b25PcHRpb25zW11cbiAgICA+KFtdKTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbW9kYWxSZWY6IE1vZGFsUmVmKSB7fVxuXG4gICAgcHVibGljIGluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMubW9kYWxEYXRhLm5leHQodGhpcy5tb2RhbFJlZi5kYXRhLm1vZGFsRGF0YSk7XG4gICAgICAgIHRoaXMuY29tcG9uZW50Lm5leHQodGhpcy5tb2RhbFJlZi5kYXRhLmNvbXBvbmVudCk7XG4gICAgICAgIHRoaXMuYnV0dG9ucy5uZXh0KHRoaXMubW9kYWxSZWYuZGF0YS50ZW1wbGF0ZUNvbmZpZy5idXR0b25zIHx8IFtdKTtcbiAgICAgICAgdGhpcy50aXRsZS5uZXh0KHRoaXMubW9kYWxSZWYuZGF0YS50ZW1wbGF0ZUNvbmZpZy50aXRsZSk7XG4gICAgICAgIHRoaXMudGl0bGVTdWZmaXgubmV4dCh0aGlzLm1vZGFsUmVmLmRhdGEudGVtcGxhdGVDb25maWcudGl0bGVTdWZmaXgpO1xuICAgICAgICB0aGlzLmlzRGlzbWlzc0J1dHRvblZpc2libGUubmV4dCh0aGlzLm1vZGFsUmVmLmRhdGEudGVtcGxhdGVDb25maWcuaXNEaXNtaXNzQnV0dG9uVmlzaWJsZSk7XG4gICAgfVxuXG4gICAgLy8gZ2V0dGVyc1xuXG4gICAgcHVibGljIGdldENvbXBvbmVudCgpOiBPYnNlcnZhYmxlPFR5cGU8YW55Pj4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21wb25lbnQuYXNPYnNlcnZhYmxlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFRpdGxlKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgICAgIHJldHVybiB0aGlzLnRpdGxlLmFzT2JzZXJ2YWJsZSgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRUaXRsZVN1ZmZpeCgpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xuICAgICAgICByZXR1cm4gdGhpcy50aXRsZVN1ZmZpeC5hc09ic2VydmFibGUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0QnV0dG9ucygpOiBPYnNlcnZhYmxlPElGdW5kYW1lbnRhbE1vZGFsQnV0dG9uT3B0aW9uc1tdPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmJ1dHRvbnMuYXNPYnNlcnZhYmxlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldE1vZGFsRGF0YSgpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5tb2RhbERhdGEuYXNPYnNlcnZhYmxlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldElzRGlzbWlzc0J1dHRvblZpc2libGUoKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzRGlzbWlzc0J1dHRvblZpc2libGUuYXNPYnNlcnZhYmxlKCk7XG4gICAgfVxuXG4gICAgLy8gaGVhZGVyIGRpc21pc3MgYnV0dG9uXG5cbiAgICBwdWJsaWMgc2V0RGlzbWlzc0J1dHRvblZpc2liaWxpdHkoaXNWaXNpYmxlOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMuaXNEaXNtaXNzQnV0dG9uVmlzaWJsZS5uZXh0KGlzVmlzaWJsZSk7XG4gICAgfVxuXG4gICAgLy8gdGl0bGVcblxuICAgIHB1YmxpYyBzZXRUaXRsZSh0aXRsZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMudGl0bGUubmV4dCh0aXRsZSk7XG4gICAgfVxuICAgIC8vIGJ1dHRvbnNcblxuICAgIHB1YmxpYyBhZGRCdXR0b24oYnV0dG9uOiBJRnVuZGFtZW50YWxNb2RhbEJ1dHRvbk9wdGlvbnMpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5idXR0b25zLm5leHQoWy4uLnRoaXMuYnV0dG9ucy52YWx1ZSwgYnV0dG9uXSk7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbW92ZUJ1dHRvbihpZDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuYnV0dG9ucy5uZXh0KFxuICAgICAgICAgICAgdGhpcy5idXR0b25zLnZhbHVlLmZpbHRlcigoYnV0dG9uOiBJRnVuZGFtZW50YWxNb2RhbEJ1dHRvbk9wdGlvbnMpID0+IGJ1dHRvbi5pZCAhPT0gaWQpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbW92ZUFsbEJ1dHRvbnMoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuYnV0dG9ucy5uZXh0KFtdKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZGlzYWJsZUJ1dHRvbihpZDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuYnV0dG9ucy5uZXh0KFxuICAgICAgICAgICAgdGhpcy5idXR0b25zLnZhbHVlLm1hcCgoYnV0dG9uOiBJRnVuZGFtZW50YWxNb2RhbEJ1dHRvbk9wdGlvbnMpID0+XG4gICAgICAgICAgICAgICAgYnV0dG9uLmlkID09PSBpZCA/IHsgLi4uYnV0dG9uLCBkaXNhYmxlZDogdHJ1ZSB9IDogYnV0dG9uXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIHNldERpc21pc3NDYWxsYmFjayhjYWxsYmFjazogKCkgPT4gUHJvbWlzZTxhbnk+KTogdm9pZCB7XG4gICAgICAgIHRoaXMuZGlzbWlzc0NhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgfVxuXG4gICAgcHVibGljIGVuYWJsZUJ1dHRvbihpZDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuYnV0dG9ucy5uZXh0KFxuICAgICAgICAgICAgdGhpcy5idXR0b25zLnZhbHVlLm1hcCgoYnV0dG9uOiBJRnVuZGFtZW50YWxNb2RhbEJ1dHRvbk9wdGlvbnMpID0+XG4gICAgICAgICAgICAgICAgYnV0dG9uLmlkID09PSBpZCA/IHsgLi4uYnV0dG9uLCBkaXNhYmxlZDogZmFsc2UgfSA6IGJ1dHRvblxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbkJ1dHRvbkNsaWNrZWQoYnV0dG9uOiBJRnVuZGFtZW50YWxNb2RhbEJ1dHRvbk9wdGlvbnMpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY2FsbGJhY2tSZXR1cm5lZE9ic2VydmFibGU6IE9ic2VydmFibGU8YW55PiA9IGJ1dHRvbi5jYWxsYmFja1xuICAgICAgICAgICAgPyBidXR0b24uY2FsbGJhY2soKVxuICAgICAgICAgICAgOiBvZihudWxsKTtcblxuICAgICAgICBpZiAoYnV0dG9uLmFjdGlvbiAhPT0gRnVuZGFtZW50YWxNb2RhbEJ1dHRvbkFjdGlvbi5Ob25lKSB7XG4gICAgICAgICAgICBjYWxsYmFja1JldHVybmVkT2JzZXJ2YWJsZS5zdWJzY3JpYmUoKGRhdGE6IGFueSkgPT5cbiAgICAgICAgICAgICAgICBidXR0b24uYWN0aW9uID09PSBGdW5kYW1lbnRhbE1vZGFsQnV0dG9uQWN0aW9uLkNsb3NlXG4gICAgICAgICAgICAgICAgICAgID8gdGhpcy5jbG9zZShkYXRhKVxuICAgICAgICAgICAgICAgICAgICA6IHRoaXMuZGlzbWlzcyhkYXRhKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBjbG9zZShkYXRhPzogYW55KTogdm9pZCB7XG4gICAgICAgIHRoaXMubW9kYWxSZWYuY2xvc2UoZGF0YSk7XG4gICAgfVxuXG4gICAgcHVibGljIGRpc21pc3MoZGF0YT86IGFueSk6IHZvaWQge1xuICAgICAgICB0aGlzLmRpc21pc3NDYWxsYmFjaygpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLm1vZGFsUmVmLmRpc21pc3MoZGF0YSkpXG4gICAgICAgICAgICAuY2F0Y2gobG9kYXNoLm5vb3ApO1xuICAgIH1cblxuICAgIHByaXZhdGUgZGlzbWlzc0NhbGxiYWNrKCk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG59XG4iXX0=