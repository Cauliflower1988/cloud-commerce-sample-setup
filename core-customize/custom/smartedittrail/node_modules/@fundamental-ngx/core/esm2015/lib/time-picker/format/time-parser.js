/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { TimeObject } from '../../time/time-object';
import * as i0 from "@angular/core";
/**
 * @return {?}
 */
export function TIME_FORMAT_FACTORY() {
    return new TimeFormatParserDefault();
}
/**
 * Abstract class which defines the behaviour of the time format and parser.
 * @abstract
 */
export class TimeFormatParser {
}
TimeFormatParser.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
                useFactory: TIME_FORMAT_FACTORY
            },] }
];
/** @nocollapse */ TimeFormatParser.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: TIME_FORMAT_FACTORY, token: TimeFormatParser, providedIn: "root" });
if (false) {
    /**
     * Should take in a string value and return a Time object.
     * @abstract
     * @param {?} value String to convert to a time object.
     * @param {?} displaySeconds boolean to define if string should display seconds.
     * @param {?} displayMinutes boolean to define if string should display minutes.
     * @param {?=} meridian boolean to define if string should be treated as a meridian.
     * @return {?}
     */
    TimeFormatParser.prototype.parse = function (value, displaySeconds, displayMinutes, meridian) { };
    /**
     * Should take in a time object and return a string representation.
     * @abstract
     * @param {?} time TimeObject to convert to a string.
     * @param {?} displaySeconds boolean to define if string should display seconds.
     * @param {?} displayMinutes boolean to define if string should display minutes.
     * @param {?=} meridian boolean to define if TimeObject should be treated as a meridian.
     * @return {?}
     */
    TimeFormatParser.prototype.format = function (time, displaySeconds, displayMinutes, meridian) { };
}
/**
 * Default implementation of the DateFormatParser service.
 */
export class TimeFormatParserDefault extends TimeFormatParser {
    /**
     * Takes in a string representation of a date and returns a Time object.
     * @param {?} value String to convert to a time object.
     * @param {?=} displaySeconds boolean to define if string should display seconds.
     * @param {?=} displayMinutes boolean to define if string should display minutes.
     * @param {?=} meridian boolean to define if string should be treated as a meridian.
     * @return {?}
     */
    parse(value, displaySeconds = true, displayMinutes = true, meridian) {
        /** @type {?} */
        const time = new TimeObject();
        /** @type {?} */
        let regexp;
        if (!meridian) {
            if (displaySeconds) {
                regexp = /^([0-1]?[0-9]|2[0-3]):([0-5][0-9]|[0-9])(:[0-5][0-9]|[0-9])$/;
            }
            else if (displayMinutes) {
                regexp = /^([0-1]?[0-9]|2[0-3]):([0-5][0-9]|[0-9])$/;
            }
            else {
                regexp = /^([0-1]?[0-9]|2[0-3])$/;
            }
            if (regexp.test(value)) {
                /** @type {?} */
                const splitString = value.split(':');
                time.hour = parseInt(splitString[0], 10);
                time.minute = parseInt(splitString[1], 10);
                if (displaySeconds) {
                    time.second = parseInt(splitString[2], 10);
                }
                return time;
            }
            else {
                return null;
            }
        }
        else if (meridian) {
            if (displaySeconds) {
                regexp = /^([0-1]?[0-9]|2[0-3]):([0-5][0-9]|[0-9])(:[0-5][0-9]|[0-9]) [APap][mM]$/;
            }
            else if (displayMinutes) {
                regexp = /^([0-1]?[0-9]|2[0-3]):([0-5][0-9]|[0-9]) [APap][mM]$/;
            }
            else {
                regexp = /^([0-1]?[0-9]|2[0-3]) [APap][mM]$/;
            }
            if (regexp.test(value)) {
                /** @type {?} */
                const period = value.split(' ')[1];
                /** @type {?} */
                const splitString = value.split(':');
                time.hour = parseInt(splitString[0], 10);
                if ((period === 'pm' || period === 'PM') && time.hour < 12) {
                    time.hour = time.hour + 12;
                }
                else if ((period === 'am' || period === 'AM') && time.hour === 12) {
                    time.hour = 0;
                }
                time.minute = parseInt(splitString[1], 10);
                if (displaySeconds) {
                    time.second = parseInt(splitString[2], 10);
                }
                return time;
            }
            else {
                return null;
            }
        }
    }
    /**
     * Takes in a time object and returns the string representation.
     * @param {?} time TimeObject to convert to a string.
     * @param {?=} displaySeconds boolean to define if string should display seconds.
     * @param {?=} displayMinutes boolean to define if string should display minutes.
     * @param {?=} meridian boolean to define if TimeObject should be treated as a meridian.
     * @return {?}
     */
    format(time, displaySeconds = true, displayMinutes = true, meridian) {
        /** @type {?} */
        let formattedHour;
        /** @type {?} */
        let formattedMinute;
        /** @type {?} */
        let formattedSecond;
        /** @type {?} */
        let formattedTime;
        /** @type {?} */
        let formattedMeridian;
        if (time.hour !== null) {
            if (meridian) {
                if (time.hour === 0) {
                    formattedHour = 12;
                    formattedMeridian = 'am';
                }
                else if (time.hour > 12) {
                    formattedHour = time.hour - 12;
                    formattedMeridian = 'pm';
                }
                else if (time.hour === 12) {
                    formattedHour = 12;
                    formattedMeridian = 'pm';
                }
                else {
                    formattedHour = time.hour;
                    formattedMeridian = 'am';
                }
            }
            else {
                formattedHour = time.hour;
            }
        }
        if (time.minute !== null && displayMinutes) {
            formattedMinute = time.minute < 10 ? '0' + time.minute : time.minute;
        }
        if (time.second !== null && displaySeconds) {
            formattedSecond = time.second < 10 ? '0' + time.second : time.second;
        }
        if (formattedHour || formattedHour === 0) {
            formattedTime = formattedHour;
            if (formattedMinute || formattedMinute === '00') {
                formattedTime = formattedTime + ':' + formattedMinute;
                if (formattedSecond || formattedSecond === '00') {
                    formattedTime = formattedTime + ':' + formattedSecond;
                }
            }
        }
        if (formattedMeridian && formattedTime) {
            formattedTime += ' ' + formattedMeridian;
        }
        return formattedTime;
    }
}
TimeFormatParserDefault.decorators = [
    { type: Injectable }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZS1wYXJzZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZnVuZGFtZW50YWwtbmd4L2NvcmUvIiwic291cmNlcyI6WyJsaWIvdGltZS1waWNrZXIvZm9ybWF0L3RpbWUtcGFyc2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQzs7Ozs7QUFFcEQsTUFBTSxVQUFVLG1CQUFtQjtJQUMvQixPQUFPLElBQUksdUJBQXVCLEVBQUUsQ0FBQztBQUN6QyxDQUFDOzs7OztBQVNELE1BQU0sT0FBZ0IsZ0JBQWdCOzs7WUFKckMsVUFBVSxTQUFDO2dCQUNSLFVBQVUsRUFBRSxNQUFNO2dCQUNsQixVQUFVLEVBQUUsbUJBQW1CO2FBQ2xDOzs7Ozs7Ozs7Ozs7O0lBVUcsa0dBQWdIOzs7Ozs7Ozs7O0lBU2hILGtHQUFnSDs7Ozs7QUFPcEgsTUFBTSxPQUFPLHVCQUF3QixTQUFRLGdCQUFnQjs7Ozs7Ozs7O0lBU2xELEtBQUssQ0FBQyxLQUFhLEVBQUUsaUJBQTBCLElBQUksRUFBRSxpQkFBMEIsSUFBSSxFQUFFLFFBQWtCOztjQUNwRyxJQUFJLEdBQUcsSUFBSSxVQUFVLEVBQUU7O1lBQ3pCLE1BQU07UUFDVixJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ1gsSUFBSSxjQUFjLEVBQUU7Z0JBQ2hCLE1BQU0sR0FBRyw4REFBOEQsQ0FBQzthQUMzRTtpQkFBTSxJQUFJLGNBQWMsRUFBRTtnQkFDdkIsTUFBTSxHQUFHLDJDQUEyQyxDQUFDO2FBQ3hEO2lCQUFNO2dCQUNILE1BQU0sR0FBRyx3QkFBd0IsQ0FBQzthQUNyQztZQUNELElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRTs7c0JBQ2QsV0FBVyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO2dCQUNwQyxJQUFJLENBQUMsSUFB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ZSc7XG5pbXBvcnQgeyBUaW1lT2JqZWN0IH0gZnJvbSAnLi4vLi4vdGltZS90aW1lLW9iamVjdCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBUSU1FX0ZPUk1BVF9GQUNUT1JZKCkge1xuICAgIHJldHVybiBuZXcgVGltZUZvcm1hdFBhcnNlckRlZmF1bHQoKTtcbn1cblxuLyoqXG4gKiBBYnN0cmFjdCBjbGFzcyB3aGljaCBkZWZpbmVzIHRoZSBiZWhhdmlvdXIgb2YgdGhlIHRpbWUgZm9ybWF0IGFuZCBwYXJzZXIuXG4gKi9cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCcsXG4gICAgdXNlRmFjdG9yeTogVElNRV9GT1JNQVRfRkFDVE9SWVxufSlcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBUaW1lRm9ybWF0UGFyc2VyIHtcblxuICAgIC8qKlxuICAgICAqIFNob3VsZCB0YWtlIGluIGEgc3RyaW5nIHZhbHVlIGFuZCByZXR1cm4gYSBUaW1lIG9iamVjdC5cbiAgICAgKiBAcGFyYW0gdmFsdWUgU3RyaW5nIHRvIGNvbnZlcnQgdG8gYSB0aW1lIG9iamVjdC5cbiAgICAgKiBAcGFyYW0gbWVyaWRpYW4gYm9vbGVhbiB0byBkZWZpbmUgaWYgc3RyaW5nIHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgbWVyaWRpYW4uXG4gICAgICogQHBhcmFtIGRpc3BsYXlTZWNvbmRzIGJvb2xlYW4gdG8gZGVmaW5lIGlmIHN0cmluZyBzaG91bGQgZGlzcGxheSBzZWNvbmRzLlxuICAgICAqIEBwYXJhbSBkaXNwbGF5TWludXRlcyBib29sZWFuIHRvIGRlZmluZSBpZiBzdHJpbmcgc2hvdWxkIGRpc3BsYXkgbWludXRlcy5cbiAgICAgKi9cbiAgICBhYnN0cmFjdCBwYXJzZSh2YWx1ZTogc3RyaW5nLCBkaXNwbGF5U2Vjb25kczogYm9vbGVhbiwgZGlzcGxheU1pbnV0ZXM6IGJvb2xlYW4sIG1lcmlkaWFuPzogYm9vbGVhbik6IFRpbWVPYmplY3Q7XG5cbiAgICAvKipcbiAgICAgKiBTaG91bGQgdGFrZSBpbiBhIHRpbWUgb2JqZWN0IGFuZCByZXR1cm4gYSBzdHJpbmcgcmVwcmVzZW50YXRpb24uXG4gICAgICogQHBhcmFtIHRpbWUgVGltZU9iamVjdCB0byBjb252ZXJ0IHRvIGEgc3RyaW5nLlxuICAgICAqIEBwYXJhbSBtZXJpZGlhbiBib29sZWFuIHRvIGRlZmluZSBpZiBUaW1lT2JqZWN0IHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgbWVyaWRpYW4uXG4gICAgICogQHBhcmFtIGRpc3BsYXlTZWNvbmRzIGJvb2xlYW4gdG8gZGVmaW5lIGlmIHN0cmluZyBzaG91bGQgZGlzcGxheSBzZWNvbmRzLlxuICAgICAqIEBwYXJhbSBkaXNwbGF5TWludXRlcyBib29sZWFuIHRvIGRlZmluZSBpZiBzdHJpbmcgc2hvdWxkIGRpc3BsYXkgbWludXRlcy5cbiAgICAgKi9cbiAgICBhYnN0cmFjdCBmb3JtYXQodGltZTogVGltZU9iamVjdCwgZGlzcGxheVNlY29uZHM6IGJvb2xlYW4sIGRpc3BsYXlNaW51dGVzOiBib29sZWFuLCBtZXJpZGlhbj86IGJvb2xlYW4pOiBzdHJpbmc7XG59XG5cbi8qKlxuICogRGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgRGF0ZUZvcm1hdFBhcnNlciBzZXJ2aWNlLlxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgVGltZUZvcm1hdFBhcnNlckRlZmF1bHQgZXh0ZW5kcyBUaW1lRm9ybWF0UGFyc2VyIHtcblxuICAgIC8qKlxuICAgICAqIFRha2VzIGluIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGEgZGF0ZSBhbmQgcmV0dXJucyBhIFRpbWUgb2JqZWN0LlxuICAgICAqIEBwYXJhbSB2YWx1ZSBTdHJpbmcgdG8gY29udmVydCB0byBhIHRpbWUgb2JqZWN0LlxuICAgICAqIEBwYXJhbSBtZXJpZGlhbiBib29sZWFuIHRvIGRlZmluZSBpZiBzdHJpbmcgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYSBtZXJpZGlhbi5cbiAgICAgKiBAcGFyYW0gZGlzcGxheVNlY29uZHMgYm9vbGVhbiB0byBkZWZpbmUgaWYgc3RyaW5nIHNob3VsZCBkaXNwbGF5IHNlY29uZHMuXG4gICAgICogQHBhcmFtIGRpc3BsYXlNaW51dGVzIGJvb2xlYW4gdG8gZGVmaW5lIGlmIHN0cmluZyBzaG91bGQgZGlzcGxheSBtaW51dGVzLlxuICAgICAqL1xuICAgIHB1YmxpYyBwYXJzZSh2YWx1ZTogc3RyaW5nLCBkaXNwbGF5U2Vjb25kczogYm9vbGVhbiA9IHRydWUsIGRpc3BsYXlNaW51dGVzOiBib29sZWFuID0gdHJ1ZSwgbWVyaWRpYW4/OiBib29sZWFuKTogVGltZU9iamVjdCB7XG4gICAgICAgIGNvbnN0IHRpbWUgPSBuZXcgVGltZU9iamVjdCgpO1xuICAgICAgICBsZXQgcmVnZXhwO1xuICAgICAgICBpZiAoIW1lcmlkaWFuKSB7XG4gICAgICAgICAgICBpZiAoZGlzcGxheVNlY29uZHMpIHtcbiAgICAgICAgICAgICAgICByZWdleHAgPSAvXihbMC0xXT9bMC05XXwyWzAtM10pOihbMC01XVswLTldfFswLTldKSg6WzAtNV1bMC05XXxbMC05XSkkLztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGlzcGxheU1pbnV0ZXMpIHtcbiAgICAgICAgICAgICAgICByZWdleHAgPSAvXihbMC0xXT9bMC05XXwyWzAtM10pOihbMC01XVswLTldfFswLTldKSQvO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZWdleHAgPSAvXihbMC0xXT9bMC05XXwyWzAtM10pJC87XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVnZXhwLnRlc3QodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3BsaXRTdHJpbmcgPSB2YWx1ZS5zcGxpdCgnOicpO1xuICAgICAgICAgICAgICAgIHRpbWUuaG91ciA9IHBhcnNlSW50KHNwbGl0U3RyaW5nWzBdLCAxMCk7XG4gICAgICAgICAgICAgICAgdGltZS5taW51dGUgPSBwYXJzZUludChzcGxpdFN0cmluZ1sxXSwgMTApO1xuICAgICAgICAgICAgICAgIGlmIChkaXNwbGF5U2Vjb25kcykge1xuICAgICAgICAgICAgICAgICAgICB0aW1lLnNlY29uZCA9IHBhcnNlSW50KHNwbGl0U3RyaW5nWzJdLCAxMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aW1lO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChtZXJpZGlhbikge1xuICAgICAgICAgICAgaWYgKGRpc3BsYXlTZWNvbmRzKSB7XG4gICAgICAgICAgICAgICAgcmVnZXhwID0gL14oWzAtMV0/WzAtOV18MlswLTNdKTooWzAtNV1bMC05XXxbMC05XSkoOlswLTVdWzAtOV18WzAtOV0pIFtBUGFwXVttTV0kLztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGlzcGxheU1pbnV0ZXMpIHtcbiAgICAgICAgICAgICAgICByZWdleHAgPSAvXihbMC0xXT9bMC05XXwyWzAtM10pOihbMC01XVswLTldfFswLTldKSBbQVBhcF1bbU1dJC87XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlZ2V4cCA9IC9eKFswLTFdP1swLTldfDJbMC0zXSkgW0FQYXBdW21NXSQvO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlZ2V4cC50ZXN0KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBlcmlvZCA9IHZhbHVlLnNwbGl0KCcgJylbMV07XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzcGxpdFN0cmluZyA9IHZhbHVlLnNwbGl0KCc6Jyk7XG4gICAgICAgICAgICAgICAgdGltZS5ob3VyID0gcGFyc2VJbnQoc3BsaXRTdHJpbmdbMF0sIDEwKTtcbiAgICAgICAgICAgICAgICBpZiAoKCBwZXJpb2QgPT09ICdwbScgfHwgcGVyaW9kID09PSAnUE0nICkgJiYgdGltZS5ob3VyIDwgMTIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZS5ob3VyID0gdGltZS5ob3VyICsgMTI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggKHBlcmlvZCA9PT0gJ2FtJyB8fCBwZXJpb2QgPT09ICdBTScpICYmIHRpbWUuaG91ciA9PT0gMTIgKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWUuaG91ciA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRpbWUubWludXRlID0gcGFyc2VJbnQoc3BsaXRTdHJpbmdbMV0sIDEwKTtcbiAgICAgICAgICAgICAgICBpZiAoZGlzcGxheVNlY29uZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZS5zZWNvbmQgPSBwYXJzZUludChzcGxpdFN0cmluZ1syXSwgMTApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGltZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUYWtlcyBpbiBhIHRpbWUgb2JqZWN0IGFuZCByZXR1cm5zIHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24uXG4gICAgICogQHBhcmFtIHRpbWUgVGltZU9iamVjdCB0byBjb252ZXJ0IHRvIGEgc3RyaW5nLlxuICAgICAqIEBwYXJhbSBtZXJpZGlhbiBib29sZWFuIHRvIGRlZmluZSBpZiBUaW1lT2JqZWN0IHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgbWVyaWRpYW4uXG4gICAgICogQHBhcmFtIGRpc3BsYXlTZWNvbmRzIGJvb2xlYW4gdG8gZGVmaW5lIGlmIHN0cmluZyBzaG91bGQgZGlzcGxheSBzZWNvbmRzLlxuICAgICAqIEBwYXJhbSBkaXNwbGF5TWludXRlcyBib29sZWFuIHRvIGRlZmluZSBpZiBzdHJpbmcgc2hvdWxkIGRpc3BsYXkgbWludXRlcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZm9ybWF0KHRpbWU6IFRpbWVPYmplY3QsIGRpc3BsYXlTZWNvbmRzOiBib29sZWFuID0gdHJ1ZSwgZGlzcGxheU1pbnV0ZXM6IGJvb2xlYW4gPSB0cnVlLCBtZXJpZGlhbj86IGJvb2xlYW4pOiBzdHJpbmcge1xuICAgICAgICBsZXQgZm9ybWF0dGVkSG91ciwgZm9ybWF0dGVkTWludXRlLCBmb3JtYXR0ZWRTZWNvbmQ7XG4gICAgICAgIGxldCBmb3JtYXR0ZWRUaW1lO1xuICAgICAgICBsZXQgZm9ybWF0dGVkTWVyaWRpYW47XG4gICAgICAgIGlmICh0aW1lLmhvdXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGlmIChtZXJpZGlhbikge1xuICAgICAgICAgICAgICAgIGlmICh0aW1lLmhvdXIgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkSG91ciA9IDEyO1xuICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRNZXJpZGlhbiA9ICdhbSc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aW1lLmhvdXIgPiAxMikge1xuICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRIb3VyID0gdGltZS5ob3VyIC0gMTI7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZE1lcmlkaWFuID0gJ3BtJztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRpbWUuaG91ciA9PT0gMTIpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkSG91ciA9IDEyO1xuICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRNZXJpZGlhbiA9ICdwbSc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkSG91ciA9IHRpbWUuaG91cjtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkTWVyaWRpYW4gPSAnYW0nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9ybWF0dGVkSG91ciA9IHRpbWUuaG91cjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGltZS5taW51dGUgIT09IG51bGwgJiYgZGlzcGxheU1pbnV0ZXMpIHtcbiAgICAgICAgICAgIGZvcm1hdHRlZE1pbnV0ZSA9IHRpbWUubWludXRlIDwgMTAgPyAnMCcgKyB0aW1lLm1pbnV0ZSA6IHRpbWUubWludXRlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRpbWUuc2Vjb25kICE9PSBudWxsICYmIGRpc3BsYXlTZWNvbmRzKSB7XG4gICAgICAgICAgICBmb3JtYXR0ZWRTZWNvbmQgPSB0aW1lLnNlY29uZCA8IDEwID8gJzAnICsgdGltZS5zZWNvbmQgOiB0aW1lLnNlY29uZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZm9ybWF0dGVkSG91ciB8fCBmb3JtYXR0ZWRIb3VyID09PSAwKSB7XG4gICAgICAgICAgICBmb3JtYXR0ZWRUaW1lID0gZm9ybWF0dGVkSG91cjtcbiAgICAgICAgICAgIGlmIChmb3JtYXR0ZWRNaW51dGUgfHwgZm9ybWF0dGVkTWludXRlID09PSAnMDAnKSB7XG4gICAgICAgICAgICAgICAgZm9ybWF0dGVkVGltZSA9IGZvcm1hdHRlZFRpbWUgKyAnOicgKyBmb3JtYXR0ZWRNaW51dGU7XG4gICAgICAgICAgICAgICAgaWYgKGZvcm1hdHRlZFNlY29uZCB8fCBmb3JtYXR0ZWRTZWNvbmQgPT09ICcwMCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkVGltZSA9IGZvcm1hdHRlZFRpbWUgKyAnOicgKyBmb3JtYXR0ZWRTZWNvbmQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChmb3JtYXR0ZWRNZXJpZGlhbiAmJiBmb3JtYXR0ZWRUaW1lKSB7XG4gICAgICAgICAgICBmb3JtYXR0ZWRUaW1lICs9ICcgJyArIGZvcm1hdHRlZE1lcmlkaWFuXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZm9ybWF0dGVkVGltZTtcbiAgICB9XG59XG4iXX0=