/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { NotificationComponent } from '../notification/notification.component';
import { NotificationContainer } from '../notification-utils/notification-container';
import { NotificationConfig } from '../notification-utils/notification-config';
import { NotificationRef } from '../notification-utils/notification-ref';
import { DynamicComponentService } from '../../utils/dynamic-component/dynamic-component.service';
import { NotificationGroupComponent } from '../notification-group/notification-group.component';
var NotificationService = /** @class */ (function () {
    function NotificationService(dynamicComponentService) {
        this.dynamicComponentService = dynamicComponentService;
        this.notifications = [];
    }
    /**
     * Opens an alert component with a content of type TemplateRef, Component Type or Configuration Object
     * @param content Content of the alert component, or NotificationDefault object.
     * @param notificationConfig Configuration of the notification component.
     * @param notificationGroup Configuration of the notification component.
     */
    /**
     * Opens an alert component with a content of type TemplateRef, Component Type or Configuration Object
     * @param {?} content Content of the alert component, or NotificationDefault object.
     * @param {?=} notificationConfig Configuration of the notification component.
     * @param {?=} notificationGroup Configuration of the notification component.
     * @return {?}
     */
    NotificationService.prototype.open = /**
     * Opens an alert component with a content of type TemplateRef, Component Type or Configuration Object
     * @param {?} content Content of the alert component, or NotificationDefault object.
     * @param {?=} notificationConfig Configuration of the notification component.
     * @param {?=} notificationGroup Configuration of the notification component.
     * @return {?}
     */
    function (content, notificationConfig, notificationGroup) {
        var _this = this;
        if (notificationConfig === void 0) { notificationConfig = new NotificationConfig(); }
        // Reassigning Object And Service
        /** @type {?} */
        var notificationService = new NotificationRef();
        notificationConfig = Object.assign(new NotificationConfig(), notificationConfig);
        notificationService.data = notificationConfig.data;
        if (notificationService.data) {
            notificationService.data.type = notificationConfig.type;
        }
        // Create Container if it doesn't exist
        if (!this.containerRef) {
            this.containerRef = this.dynamicComponentService.createDynamicComponent(content, NotificationContainer, notificationConfig);
        }
        // Pass Container reference to config
        notificationConfig.container = this.containerRef.location.nativeElement;
        /** @type {?} */
        var notificationComponentRef;
        if (notificationGroup) {
            // If there is group Pass group reference as a container
            notificationConfig.container = notificationGroup.location.nativeElement;
            // Create Notification Component
            notificationComponentRef = this.dynamicComponentService.createDynamicComponent(content, NotificationComponent, notificationConfig, [notificationService]);
            // Add To array
            this.notifications.push({
                notificationComponent: notificationComponentRef,
                notificationGroup: notificationGroup
            });
        }
        else {
            // Create Notification Component
            notificationComponentRef = this.dynamicComponentService.createDynamicComponent(content, NotificationComponent, notificationConfig, [notificationService]);
            // Add To array
            this.notifications.push({
                notificationComponent: notificationComponentRef,
            });
        }
        /** @type {?} */
        var defaultBehaviourOnClose = (/**
         * @return {?}
         */
        function () {
            _this.destroyNotificationComponent(notificationComponentRef);
            refSub.unsubscribe();
            refGroupSub.unsubscribe();
        });
        /** @type {?} */
        var defaultBehaviourOnGroupClose = (/**
         * @return {?}
         */
        function () {
            _this.destroyWholeGroup(notificationComponentRef);
            refGroupSub.unsubscribe();
            refSub.unsubscribe();
        });
        /** @type {?} */
        var refSub = notificationService.afterClosed
            .subscribe(defaultBehaviourOnClose, defaultBehaviourOnClose);
        /** @type {?} */
        var refGroupSub = notificationService.afterClosedGroup
            .subscribe(defaultBehaviourOnGroupClose, defaultBehaviourOnGroupClose);
        return notificationService;
    };
    /** Method to remove all of notifications from this service instance */
    /**
     * Method to remove all of notifications from this service instance
     * @return {?}
     */
    NotificationService.prototype.destroyAll = /**
     * Method to remove all of notifications from this service instance
     * @return {?}
     */
    function () {
        var _this = this;
        this.notifications.forEach((/**
         * @param {?} notification
         * @return {?}
         */
        function (notification) {
            _this.destroyNotificationComponent(notification.notificationComponent);
        }));
    };
    /** Method that informs if there is any notification opened in this service instance */
    /**
     * Method that informs if there is any notification opened in this service instance
     * @return {?}
     */
    NotificationService.prototype.isAnyOpened = /**
     * Method that informs if there is any notification opened in this service instance
     * @return {?}
     */
    function () {
        return this.notifications && this.notifications.length > 0;
    };
    /** Method to create Notification Group */
    /**
     * Method to create Notification Group
     * @param {?=} notificationConfig
     * @return {?}
     */
    NotificationService.prototype.createNotificationGroup = /**
     * Method to create Notification Group
     * @param {?=} notificationConfig
     * @return {?}
     */
    function (notificationConfig) {
        if (notificationConfig === void 0) { notificationConfig = new NotificationConfig(); }
        // Reassign Config Object
        notificationConfig = Object.assign(new NotificationConfig(), notificationConfig);
        if (!this.containerRef) {
            // Create Container Component
            this.containerRef = this.dynamicComponentService.createDynamicComponent(null, NotificationContainer, notificationConfig);
        }
        // Pass Container reference as a config container
        notificationConfig.container = this.containerRef.location.nativeElement;
        // Create and return notification Group component reference
        return this.dynamicComponentService.createDynamicComponent(null, NotificationGroupComponent, notificationConfig);
    };
    /**
     * @private
     * @param {?} notification
     * @return {?}
     */
    NotificationService.prototype.destroyWholeGroup = /**
     * @private
     * @param {?} notification
     * @return {?}
     */
    function (notification) {
        var _this = this;
        // Find Notification Group assigned to this Notification Component
        /** @type {?} */
        var arrayRef = this.notifications.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.notificationComponent === notification; }));
        if (arrayRef.notificationGroup) {
            // Find Any other Components, that are in this group
            /** @type {?} */
            var arrayToDelete = this.notifications
                .filter((/**
             * @param {?} _notification
             * @return {?}
             */
            function (_notification) { return _notification.notificationGroup === arrayRef.notificationGroup; }));
            // Destroy every single component, that are in the group
            arrayToDelete.forEach((/**
             * @param {?} _notification
             * @return {?}
             */
            function (_notification) { return _this.destroyNotificationComponent(_notification.notificationComponent); }));
        }
    };
    /**
     * @private
     * @param {?} notification
     * @return {?}
     */
    NotificationService.prototype.destroyNotificationComponent = /**
     * @private
     * @param {?} notification
     * @return {?}
     */
    function (notification) {
        // Find Notification component in the array.
        /** @type {?} */
        var arrayRef = this.notifications.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.notificationComponent === notification; }));
        /** @type {?} */
        var indexOf = this.notifications.indexOf(arrayRef);
        // Check the amount of component within the group
        /** @type {?} */
        var amountOfComponentsWithThisGroup = this.notifications.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            return item.notificationGroup && item.notificationGroup === arrayRef.notificationGroup;
        }));
        // If it's the only one component that is in the group, remove group component.
        if (amountOfComponentsWithThisGroup.length === 1) {
            this.dynamicComponentService.destroyComponent(arrayRef.notificationGroup);
        }
        // Destroy Component
        this.dynamicComponentService.destroyComponent(arrayRef.notificationComponent);
        // Remove it from Array
        this.notifications[indexOf] = null;
        this.notifications = this.notifications.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item !== null && item !== undefined; }));
        // If there is no other notification Components, just remove container.
        if (this.notifications.length === 0) {
            this.dynamicComponentService.destroyComponent(this.containerRef);
            this.containerRef = null;
        }
    };
    NotificationService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    NotificationService.ctorParameters = function () { return [
        { type: DynamicComponentService }
    ]; };
    return NotificationService;
}());
export { NotificationService };
if (false) {
    /** @type {?} */
    NotificationService.prototype.notifications;
    /** @type {?} */
    NotificationService.prototype.containerRef;
    /**
     * @type {?}
     * @private
     */
    NotificationService.prototype.dynamicComponentService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZnVuZGFtZW50YWwtbmd4L2NvcmUvIiwic291cmNlcyI6WyJsaWIvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi1zZXJ2aWNlL25vdGlmaWNhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWdCLFVBQVUsRUFBcUIsTUFBTSxlQUFlLENBQUM7QUFDNUUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDL0UsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sOENBQThDLENBQUM7QUFDckYsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFDL0UsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQ3pFLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLHlEQUF5RCxDQUFDO0FBQ2xHLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLG9EQUFvRCxDQUFDO0FBR2hHO0lBVUksNkJBQ1ksdUJBQWdEO1FBQWhELDRCQUF1QixHQUF2Qix1QkFBdUIsQ0FBeUI7UUFSckQsa0JBQWEsR0FHZCxFQUFFLENBQUM7SUFNTixDQUFDO0lBRUo7Ozs7O09BS0c7Ozs7Ozs7O0lBQ0ksa0NBQUk7Ozs7Ozs7SUFBWCxVQUNJLE9BQTJELEVBQzNELGtCQUFpRSxFQUNqRSxpQkFBNEQ7UUFIaEUsaUJBNkVDO1FBM0VHLG1DQUFBLEVBQUEseUJBQTZDLGtCQUFrQixFQUFFOzs7WUFLM0QsbUJBQW1CLEdBQW9CLElBQUksZUFBZSxFQUFFO1FBQ2xFLGtCQUFrQixHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxrQkFBa0IsRUFBRSxFQUFFLGtCQUFrQixDQUFDLENBQUM7UUFDakYsbUJBQW1CLENBQUMsSUFBSSxHQUFHLGtCQUFrQixDQUFDLElBQUksQ0FBQztRQUNuRCxJQUFJLG1C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QztTQUM1QjtJQUVMLENBQUM7O2dCQXRMSixVQUFVOzs7O2dCQUpGLHVCQUF1Qjs7SUEyTGhDLDBCQUFDO0NBQUEsQUF2TEQsSUF1TEM7U0F0TFksbUJBQW1COzs7SUFFNUIsNENBR1M7O0lBQ1QsMkNBQXlEOzs7OztJQUlyRCxzREFBd0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnRSZWYsIEluamVjdGFibGUsIFRlbXBsYXRlUmVmLCBUeXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25Db21wb25lbnQgfSBmcm9tICcuLi9ub3RpZmljYXRpb24vbm90aWZpY2F0aW9uLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25Db250YWluZXIgfSBmcm9tICcuLi9ub3RpZmljYXRpb24tdXRpbHMvbm90aWZpY2F0aW9uLWNvbnRhaW5lcic7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25Db25maWcgfSBmcm9tICcuLi9ub3RpZmljYXRpb24tdXRpbHMvbm90aWZpY2F0aW9uLWNvbmZpZyc7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25SZWYgfSBmcm9tICcuLi9ub3RpZmljYXRpb24tdXRpbHMvbm90aWZpY2F0aW9uLXJlZic7XG5pbXBvcnQgeyBEeW5hbWljQ29tcG9uZW50U2VydmljZSB9IGZyb20gJy4uLy4uL3V0aWxzL2R5bmFtaWMtY29tcG9uZW50L2R5bmFtaWMtY29tcG9uZW50LnNlcnZpY2UnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uR3JvdXBDb21wb25lbnQgfSBmcm9tICcuLi9ub3RpZmljYXRpb24tZ3JvdXAvbm90aWZpY2F0aW9uLWdyb3VwLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25EZWZhdWx0IH0gZnJvbSAnLi4vbm90aWZpY2F0aW9uLXV0aWxzL25vdGlmaWNhdGlvbi1kZWZhdWx0JztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE5vdGlmaWNhdGlvblNlcnZpY2Uge1xuXG4gICAgcHVibGljIG5vdGlmaWNhdGlvbnM6IHtcbiAgICAgICAgbm90aWZpY2F0aW9uQ29tcG9uZW50OiBDb21wb25lbnRSZWY8Tm90aWZpY2F0aW9uQ29tcG9uZW50PixcbiAgICAgICAgbm90aWZpY2F0aW9uR3JvdXA/OiBDb21wb25lbnRSZWY8Tm90aWZpY2F0aW9uR3JvdXBDb21wb25lbnQ+XG4gICAgfVtdID0gW107XG4gICAgcHVibGljIGNvbnRhaW5lclJlZjogQ29tcG9uZW50UmVmPE5vdGlmaWNhdGlvbkNvbnRhaW5lcj47XG5cblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGR5bmFtaWNDb21wb25lbnRTZXJ2aWNlOiBEeW5hbWljQ29tcG9uZW50U2VydmljZVxuICAgICkge31cblxuICAgIC8qKlxuICAgICAqIE9wZW5zIGFuIGFsZXJ0IGNvbXBvbmVudCB3aXRoIGEgY29udGVudCBvZiB0eXBlIFRlbXBsYXRlUmVmLCBDb21wb25lbnQgVHlwZSBvciBDb25maWd1cmF0aW9uIE9iamVjdFxuICAgICAqIEBwYXJhbSBjb250ZW50IENvbnRlbnQgb2YgdGhlIGFsZXJ0IGNvbXBvbmVudCwgb3IgTm90aWZpY2F0aW9uRGVmYXVsdCBvYmplY3QuXG4gICAgICogQHBhcmFtIG5vdGlmaWNhdGlvbkNvbmZpZyBDb25maWd1cmF0aW9uIG9mIHRoZSBub3RpZmljYXRpb24gY29tcG9uZW50LlxuICAgICAqIEBwYXJhbSBub3RpZmljYXRpb25Hcm91cCBDb25maWd1cmF0aW9uIG9mIHRoZSBub3RpZmljYXRpb24gY29tcG9uZW50LlxuICAgICAqL1xuICAgIHB1YmxpYyBvcGVuKFxuICAgICAgICBjb250ZW50OiBUZW1wbGF0ZVJlZjxhbnk+IHwgVHlwZTxhbnk+IHwgTm90aWZpY2F0aW9uRGVmYXVsdCxcbiAgICAgICAgbm90aWZpY2F0aW9uQ29uZmlnOiBOb3RpZmljYXRpb25Db25maWcgPSBuZXcgTm90aWZpY2F0aW9uQ29uZmlnKCksXG4gICAgICAgIG5vdGlmaWNhdGlvbkdyb3VwPzogQ29tcG9uZW50UmVmPE5vdGlmaWNhdGlvbkdyb3VwQ29tcG9uZW50PlxuICAgICk6IE5vdGlmaWNhdGlvblJlZiB7XG5cbiAgICAgICAgLy8gUmVhc3NpZ25pbmcgT2JqZWN0IEFuZCBTZXJ2aWNlXG4gICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvblNlcnZpY2U6IE5vdGlmaWNhdGlvblJlZiA9IG5ldyBOb3RpZmljYXRpb25SZWYoKTtcbiAgICAgICAgbm90aWZpY2F0aW9uQ29uZmlnID0gT2JqZWN0LmFzc2lnbihuZXcgTm90aWZpY2F0aW9uQ29uZmlnKCksIG5vdGlmaWNhdGlvbkNvbmZpZyk7XG4gICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZGF0YSA9IG5vdGlmaWNhdGlvbkNvbmZpZy5kYXRhO1xuICAgICAgICBpZiAobm90aWZpY2F0aW9uU2VydmljZS5kYXRhKSB7XG4gICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmRhdGEudHlwZSA9IG5vdGlmaWNhdGlvbkNvbmZpZy50eXBlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ3JlYXRlIENvbnRhaW5lciBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gICAgICAgIGlmICghdGhpcy5jb250YWluZXJSZWYpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyUmVmID0gdGhpcy5keW5hbWljQ29tcG9uZW50U2VydmljZS5jcmVhdGVEeW5hbWljQ29tcG9uZW50KGNvbnRlbnQsIE5vdGlmaWNhdGlvbkNvbnRhaW5lciwgbm90aWZpY2F0aW9uQ29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFBhc3MgQ29udGFpbmVyIHJlZmVyZW5jZSB0byBjb25maWdcbiAgICAgICAgbm90aWZpY2F0aW9uQ29uZmlnLmNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyUmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgIGxldCBub3RpZmljYXRpb25Db21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxOb3RpZmljYXRpb25Db21wb25lbnQ+O1xuICAgICAgICBpZiAobm90aWZpY2F0aW9uR3JvdXApIHtcblxuICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgZ3JvdXAgUGFzcyBncm91cCByZWZlcmVuY2UgYXMgYSBjb250YWluZXJcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbkNvbmZpZy5jb250YWluZXIgPSBub3RpZmljYXRpb25Hcm91cC5sb2NhdGlvbi5uYXRpdmVFbGVtZW50O1xuXG4gICAgICAgICAgICAvLyBDcmVhdGUgTm90aWZpY2F0aW9uIENvbXBvbmVudFxuICAgICAgICAgICAgbm90aWZpY2F0aW9uQ29tcG9uZW50UmVmID0gdGhpcy5keW5hbWljQ29tcG9uZW50U2VydmljZS5jcmVhdGVEeW5hbWljQ29tcG9uZW50KFxuICAgICAgICAgICAgICAgIGNvbnRlbnQsXG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9uQ29tcG9uZW50LFxuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbkNvbmZpZyxcbiAgICAgICAgICAgICAgICBbbm90aWZpY2F0aW9uU2VydmljZV1cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIEFkZCBUbyBhcnJheVxuICAgICAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbkNvbXBvbmVudDogbm90aWZpY2F0aW9uQ29tcG9uZW50UmVmLFxuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbkdyb3VwOiBub3RpZmljYXRpb25Hcm91cFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSBOb3RpZmljYXRpb24gQ29tcG9uZW50XG4gICAgICAgICAgICBub3RpZmljYXRpb25Db21wb25lbnRSZWYgPSB0aGlzLmR5bmFtaWNDb21wb25lbnRTZXJ2aWNlLmNyZWF0ZUR5bmFtaWNDb21wb25lbnQoXG4gICAgICAgICAgICAgICAgY29udGVudCxcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25Db21wb25lbnQsXG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uQ29uZmlnLFxuICAgICAgICAgICAgICAgIFtub3RpZmljYXRpb25TZXJ2aWNlXVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgLy8gQWRkIFRvIGFycmF5XG4gICAgICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uQ29tcG9uZW50OiBub3RpZmljYXRpb25Db21wb25lbnRSZWYsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRlZmF1bHRCZWhhdmlvdXJPbkNsb3NlID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kZXN0cm95Tm90aWZpY2F0aW9uQ29tcG9uZW50KG5vdGlmaWNhdGlvbkNvbXBvbmVudFJlZik7XG4gICAgICAgICAgICByZWZTdWIudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIHJlZkdyb3VwU3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZGVmYXVsdEJlaGF2aW91ck9uR3JvdXBDbG9zZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveVdob2xlR3JvdXAobm90aWZpY2F0aW9uQ29tcG9uZW50UmVmKTtcbiAgICAgICAgICAgIHJlZkdyb3VwU3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICByZWZTdWIudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCByZWZTdWIgPSBub3RpZmljYXRpb25TZXJ2aWNlLmFmdGVyQ2xvc2VkXG4gICAgICAgICAgICAuc3Vic2NyaWJlKGRlZmF1bHRCZWhhdmlvdXJPbkNsb3NlLCBkZWZhdWx0QmVoYXZpb3VyT25DbG9zZSlcbiAgICAgICAgO1xuXG4gICAgICAgIGNvbnN0IHJlZkdyb3VwU3ViID0gbm90aWZpY2F0aW9uU2VydmljZS5hZnRlckNsb3NlZEdyb3VwXG4gICAgICAgICAgICAuc3Vic2NyaWJlKGRlZmF1bHRCZWhhdmlvdXJPbkdyb3VwQ2xvc2UsIGRlZmF1bHRCZWhhdmlvdXJPbkdyb3VwQ2xvc2UpXG4gICAgICAgIDtcblxuICAgICAgICByZXR1cm4gbm90aWZpY2F0aW9uU2VydmljZTtcbiAgICB9XG5cbiAgICAvKiogTWV0aG9kIHRvIHJlbW92ZSBhbGwgb2Ygbm90aWZpY2F0aW9ucyBmcm9tIHRoaXMgc2VydmljZSBpbnN0YW5jZSAqL1xuICAgIHB1YmxpYyBkZXN0cm95QWxsKCk6IHZvaWQge1xuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMuZm9yRWFjaChub3RpZmljYXRpb24gPT4ge1xuICAgICAgICAgICAgdGhpcy5kZXN0cm95Tm90aWZpY2F0aW9uQ29tcG9uZW50KG5vdGlmaWNhdGlvbi5ub3RpZmljYXRpb25Db21wb25lbnQpO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBNZXRob2QgdGhhdCBpbmZvcm1zIGlmIHRoZXJlIGlzIGFueSBub3RpZmljYXRpb24gb3BlbmVkIGluIHRoaXMgc2VydmljZSBpbnN0YW5jZSAqL1xuICAgIHB1YmxpYyBpc0FueU9wZW5lZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubm90aWZpY2F0aW9ucyAmJiB0aGlzLm5vdGlmaWNhdGlvbnMubGVuZ3RoID4gMDtcbiAgICB9XG5cbiAgICAvKiogTWV0aG9kIHRvIGNyZWF0ZSBOb3RpZmljYXRpb24gR3JvdXAgKi9cbiAgICBwdWJsaWMgY3JlYXRlTm90aWZpY2F0aW9uR3JvdXAgKFxuICAgICAgICBub3RpZmljYXRpb25Db25maWc6IE5vdGlmaWNhdGlvbkNvbmZpZyA9IG5ldyBOb3RpZmljYXRpb25Db25maWcoKSxcbiAgICApOiBDb21wb25lbnRSZWY8Tm90aWZpY2F0aW9uR3JvdXBDb21wb25lbnQ+IHtcblxuICAgICAgICAvLyBSZWFzc2lnbiBDb25maWcgT2JqZWN0XG4gICAgICAgIG5vdGlmaWNhdGlvbkNvbmZpZyA9IE9iamVjdC5hc3NpZ24obmV3IE5vdGlmaWNhdGlvbkNvbmZpZygpLCBub3RpZmljYXRpb25Db25maWcpO1xuXG4gICAgICAgIGlmICghdGhpcy5jb250YWluZXJSZWYpIHtcblxuICAgICAgICAgICAgLy8gQ3JlYXRlIENvbnRhaW5lciBDb21wb25lbnRcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyUmVmID0gdGhpcy5keW5hbWljQ29tcG9uZW50U2VydmljZS5jcmVhdGVEeW5hbWljQ29tcG9uZW50KFxuICAgICAgICAgICAgICAgIG51bGwsIE5vdGlmaWNhdGlvbkNvbnRhaW5lciwgbm90aWZpY2F0aW9uQ29uZmlnXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUGFzcyBDb250YWluZXIgcmVmZXJlbmNlIGFzIGEgY29uZmlnIGNvbnRhaW5lclxuICAgICAgICBub3RpZmljYXRpb25Db25maWcuY29udGFpbmVyID0gdGhpcy5jb250YWluZXJSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudDtcblxuICAgICAgICAvLyBDcmVhdGUgYW5kIHJldHVybiBub3RpZmljYXRpb24gR3JvdXAgY29tcG9uZW50IHJlZmVyZW5jZVxuICAgICAgICByZXR1cm4gdGhpcy5keW5hbWljQ29tcG9uZW50U2VydmljZS5jcmVhdGVEeW5hbWljQ29tcG9uZW50XG4gICAgICAgICAgICA8Tm90aWZpY2F0aW9uR3JvdXBDb21wb25lbnQ+KG51bGwsIE5vdGlmaWNhdGlvbkdyb3VwQ29tcG9uZW50LCBub3RpZmljYXRpb25Db25maWcpXG4gICAgICAgIDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGRlc3Ryb3lXaG9sZUdyb3VwKG5vdGlmaWNhdGlvbjogQ29tcG9uZW50UmVmPE5vdGlmaWNhdGlvbkNvbXBvbmVudD4pOiB2b2lkIHtcblxuICAgICAgICAvLyBGaW5kIE5vdGlmaWNhdGlvbiBHcm91cCBhc3NpZ25lZCB0byB0aGlzIE5vdGlmaWNhdGlvbiBDb21wb25lbnRcbiAgICAgICAgY29uc3QgYXJyYXlSZWYgPSB0aGlzLm5vdGlmaWNhdGlvbnMuZmluZChpdGVtID0+IGl0ZW0ubm90aWZpY2F0aW9uQ29tcG9uZW50ID09PSBub3RpZmljYXRpb24pO1xuICAgICAgICBpZiAoYXJyYXlSZWYubm90aWZpY2F0aW9uR3JvdXApIHtcblxuICAgICAgICAgICAgLy8gRmluZCBBbnkgb3RoZXIgQ29tcG9uZW50cywgdGhhdCBhcmUgaW4gdGhpcyBncm91cFxuICAgICAgICAgICAgY29uc3QgYXJyYXlUb0RlbGV0ZSA9IHRoaXMubm90aWZpY2F0aW9uc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIoX25vdGlmaWNhdGlvbiA9PiBfbm90aWZpY2F0aW9uLm5vdGlmaWNhdGlvbkdyb3VwID09PSBhcnJheVJlZi5ub3RpZmljYXRpb25Hcm91cClcbiAgICAgICAgICAgIDtcblxuICAgICAgICAgICAgLy8gRGVzdHJveSBldmVyeSBzaW5nbGUgY29tcG9uZW50LCB0aGF0IGFyZSBpbiB0aGUgZ3JvdXBcbiAgICAgICAgICAgIGFycmF5VG9EZWxldGUuZm9yRWFjaChfbm90aWZpY2F0aW9uID0+IHRoaXMuZGVzdHJveU5vdGlmaWNhdGlvbkNvbXBvbmVudChfbm90aWZpY2F0aW9uLm5vdGlmaWNhdGlvbkNvbXBvbmVudCkpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGRlc3Ryb3lOb3RpZmljYXRpb25Db21wb25lbnQobm90aWZpY2F0aW9uOiBDb21wb25lbnRSZWY8Tm90aWZpY2F0aW9uQ29tcG9uZW50Pik6IHZvaWQge1xuXG4gICAgICAgIC8vIEZpbmQgTm90aWZpY2F0aW9uIGNvbXBvbmVudCBpbiB0aGUgYXJyYXkuXG4gICAgICAgIGNvbnN0IGFycmF5UmVmID0gdGhpcy5ub3RpZmljYXRpb25zLmZpbmQoaXRlbSA9PiBpdGVtLm5vdGlmaWNhdGlvbkNvbXBvbmVudCA9PT0gbm90aWZpY2F0aW9uKTtcbiAgICAgICAgY29uc3QgaW5kZXhPZiA9IHRoaXMubm90aWZpY2F0aW9ucy5pbmRleE9mKGFycmF5UmVmKTtcblxuICAgICAgICAvLyBDaGVjayB0aGUgYW1vdW50IG9mIGNvbXBvbmVudCB3aXRoaW4gdGhlIGdyb3VwXG4gICAgICAgIGNvbnN0IGFtb3VudE9mQ29tcG9uZW50c1dpdGhUaGlzR3JvdXAgPSB0aGlzLm5vdGlmaWNhdGlvbnMuZmlsdGVyKGl0ZW0gPT5cbiAgICAgICAgICAgIGl0ZW0ubm90aWZpY2F0aW9uR3JvdXAgJiYgaXRlbS5ub3RpZmljYXRpb25Hcm91cCA9PT0gYXJyYXlSZWYubm90aWZpY2F0aW9uR3JvdXBcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBJZiBpdCdzIHRoZSBvbmx5IG9uZSBjb21wb25lbnQgdGhhdCBpcyBpbiB0aGUgZ3JvdXAsIHJlbW92ZSBncm91cCBjb21wb25lbnQuXG4gICAgICAgIGlmIChhbW91bnRPZkNvbXBvbmVudHNXaXRoVGhpc0dyb3VwLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgdGhpcy5keW5hbWljQ29tcG9uZW50U2VydmljZS5kZXN0cm95Q29tcG9uZW50KGFycmF5UmVmLm5vdGlmaWNhdGlvbkdyb3VwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERlc3Ryb3kgQ29tcG9uZW50XG4gICAgICAgIHRoaXMuZHluYW1pY0NvbXBvbmVudFNlcnZpY2UuZGVzdHJveUNvbXBvbmVudChhcnJheVJlZi5ub3RpZmljYXRpb25Db21wb25lbnQpO1xuXG4gICAgICAgIC8vIFJlbW92ZSBpdCBmcm9tIEFycmF5XG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9uc1tpbmRleE9mXSA9IG51bGw7XG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9ucyA9IHRoaXMubm90aWZpY2F0aW9ucy5maWx0ZXIoaXRlbSA9PiBpdGVtICE9PSBudWxsICYmIGl0ZW0gIT09IHVuZGVmaW5lZCk7XG5cbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gb3RoZXIgbm90aWZpY2F0aW9uIENvbXBvbmVudHMsIGp1c3QgcmVtb3ZlIGNvbnRhaW5lci5cbiAgICAgICAgaWYgKHRoaXMubm90aWZpY2F0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuZHluYW1pY0NvbXBvbmVudFNlcnZpY2UuZGVzdHJveUNvbXBvbmVudCh0aGlzLmNvbnRhaW5lclJlZik7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lclJlZiA9IG51bGw7XG4gICAgICAgIH1cblxuICAgIH1cbn1cbiJdfQ==